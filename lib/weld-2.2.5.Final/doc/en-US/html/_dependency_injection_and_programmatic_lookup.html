<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 4. Dependency injection and programmatic lookup</title><link rel="stylesheet" href="css/seamframework.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Weld - CDI Reference Implementation"/><link rel="up" href="_beans.html" title="Part I. Beans"/><link rel="prev" href="_jsf_web_application_example.html" title="Chapter 3. JSF web application example"/><link rel="next" href="_scopes_and_contexts.html" title="Chapter 5. Scopes and contexts"/></head><body><p id="title"><a href="http://www.seamframework.org" class="site_href"><strong>SeamFramework.org</strong></a><a href="http://www.seamframework.org/Documentation" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="_jsf_web_application_example.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="_scopes_and_contexts.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_dependency_injection_and_programmatic_lookup"/>Chapter 4. Dependency injection and programmatic lookup</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="_dependency_injection_and_programmatic_lookup.html#_injection_points">4.1. Injection points</a></span></dt><dt><span class="section"><a href="_dependency_injection_and_programmatic_lookup.html#_what_gets_injected">4.2. What gets injected</a></span></dt><dt><span class="section"><a href="_dependency_injection_and_programmatic_lookup.html#_qualifier_annotations">4.3. Qualifier annotations</a></span></dt><dt><span class="section"><a href="_dependency_injection_and_programmatic_lookup.html#_the_built_in_qualifiers_literal_default_literal_and_literal_any_literal">4.4. The built-in qualifiers <code class="literal">@Default</code> and <code class="literal">@Any</code></a></span></dt><dt><span class="section"><a href="_dependency_injection_and_programmatic_lookup.html#_qualifiers_with_members">4.5. Qualifiers with members</a></span></dt><dt><span class="section"><a href="_dependency_injection_and_programmatic_lookup.html#_multiple_qualifiers">4.6. Multiple qualifiers</a></span></dt><dt><span class="section"><a href="_dependency_injection_and_programmatic_lookup.html#alternatives">4.7. Alternatives</a></span></dt><dt><span class="section"><a href="_dependency_injection_and_programmatic_lookup.html#_fixing_unsatisfied_and_ambiguous_dependencies">4.8. Fixing unsatisfied and ambiguous dependencies</a></span></dt><dt><span class="section"><a href="_dependency_injection_and_programmatic_lookup.html#_client_proxies">4.9. Client proxies</a></span></dt><dt><span class="section"><a href="_dependency_injection_and_programmatic_lookup.html#_obtaining_a_contextual_instance_by_programmatic_lookup">4.10. Obtaining a contextual instance by programmatic lookup</a></span></dt><dt><span class="section"><a href="_dependency_injection_and_programmatic_lookup.html#_the_literal_injectionpoint_literal_object">4.11. The <code class="literal">InjectionPoint</code> object</a></span></dt></dl></div>

<p>One of the most significant features of CDI—certainly the most
recognized—is dependency injection; excuse me, <span class="emphasis"><em>typesafe</em></span> dependency
injection.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_injection_points"/>4.1. Injection points</h2></div></div></div>

<p>The <code class="literal">@Inject</code> annotation lets us define an injection point that is
injected during bean instantiation. Injection can occur via three
different mechanisms.</p>
<p><span class="emphasis"><em>Bean constructor</em></span> parameter injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Checkout</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Checkout</span><span class="java_separator">(</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">cart&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>A bean can only have one injectable constructor.</p>
<p><span class="emphasis"><em>Initializer method</em></span> parameter injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Checkout</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setShoppingCart</span><span class="java_separator">(</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">cart&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>A bean can have multiple initializer methods. If the bean is a session
bean, the initializer method is not required to be a business method of
the session bean.</p>
</div>

<p>And direct field injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Checkout</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Getter and setter methods are not required for field injection to work
(unlike with JSF managed beans).</p>
</div>

<p>Dependency injection always occurs when the bean instance is first
instantiated by the container. Simplifying just a little, things happen
in this order:</p>
<div class="itemizedlist"><ul><li>
First, the container calls the bean constructor (the default
constructor or the one annotated <code class="literal">@Inject</code>), to obtain an instance of
the bean.
</li><li>
Next, the container initializes the values of all injected fields of
the bean.
</li><li>
Next, the container calls all initializer methods of bean (the call
order is not portable, don’t rely on it).
</li><li>
Finally, the <code class="literal">@PostConstruct</code> method, if any, is called.
</li></ul></div>

<p>(The only complication is that the container might call initializer
methods declared by a superclass before initializing injected fields
declared by a subclass.)</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>One major advantage of constructor injection is that it allows the bean
to be immutable.</p>
</div>

<p>CDI also supports parameter injection for some other methods that are
invoked by the container. For instance, parameter injection is supported
for producer methods:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Checkout</span><!-- <br/> --><span class="java_plain">&nbsp;createCheckout</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">ShoppingCart</span><!-- <br/> --><span class="java_plain">&nbsp;cart</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Checkout</span><span class="java_separator">(</span><span class="java_plain">cart</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>This is a case where the <code class="literal">@Inject</code> annotation <span class="emphasis"><em>is not</em></span> required at the
injection point. The same is true for observer methods (which we’ll meet
in <a href="_events.html" title="Chapter 11. Events">Chapter 11, <i xmlns:xlink="http://www.w3.org/1999/xlink">Events</i></a>) and disposer methods.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_what_gets_injected"/>4.2. What gets injected</h2></div></div></div>

<p>The CDI specification defines a procedure, called <span class="emphasis"><em>typesafe resolution</em></span>,
that the container follows when identifying the bean to inject to an
injection point. This algorithm looks complex at first, but once you
understand it, it’s really quite intuitive. Typesafe resolution is
performed at system initialization time, which means that the container
will inform the developer immediately if a bean’s dependencies cannot be
satisfied.</p>
<p>The purpose of this algorithm is to allow multiple beans to implement
the same bean type and either:</p>
<div class="itemizedlist"><ul><li>
allow the client to select which implementation it requires using a
<span class="emphasis"><em>qualifier</em></span> or
</li><li>
allow the application deployer to select which implementation is
appropriate for a particular deployment, without changes to the client,
by enabling or disabling an <span class="emphasis"><em>alternative</em></span>, or
</li><li>
allow the beans to be isolated into separate modules.
</li></ul></div>

<p>Obviously, if you have exactly one bean of a given type, and an
injection point with that same type, then bean A is going to go into
slot A. That’s the simplest possible scenario. When you first start your
application, you’ll likely have lots of those.</p>
<p>But then, things start to get complicated. Let’s explore how the
container determines which bean to inject in more advanced cases. We’ll
start by taking a closer look at qualifiers.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_qualifier_annotations"/>4.3. Qualifier annotations</h2></div></div></div>

<p>If we have more than one bean that implements a particular bean type,
the injection point can specify exactly which bean should be injected
using a qualifier annotation. For example, there might be two
implementations of <code class="literal">PaymentProcessor</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Synchronous</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SynchronousPaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;process</span><span class="java_separator">(</span><span class="java_type">Payment</span><span class="java_plain">&nbsp;payment</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Asynchronous</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AsynchronousPaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;process</span><span class="java_separator">(</span><span class="java_type">Payment</span><span class="java_plain">&nbsp;payment</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Where <code class="literal">@Synchronous</code> and <code class="literal">@Asynchronous</code> are qualifier annotations:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Synchronous</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>A client bean developer uses the qualifier annotation to specify exactly
which bean should be injected.</p>
<p>Using field injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Synchronous</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;syncPaymentProcessor</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">;</span></pre>

<p>Using initializer method injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setPaymentProcessors</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Synchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;syncPaymentProcessor</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">syncPaymentProcessor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;syncPaymentProcessor</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">asyncPaymentProcessor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Using constructor injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Checkout</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Synchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;syncPaymentProcessor</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">syncPaymentProcessor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;syncPaymentProcessor</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">asyncPaymentProcessor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Qualifier annotations can also qualify method arguments of producer,
disposer and observer methods. Combining qualified arguments with
producer methods is a good way to have an implementation of a bean type
selected at runtime based on the state of the system:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span>
<!--  --><br/><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;getPaymentProcessor</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Synchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;syncPaymentProcessor</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;isSynchronous</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;syncPaymentProcessor&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>If an injected field or a parameter of a bean constructor or initializer
method is not explicitly annotated with a qualifier, the default
qualifier,<code class="literal">@Default</code>, is assumed.</p>
<p>Now, you may be thinking, <span class="emphasis"><em>"What’s the different between using a
qualifier and just specifying the exact implementation class you want?"</em></span>
It’s important to understand that a qualifier is like an extension of
the interface. It does not create a direct dependency to any particular
implementation. There may be multiple alternative implementations of
<code class="literal">@Asynchronous PaymentProcessor</code>!</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_built_in_qualifiers_literal_default_literal_and_literal_any_literal"/>4.4. The built-in qualifiers <code class="literal">@Default</code> and <code class="literal">@Any</code></h2></div></div></div>

<p>Whenever a bean or injection point does not explicitly declare a
qualifier, the container assumes the qualifier <code class="literal">@Default</code>. From time to
time, you’ll need to declare an injection point without specifying a
qualifier. There’s a qualifier for that too. All beans have the
qualifier`
                @Any`. Therefore, by explicitly specifying <code class="literal">@Any</code> at an
injection point, you suppress the default qualifier, without otherwise
restricting the beans that are eligible for injection.</p>
<p>This is especially useful if you want to iterate over all beans with a
certain bean type. For example:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Instance</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_type">void</span><span class="java_plain">&nbsp;initServices</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Any</span><span class="java_plain">&nbsp;</span><span class="java_type">Instance</span><span class="java_operator">&lt;</span><span class="java_type">Service</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;services</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Service</span><span class="java_plain">&nbsp;service</span><span class="java_operator">:</span><span class="java_plain">&nbsp;services</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service</span><span class="java_separator">.</span><span class="java_plain">init</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_qualifiers_with_members"/>4.5. Qualifiers with members</h2></div></div></div>

<p>Java annotations can have members. We can use annotation members to
further discriminate a qualifier. This prevents a potential explosion of
new annotations. For example, instead of creating several qualifiers
representing different payment methods, we could aggregate them into a
single annotation with a member:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">PayBy</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">PaymentMethod</span><span class="java_plain">&nbsp;value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Then we select one of the possible member values when applying the
qualifier:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">private</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">PayBy</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">CHECK</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;checkPayment</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>We can force the container to ignore a member of a qualifier type by
annotating the member <code class="literal">@Nonbinding</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">PayBy</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">PaymentMethod</span><span class="java_plain">&nbsp;value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Nonbinding</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;comment</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_multiple_qualifiers"/>4.6. Multiple qualifiers</h2></div></div></div>

<p>An injection point may specify multiple qualifiers:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Synchronous</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Reliable</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;syncPaymentProcessor</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>Then only a bean which has <span class="emphasis"><em>both</em></span> qualifier annotations would be
eligible for injection.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Synchronous</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Reliable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SynchronousReliablePaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;process</span><span class="java_separator">(</span><span class="java_type">Payment</span><span class="java_plain">&nbsp;payment</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="alternatives"/>4.7. Alternatives</h2></div></div></div>

<p>Alternatives are beans whose implementation is specific to a particular
client module or deployment scenario. This alternative defines a mock
implementation of both <code class="literal">@Synchronous PaymentProcessor</code> and
<code class="literal">@Asynchronous PaymentProcessor</code>, all in one:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Alternative</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Synchronous</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Asynchronous</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MockPaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;process</span><span class="java_separator">(</span><span class="java_type">Payment</span><span class="java_plain">&nbsp;payment</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>By default, <code class="literal">@Alternative</code> beans are disabled. We need to <span class="emphasis"><em>enable</em></span> an
alternative in the <code class="literal">beans.xml</code> descriptor of a bean archive to make it
available for instantiation and injection. However, this activation only
applies to the beans in that archive. From CDI 1.1 onwards the
alternative can be enabled for the whole application using <code class="literal">@Priority</code>
annotation.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">beans</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">alternatives</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mycompany.mock.MockPaymentProcessor</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">alternatives</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>When an ambiguous dependency exists at an injection point, the container
attempts to resolve the ambiguity by looking for an enabled alternative
among the beans that could be injected. If there is exactly one enabled
alternative, that’s the bean that will be injected. If there are more
beans with priority, the one with the highest priority value is
selected.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_fixing_unsatisfied_and_ambiguous_dependencies"/>4.8. Fixing unsatisfied and ambiguous dependencies</h2></div></div></div>

<p>The typesafe resolution algorithm fails when, after considering the
qualifier annotations on all beans that implement the bean type of an
injection point and filtering out disabled beans (<code class="literal">@Alternative</code> beans
which are not explicitly enabled), the container is unable to identify
exactly one bean to inject. The container will abort deployment,
informing us of the unsatisfied or ambiguous dependency.</p>
<p>During the course of your development, you’re going to encounter this
situation. Let’s learn how to resolve it.</p>
<p>To fix an <span class="emphasis"><em>unsatisfied dependency</em></span>, either:</p>
<div class="itemizedlist"><ul><li>
create a bean which implements the bean type and has all the qualifier
types of the injection point,
</li><li>
make sure that the bean you already have is in the classpath of the
module with the injection point, or
</li><li>
explicitly enable an <code class="literal">@Alternative</code> bean that implements the bean type
and has the appropriate qualifier types, using <code class="literal">beans.xml</code>.
</li><li>
enable an <code class="literal">@Alternative</code> bean that implements the bean type and has
the appropriate qualifier types, using <code class="literal">@Priority</code> annotation.
</li></ul></div>

<p>To fix an <span class="emphasis"><em>ambiguous dependency</em></span>, either:</p>
<div class="itemizedlist"><ul><li>
introduce a qualifier to distinguish between the two implementations
of the bean type,
</li><li>
exclude one of the beans from discovery (either by means of
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/cdi/api/1.1/javax/enterprise/inject/Vetoed.html">@Vetoed</a>
or <code class="literal">beans.xml</code>),
</li><li>
disable one of the beans by annotating it <code class="literal">@Alternative</code>,
</li><li>
move one of the implementations to a module that is not in the
classpath of the module with the injection point, or
</li><li>
disable one of two <code class="literal">@Alternative</code> beans that are trying to occupy the
same space, using <code class="literal">beans.xml</code>,
</li><li>
change priority value of one of two <code class="literal">@Alternative</code> beans with the
<code class="literal">@Priority</code> if they have the same highest priority value.
</li></ul></div>

<p>Just remember: "There can be only one."</p>
<p>On the other hand, if you really do have an optional or multivalued
injection point, you should change the type of your injection point to
<code class="literal">Instance</code>, as we’ll see in <a href="_dependency_injection_and_programmatic_lookup.html#_obtaining_a_contextual_instance_by_programmatic_lookup" title="4.10. Obtaining a contextual instance by programmatic lookup">Section 4.10, “Obtaining a contextual instance by programmatic lookup”</a>.</p>
<p>Now there’s one more issue you need to be aware of when using the
dependency injection service.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_client_proxies"/>4.9. Client proxies</h2></div></div></div>

<p>Clients of an injected bean do not usually hold a direct reference to a
bean instance, unless the bean is a dependent object (scope
<code class="literal">@Dependent</code>).</p>
<p>Imagine that a bean bound to the application scope held a direct
reference to a bean bound to the request scope. The application-scoped
bean is shared between many different requests. However, each request
should see a different instance of the request scoped bean—the current
one!</p>
<p>Now imagine that a bean bound to the session scope holds a direct
reference to a bean bound to the application scope. From time to time,
the session context is serialized to disk in order to use memory more
efficiently. However, the application scoped bean instance should not be
serialized along with the session scoped bean! It can get that reference
any time. No need to hoard it!</p>
<p>Therefore, unless a bean has the default scope <code class="literal">@Dependent</code>, the
container must indirect all injected references to the bean through a
proxy object. This <span class="emphasis"><em>client proxy</em></span> is responsible for ensuring that the
bean instance that receives a method invocation is the instance that is
associated with the current context. The client proxy also allows beans
bound to contexts such as the session context to be serialized to disk
without recursively serializing other injected beans.</p>
<p>Unfortunately, due to limitations of the Java language, some Java types
cannot be proxied by the container. If an injection point declared with
one of these types resolves to a bean with any scope other than
<code class="literal">@Dependent</code>, the container will abort deployment, informing us of the
problem.</p>
<p>The following Java types cannot be proxied by the container:</p>
<div class="itemizedlist"><ul><li>
classes which don’t have a non-private constructor with no parameters,
and
</li><li>
classes which are declared <code class="literal">final</code> or have a <code class="literal">final</code> method,
</li><li>
arrays and primitive types.
</li></ul></div>

<p>It’s usually very easy to fix an unproxyable dependency problem. If an
injection point of type <code class="literal">X</code> results in an unproxyable dependency,
simply:</p>
<div class="itemizedlist"><ul><li>
add a constructor with no parameters to <code class="literal">X</code>,
</li><li>
change the type of the injection point to`Instance&lt;X&gt;`,
</li><li>
introduce an interface <code class="literal">Y</code>, implemented by the injected bean, and
change the type of the injection point to <code class="literal">Y</code>, or
</li><li>
if all else fails, change the scope of the injected bean to
<code class="literal">@Dependent</code>.
</li></ul></div>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Weld also supports a non-standard workaround for this limitation, using
non-portable JVM APIs:</p>
<div class="itemizedlist"><ul><li>
Sun, IcedTea, Mac: <code class="literal">Unsafe.allocateInstance()</code> (The most efficient)
</li><li>
IBM, JRockit: <code class="literal">ReflectionFactory.newConstructorForSerialization()</code>
</li></ul></div>

<p>To enable this workaround, simply put an empty marker file
<code class="literal">META-INF/org.jboss.weld.enableUnsafeProxies</code> somewhere on the
application’s classpath.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_obtaining_a_contextual_instance_by_programmatic_lookup"/>4.10. Obtaining a contextual instance by programmatic lookup</h2></div></div></div>

<p>In certain situations, injection is not the most convenient way to
obtain a contextual reference. For example, it may not be used when:</p>
<div class="itemizedlist"><ul><li>
the bean type or qualifiers vary dynamically at runtime, or
</li><li>
depending upon the deployment, there may be no bean which satisfies
the type and qualifiers, or
</li><li>
we would like to iterate over all beans of a certain type.
</li></ul></div>

<p>In these situations, the application may obtain an instance of the
interface <code class="literal">Instance</code>, parameterized for the bean type, by injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Instance</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;paymentProcessorSource</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>The <code class="literal">get()</code> method of <code class="literal">Instance</code> produces a contextual instance of the
bean.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;p&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;paymentProcessorSource</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">get</span><!-- <br/> --><span class="java_separator">();</span></pre>

<p>Qualifiers can be specified in one of two ways:</p>
<div class="itemizedlist"><ul><li>
by annotating the <code class="literal">Instance</code> injection point, or
</li><li>
by passing qualifiers to the <code class="literal">select()</code> of <code class="literal">Event</code>.
</li></ul></div>

<p>Specifying the qualifiers at the injection point is much, much easier:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Asynchronous</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Instance</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;paymentProcessorSource</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>Now, the <code class="literal">PaymentProcessor</code> returned by <code class="literal">get()</code> will have the qualifier
<code class="literal">@Asynchronous</code>.</p>
<p>Alternatively, we can specify the qualifier dynamically. First, we add
the <code class="literal">@Any</code> qualifier to the injection point, to suppress the default
qualifier. (All beans have the qualifier <code class="literal">@Any</code> .)</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Instance</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">Any</span><span class="java_plain">&nbsp;</span><span class="java_type">Instance</span><span class="java_operator">&lt;</span><span class="java_type">PaymentProcessor</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;paymentProcessorSource</span><span class="java_separator">;</span></pre>

<p>Next, we need to obtain an instance of our qualifier type. Since
annotations are interfaces, we can’t just write <code class="literal">new Asynchronous()</code>.
It’s also quite tedious to create a concrete implementation of an
annotation type from scratch. Instead, CDI lets us obtain a qualifier
instance by subclassing the helper class <code class="literal">AnnotationLiteral</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">AsynchronousQualifier</span>
<!--  --><br/><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Asynchronous</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>In some cases, we can use an anonymous class:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;p&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;paymentProcessorSource</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">select</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Asynchronous</span><span class="java_operator">&gt;</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{});</span></pre>

<p>However, we can’t use an anonymous class to implement a qualifier type
with members.</p>
<p>Now, finally, we can pass the qualifier to the <code class="literal">select()</code> method
of <code class="literal">Instance</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Annotation</span><!-- <br/> --><span class="java_plain">&nbsp;qualifier&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;synchronously&nbsp;</span><!-- <br/> --><span class="java_operator">?</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">SynchronousQualifier</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AsynchronousQualifier</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;p&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;anyPaymentProcessor</span><span class="java_separator">.</span><span class="java_plain">select</span><span class="java_separator">(</span><span class="java_plain">qualifier</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">().</span><span class="java_plain">process</span><span class="java_separator">(</span><span class="java_plain">payment</span><span class="java_separator">);</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_literal_injectionpoint_literal_object"/>4.11. The <code class="literal">InjectionPoint</code> object</h2></div></div></div>

<p>There are certain kinds of dependent objects (beans with scope
<code class="literal">@Dependent</code>) that need to know something about the object or injection
point into which they are injected in order to be able to do what they
do. For example:</p>
<div class="itemizedlist"><ul><li>
The log category for a <code class="literal">Logger</code> depends upon the class of the object
that owns it.
</li><li>
Injection of a HTTP parameter or header value depends upon what
parameter or header name was specified at the injection point.
</li><li>
Injection of the result of an EL expression evaluation depends upon
the expression that was specified at the injection point.
</li></ul></div>

<p>A bean with scope <code class="literal">@Dependent</code> may inject an instance of
<code class="literal">InjectionPoint</code> and access metadata relating to the injection point to
which it belongs.</p>
<p>Let’s look at an example. The following code is verbose, and vulnerable
to refactoring problems:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Logger</span><!-- <br/> --><span class="java_plain">&nbsp;log&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Logger</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getLogger</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">MyClass</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getName</span><!-- <br/> --><span class="java_separator">());</span></pre>

<p>This clever little producer method lets you inject a JDK <code class="literal">Logger</code>
without explicitly specifying the log category:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">spi</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">InjectionPoint</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">enterprise</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">.</span><span class="java_type">Produces</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LogFactory</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;</span><span class="java_type">Logger</span><span class="java_plain">&nbsp;createLogger</span><span class="java_separator">(</span><span class="java_type">InjectionPoint</span><span class="java_plain">&nbsp;injectionPoint</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">Logger</span><span class="java_separator">.</span><span class="java_plain">getLogger</span><span class="java_separator">(</span><span class="java_plain">injectionPoint</span><span class="java_separator">.</span><span class="java_plain">getMember</span><span class="java_separator">().</span><span class="java_plain">getDeclaringClass</span><span class="java_separator">().</span><span class="java_plain">getName</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>We can now write:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Logger</span><!-- <br/> --><span class="java_plain">&nbsp;log</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>Not convinced? Then here’s a second example. To inject HTTP parameters,
we need to define a qualifier type:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">HttpParam</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Nonbinding</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>We would use this qualifier type at injection points as follows:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">HttpParam</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;username&quot;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">String</span><!-- <br/> --><span class="java_plain">&nbsp;username</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">HttpParam</span><span class="java_separator">(</span><span class="java_literal">&quot;password&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;password</span><span class="java_separator">;</span></pre>

<p>The following producer method does the work:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">enterprise</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">.</span><span class="java_plain">spi</span><span class="java_separator">.</span><span class="java_type">InjectionPoint</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">HttpParams</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">HttpParam</span><span class="java_separator">(</span><span class="java_literal">&quot;&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getParamValue</span><span class="java_separator">(</span><span class="java_type">InjectionPoint</span><span class="java_plain">&nbsp;ip</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ServletRequest</span><span class="java_plain">&nbsp;request&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">ServletRequest</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">FacesContext</span><span class="java_separator">.</span><span class="java_plain">getCurrentInstance</span><span class="java_separator">().</span><span class="java_plain">getExternalContext</span><span class="java_separator">().</span><span class="java_plain">getRequest</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;request</span><span class="java_separator">.</span><span class="java_plain">getParameter</span><span class="java_separator">(</span><span class="java_plain">ip</span><span class="java_separator">.</span><span class="java_plain">getAnnotated</span><span class="java_separator">().</span><span class="java_plain">getAnnotation</span><span class="java_separator">(</span><span class="java_type">HttpParam</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">value</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Note that acquiring of the request in this example is JSF-centric. For a
more generic solution you could write your own producer for the request
and have it injected as a method parameter.</p>
<p>Note also that the <code class="literal">value()</code> member of the <code class="literal">HttpParam</code> annotation is
ignored by the container since it is annotated <code class="literal">@Nonbinding.</code></p>
<p>The container provides a built-in bean that implements the
<code class="literal">InjectionPoint</code> interface:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">InjectionPoint</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Type</span><span class="java_plain">&nbsp;getType</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getQualifiers</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Bean</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;getBean</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Member</span><span class="java_plain">&nbsp;getMember</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotated</span><span class="java_plain">&nbsp;getAnnotated</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isDelegate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isTransient</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
</div><ul class="docnav"><li class="previous"><a accesskey="p" href="_jsf_web_application_example.html"><strong>Prev</strong>Chapter 3. JSF web application example</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="_scopes_and_contexts.html"><strong>Next</strong>Chapter 5. Scopes and contexts</a></li></ul></body></html>