<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Weld - CDI Reference Implementation</title><link rel="stylesheet" href="css/seamframework-single.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p id="title"><a href="http://www.seamframework.org" class="site_href"><strong>SeamFramework.org</strong></a><a href="http://www.seamframework.org/Documentation" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d4e1"/>Weld - CDI Reference Implementation</h1></div><div><h2 class="subtitle">
CDI: Contexts and Dependency Injection for the Java EE platform
</h2></div><div><div class="authorgroup">
   <div class="author"><h3 class="author"><span class="firstname">Gavin</span> <span class="surname">King</span></h3><span class="contrib">JSR-299: Contexts and Dependency Injection for the Java EE platform Lead</span></div>
   <div class="author"><h3 class="author"><span class="firstname">Pete</span> <span class="surname">Muir</span></h3><span class="contrib">JSR-346 (CDI 1.1) Lead, Former Weld Lead</span></div>
   <div class="author"><h3 class="author"><span class="firstname">Jozef</span> <span class="surname">Hartinger</span></h3><span class="contrib">Weld Lead</span></div>
   <div class="author"><h3 class="author"><span class="firstname">Dan</span> <span class="surname">Allen</span></h3></div>
   <div class="author"><h3 class="author"><span class="firstname">David</span> <span class="surname">Allen</span></h3></div>
   <div class="othercredit"><h3 class="othercredit"><span class="firstname">Nicola</span> <span class="surname">Benaglia</span></h3><span class="contrib">Italian Translation</span></div>
   <div class="othercredit"><h3 class="othercredit"><span class="firstname">Gladys</span> <span class="surname">Guerrero</span></h3><span class="contrib">Spanish Translation</span></div>
   <div class="othercredit"><h3 class="othercredit"><span class="firstname">Eun-Ju</span> <span class="surname">Ki,</span></h3><span class="contrib">Korean Translation</span></div>
   <div class="othercredit"><h3 class="othercredit"><span class="firstname">Terry</span> <span class="surname">Chuang</span></h3><span class="contrib">Traditional Chinese Translation</span></div>
   <div class="othercredit"><h3 class="othercredit"><span class="firstname">Francesco</span> <span class="surname">Milesi</span></h3><span class="contrib">Italian Translation</span></div>
   <div class="othercredit"><h3 class="othercredit"><span class="firstname">Sean</span> <span class="surname">Wu</span></h3><span class="contrib">Simplified Chinese Translation</span></div>

</div></div><div><p class="copyright">Copyright © 
 
</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#_a_note_about_naming_and_nomenclature">A note about naming and nomenclature</a></span></dt><dt><span class="part"><a href="#_beans">I. Beans</a></span></dt><dd><dl><dt><span class="chapter"><a href="#_introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#_what_is_a_bean">1.1. What is a bean?</a></span></dt><dt><span class="section"><a href="#_getting_our_feet_wet">1.2. Getting our feet wet</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_more_about_beans">2. More about beans</a></span></dt><dd><dl><dt><span class="section"><a href="#_the_anatomy_of_a_bean">2.1. The anatomy of a bean</a></span></dt><dd><dl><dt><span class="section"><a href="#_bean_types_qualifiers_and_dependency_injection">2.1.1. Bean types, qualifiers and dependency injection</a></span></dt><dt><span class="section"><a href="#_scope">2.1.2. Scope</a></span></dt><dt><span class="section"><a href="#_el_name">2.1.3. EL name</a></span></dt><dt><span class="section"><a href="#_alternatives">2.1.4. Alternatives</a></span></dt><dt><span class="section"><a href="#_interceptor_binding_types">2.1.5. Interceptor binding types</a></span></dt></dl></dd><dt><span class="section"><a href="#_what_kinds_of_classes_are_beans">2.2. What kinds of classes are beans?</a></span></dt><dd><dl><dt><span class="section"><a href="#_managed_beans">2.2.1. Managed beans</a></span></dt><dt><span class="section"><a href="#_session_beans">2.2.2. Session beans</a></span></dt><dt><span class="section"><a href="#_producer_methods">2.2.3. Producer methods</a></span></dt><dt><span class="section"><a href="#_producer_fields">2.2.4. Producer fields</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_jsf_web_application_example">3. JSF web application example</a></span></dt><dt><span class="chapter"><a href="#_dependency_injection_and_programmatic_lookup">4. Dependency injection and programmatic lookup</a></span></dt><dd><dl><dt><span class="section"><a href="#_injection_points">4.1. Injection points</a></span></dt><dt><span class="section"><a href="#_what_gets_injected">4.2. What gets injected</a></span></dt><dt><span class="section"><a href="#_qualifier_annotations">4.3. Qualifier annotations</a></span></dt><dt><span class="section"><a href="#_the_built_in_qualifiers_literal_default_literal_and_literal_any_literal">4.4. The built-in qualifiers <code class="literal">@Default</code> and <code class="literal">@Any</code></a></span></dt><dt><span class="section"><a href="#_qualifiers_with_members">4.5. Qualifiers with members</a></span></dt><dt><span class="section"><a href="#_multiple_qualifiers">4.6. Multiple qualifiers</a></span></dt><dt><span class="section"><a href="#alternatives">4.7. Alternatives</a></span></dt><dt><span class="section"><a href="#_fixing_unsatisfied_and_ambiguous_dependencies">4.8. Fixing unsatisfied and ambiguous dependencies</a></span></dt><dt><span class="section"><a href="#_client_proxies">4.9. Client proxies</a></span></dt><dt><span class="section"><a href="#_obtaining_a_contextual_instance_by_programmatic_lookup">4.10. Obtaining a contextual instance by programmatic lookup</a></span></dt><dt><span class="section"><a href="#_the_literal_injectionpoint_literal_object">4.11. The <code class="literal">InjectionPoint</code> object</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_scopes_and_contexts">5. Scopes and contexts</a></span></dt><dd><dl><dt><span class="section"><a href="#_scope_types">5.1. Scope types</a></span></dt><dt><span class="section"><a href="#_built_in_scopes">5.2. Built-in scopes</a></span></dt><dt><span class="section"><a href="#_the_conversation_scope">5.3. The conversation scope</a></span></dt><dd><dl><dt><span class="section"><a href="#_conversation_demarcation">5.3.1. Conversation demarcation</a></span></dt><dt><span class="section"><a href="#_conversation_propagation">5.3.2. Conversation propagation</a></span></dt><dt><span class="section"><a href="#_conversation_timeout">5.3.3. Conversation timeout</a></span></dt><dt><span class="section"><a href="#_cdi_conversation_filter">5.3.4. CDI Conversation filter</a></span></dt><dt><span class="section"><a href="#_lazy_and_eager_conversation_context_initialization">5.3.5. Lazy and eager conversation context initialization</a></span></dt></dl></dd><dt><span class="section"><a href="#_the_singleton_pseudo_scope">5.4. The singleton pseudo-scope</a></span></dt><dt><span class="section"><a href="#_the_dependent_pseudo_scope">5.5. The dependent pseudo-scope</a></span></dt><dt><span class="section"><a href="#_the_literal_new_literal_qualifier">5.6. The <code class="literal">@New</code> qualifier</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#_getting_start_with_weld_the_cdi_reference_implementation">II. Getting Start with Weld, the CDI Reference Implementation</a></span></dt><dd><dl><dt><span class="chapter"><a href="#_getting_started_with_weld">6. Getting started with Weld</a></span></dt><dd><dl><dt><span class="section"><a href="#_prerequisites">6.1. Prerequisites</a></span></dt><dt><span class="section"><a href="#_deploying_to_wildfly">6.2. Deploying to WildFly</a></span></dt><dt><span class="section"><a href="#_deploying_to_glassfish">6.3. Deploying to GlassFish</a></span></dt><dt><span class="section"><a href="#_deploying_to_apache_tomcat">6.4. Deploying to Apache Tomcat</a></span></dt><dt><span class="section"><a href="#_deploying_to_jetty">6.5. Deploying to Jetty</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_diving_into_the_weld_examples">7. Diving into the Weld examples</a></span></dt><dd><dl><dt><span class="section"><a href="#_the_numberguess_example_in_depth">7.1. The numberguess example in depth</a></span></dt><dd><dl><dt><span class="section"><a href="#_the_numberguess_example_in_apache_tomcat_or_jetty">7.1.1. The numberguess example in Apache Tomcat or Jetty</a></span></dt></dl></dd><dt><span class="section"><a href="#_the_numberguess_example_for_java_se_with_swing">7.2. The numberguess example for Java SE with Swing</a></span></dt><dd><dl><dt><span class="section"><a href="#_creating_the_eclipse_project">7.2.1. Creating the Eclipse project</a></span></dt><dt><span class="section"><a href="#_running_the_example_from_eclipse">7.2.2. Running the example from Eclipse</a></span></dt><dt><span class="section"><a href="#_running_the_example_from_the_command_line">7.2.3. Running the example from the command line</a></span></dt><dt><span class="section"><a href="#_understanding_the_code">7.2.4. Understanding the code</a></span></dt></dl></dd><dt><span class="section"><a href="#_the_translator_example_in_depth">7.3. The translator example in depth</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#_loose_coupling_with_strong_typing">III. Loose coupling with strong typing</a></span></dt><dd><dl><dt><span class="chapter"><a href="#producer_methods">8. Producer methods</a></span></dt><dd><dl><dt><span class="section"><a href="#_scope_of_a_producer_method">8.1. Scope of a producer method</a></span></dt><dt><span class="section"><a href="#_injection_into_producer_methods">8.2. Injection into producer methods</a></span></dt><dt><span class="section"><a href="#_use_of_literal_new_literal_with_producer_methods">8.3. Use of <code class="literal">@New</code> with producer methods</a></span></dt><dt><span class="section"><a href="#_disposer_methods">8.4. Disposer methods</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_interceptors">9. Interceptors</a></span></dt><dd><dl><dt><span class="section"><a href="#_interceptor_bindings">9.1. Interceptor bindings</a></span></dt><dt><span class="section"><a href="#_implementing_interceptors">9.2. Implementing interceptors</a></span></dt><dt><span class="section"><a href="#_enabling_interceptors">9.3. Enabling interceptors</a></span></dt><dt><span class="section"><a href="#_interceptor_bindings_with_members">9.4. Interceptor bindings with members</a></span></dt><dt><span class="section"><a href="#_multiple_interceptor_binding_annotations">9.5. Multiple interceptor binding annotations</a></span></dt><dt><span class="section"><a href="#_interceptor_binding_type_inheritance">9.6. Interceptor binding type inheritance</a></span></dt><dt><span class="section"><a href="#_use_of_literal_interceptors_literal">9.7. Use of <code class="literal">@Interceptors</code></a></span></dt></dl></dd><dt><span class="chapter"><a href="#_decorators">10. Decorators</a></span></dt><dd><dl><dt><span class="section"><a href="#_delegate_object">10.1. Delegate object</a></span></dt><dt><span class="section"><a href="#_enabling_decorators">10.2. Enabling decorators</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_events">11. Events</a></span></dt><dd><dl><dt><span class="section"><a href="#_event_payload">11.1. Event payload</a></span></dt><dt><span class="section"><a href="#_event_observers">11.2. Event observers</a></span></dt><dt><span class="section"><a href="#_event_producers">11.3. Event producers</a></span></dt><dt><span class="section"><a href="#_conditional_observer_methods">11.4. Conditional observer methods</a></span></dt><dt><span class="section"><a href="#_event_qualifiers_with_members">11.5. Event qualifiers with members</a></span></dt><dt><span class="section"><a href="#_multiple_event_qualifiers">11.6. Multiple event qualifiers</a></span></dt><dt><span class="section"><a href="#_transactional_observers">11.7. Transactional observers</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_stereotypes">12. Stereotypes</a></span></dt><dd><dl><dt><span class="section"><a href="#_default_scope_for_a_stereotype">12.1. Default scope for a stereotype</a></span></dt><dt><span class="section"><a href="#_interceptor_bindings_for_stereotypes">12.2. Interceptor bindings for stereotypes</a></span></dt><dt><span class="section"><a href="#_name_defaulting_with_stereotypes">12.3. Name defaulting with stereotypes</a></span></dt><dt><span class="section"><a href="#_alternative_stereotypes">12.4. Alternative stereotypes</a></span></dt><dt><span class="section"><a href="#_stereotype_stacking">12.5. Stereotype stacking</a></span></dt><dt><span class="section"><a href="#_built_in_stereotypes">12.6. Built-in stereotypes</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_specialization_inheritance_and_alternatives">13. Specialization, inheritance and alternatives</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_alternative_stereotypes">13.1. Using alternative stereotypes</a></span></dt><dt><span class="section"><a href="#_a_minor_problem_with_alternatives">13.2. A minor problem with alternatives</a></span></dt><dt><span class="section"><a href="#_using_specialization">13.3. Using specialization</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_java_ee_component_environment_resources">14. Java EE component environment resources</a></span></dt><dd><dl><dt><span class="section"><a href="#_defining_a_resource">14.1. Defining a resource</a></span></dt><dt><span class="section"><a href="#_typesafe_resource_injection">14.2. Typesafe resource injection</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#_cdi_and_the_java_ee_ecosystem">IV. CDI and the Java EE ecosystem</a></span></dt><dd><dl><dt><span class="chapter"><a href="#_java_ee_integration">15. Java EE integration</a></span></dt><dd><dl><dt><span class="section"><a href="#_built_in_beans">15.1. Built-in beans</a></span></dt><dt><span class="section"><a href="#_injecting_java_ee_resources_into_a_bean">15.2. Injecting Java EE resources into a bean</a></span></dt><dt><span class="section"><a href="#_calling_a_bean_from_a_servlet">15.3. Calling a bean from a servlet</a></span></dt><dt><span class="section"><a href="#_calling_a_bean_from_a_message_driven_bean">15.4. Calling a bean from a message-driven bean</a></span></dt><dt><span class="section"><a href="#_jms_endpoints">15.5. JMS endpoints</a></span></dt><dt><span class="section"><a href="#packaging-and-deployment">15.6. Packaging and deployment</a></span></dt><dd><dl><dt><span class="section"><a href="#_explicit_bean_archive">15.6.1. Explicit bean archive</a></span></dt><dt><span class="section"><a href="#_implicit_bean_archive">15.6.2. Implicit bean archive</a></span></dt><dt><span class="section"><a href="#_what_archive_is_not_a_bean_archive">15.6.3. What archive is not a bean archive</a></span></dt><dt><span class="section"><a href="#_embeddable_ejb_container">15.6.4. Embeddable EJB container</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_portable_extensions">16. Portable extensions</a></span></dt><dd><dl><dt><span class="section"><a href="#_creating_an_literal_extension_literal">16.1. Creating an <code class="literal">Extension</code></a></span></dt><dt><span class="section"><a href="#_container_lifecycle_events">16.2. Container lifecycle events</a></span></dt><dt><span class="section"><a href="#_the_literal_beanmanager_literal_object">16.3. The <code class="literal">BeanManager</code> object</a></span></dt><dt><span class="section"><a href="#_the_literal_cdi_literal_class">16.4. The <code class="literal">CDI</code> class</a></span></dt><dt><span class="section"><a href="#_the_literal_injectiontarget_literal_interface">16.5. The <code class="literal">InjectionTarget</code> interface</a></span></dt><dt><span class="section"><a href="#_the_literal_bean_literal_interface">16.6. The <code class="literal">Bean</code> interface</a></span></dt><dt><span class="section"><a href="#_registering_a_literal_bean_literal">16.7. Registering a <code class="literal">Bean</code></a></span></dt><dt><span class="section"><a href="#_wrapping_an_literal_annotatedtype_literal">16.8. Wrapping an <code class="literal">AnnotatedType</code></a></span></dt><dt><span class="section"><a href="#_overriding_attributes_of_a_bean_by_wrapping_literal_beanattributes_literal">16.9. Overriding attributes of a bean by wrapping <code class="literal">BeanAttributes</code></a></span></dt><dt><span class="section"><a href="#_wrapping_an_literal_injectiontarget_literal">16.10. Wrapping an <code class="literal">InjectionTarget</code></a></span></dt><dt><span class="section"><a href="#_overriding_literal_injectionpoint_literal">16.11. Overriding <code class="literal">InjectionPoint</code></a></span></dt><dt><span class="section"><a href="#_manipulating_interceptors_decorators_and_alternatives_enabled_for_an_application">16.12. Manipulating interceptors, decorators and alternatives enabled for an application</a></span></dt><dt><span class="section"><a href="#_the_literal_context_literal_and_literal_alterablecontext_literal_interfaces">16.13. The <code class="literal">Context</code> and <code class="literal">AlterableContext</code> interfaces</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_next_steps">17. Next steps</a></span></dt></dl></dd><dt><span class="part"><a href="#_weld_reference_guide">V. Weld Reference Guide</a></span></dt><dd><dl><dt><span class="chapter"><a href="#_application_servers_and_environments_supported_by_weld">18. Application servers and environments supported by Weld</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_weld_with_wildfly">18.1. Using Weld with WildFly</a></span></dt><dt><span class="section"><a href="#_glassfish">18.2. GlassFish</a></span></dt><dt><span class="section"><a href="#_servlet_containers_such_as_tomcat_or_jetty">18.3. Servlet containers (such as Tomcat or Jetty)</a></span></dt><dd><dl><dt><span class="section"><a href="#_tomcat">18.3.1. Tomcat</a></span></dt><dt><span class="section"><a href="#_jetty">18.3.2. Jetty</a></span></dt><dt><span class="section"><a href="#_bean_archive_isolation">18.3.3. Bean Archive Isolation</a></span></dt><dt><span class="section"><a href="#_implicit_bean_archive_support">18.3.4. Implicit Bean Archive Support</a></span></dt></dl></dd><dt><span class="section"><a href="#_java_se">18.4. Java SE</a></span></dt><dd><dl><dt><span class="section"><a href="#_cdi_se_module">18.4.1. CDI SE Module</a></span></dt><dt><span class="section"><a href="#_bootstrapping_cdi_se">18.4.2. Bootstrapping CDI SE</a></span></dt><dt><span class="section"><a href="#_thread_context">18.4.3. Thread Context</a></span></dt><dt><span class="section"><a href="#_setting_the_classpath">18.4.4. Setting the Classpath</a></span></dt><dt><span class="section"><a href="#_bean_archive_isolation_2">18.4.5. Bean Archive Isolation</a></span></dt><dt><span class="section"><a href="#_implicit_bean_archive_support_2">18.4.6. Implicit Bean Archive Support</a></span></dt></dl></dd><dt><span class="section"><a href="#_osgi">18.5. OSGi</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_context_management">19. Context Management</a></span></dt><dd><dl><dt><span class="section"><a href="#_managing_the_built_in_contexts">19.1. Managing the built in contexts</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_configuration">20. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#_excluding_classes_from_scanning_and_deployment">20.1. Excluding classes from scanning and deployment</a></span></dt><dt><span class="section"><a href="#_concurrent_deployment_configuration">20.2. Concurrent deployment configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#_thread_pool_configuration">20.2.1. Thread pool configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#_non_portable_mode_during_application_initialization">20.3. Non-portable mode during application initialization</a></span></dt><dt><span class="section"><a href="#_mapping_cdi_contexts_to_http_requests">20.4. Mapping CDI contexts to HTTP requests</a></span></dt><dt><span class="section"><a href="#_bounding_the_cache_size_for_resolved_injection_points">20.5. Bounding the cache size for resolved injection points</a></span></dt></dl></dd><dt><span class="appendix"><a href="#_integrating_weld_into_other_environments">A. Integrating Weld into other environments</a></span></dt><dd><dl><dt><span class="section"><a href="#_the_weld_spi">A.1. The Weld SPI</a></span></dt><dd><dl><dt><span class="section"><a href="#_deployment_structure">A.1.1. Deployment structure</a></span></dt><dt><span class="section"><a href="#_ejb_descriptors">A.1.2. EJB descriptors</a></span></dt><dt><span class="section"><a href="#_ee_resource_injection_and_resolution_services">A.1.3. EE resource injection and resolution services</a></span></dt><dt><span class="section"><a href="#_ejb_services">A.1.4. EJB services</a></span></dt><dt><span class="section"><a href="#_jpa_services">A.1.5. JPA services</a></span></dt><dt><span class="section"><a href="#_transaction_services">A.1.6. Transaction Services</a></span></dt><dt><span class="section"><a href="#_resource_services">A.1.7. Resource Services</a></span></dt><dt><span class="section"><a href="#_web_service_injection_services">A.1.8. Web Service Injection Services</a></span></dt><dt><span class="section"><a href="#_injection_services">A.1.9. Injection Services</a></span></dt><dt><span class="section"><a href="#_security_services">A.1.10. Security Services</a></span></dt><dt><span class="section"><a href="#_the_bean_store">A.1.11. The bean store</a></span></dt><dt><span class="section"><a href="#_the_application_context">A.1.12. The application context</a></span></dt><dt><span class="section"><a href="#_initialization_and_shutdown">A.1.13. Initialization and shutdown</a></span></dt><dt><span class="section"><a href="#_resource_loading">A.1.14. Resource loading</a></span></dt><dt><span class="section"><a href="#_annotationdiscovery">A.1.15. AnnotationDiscovery</a></span></dt><dt><span class="section"><a href="#_classfileservices">A.1.16. ClassFileServices</a></span></dt></dl></dd><dt><span class="section"><a href="#_the_contract_with_the_container">A.2. The contract with the container</a></span></dt><dd><dl><dt><span class="section"><a href="#_classloader_isolation">A.2.1. Classloader isolation</a></span></dt><dt><span class="section"><a href="#_servlet">A.2.2. Servlet</a></span></dt><dt><span class="section"><a href="#_cdi_conversation_filter_2">A.2.3. CDI Conversation Filter</a></span></dt><dt><span class="section"><a href="#_jsf">A.2.4. JSF</a></span></dt><dt><span class="section"><a href="#_jsp">A.2.5. JSP</a></span></dt><dt><span class="section"><a href="#_session_bean_interceptor">A.2.6. Session Bean Interceptor</a></span></dt><dt><span class="section"><a href="#_the_literal_weld_core_jar_literal">A.2.7. The <code class="literal">weld-core.jar</code></a></span></dt><dt><span class="section"><a href="#_binding_the_manager_in_jndi">A.2.8. Binding the manager in JNDI</a></span></dt><dt><span class="section"><a href="#__literal_cdiprovider_literal">A.2.9. <code class="literal">CDIProvider</code></a></span></dt><dt><span class="section"><a href="#_performing_cdi_injection_on_java_ee_component_classes">A.2.10. Performing CDI injection on Java EE component classes</a></span></dt></dl></dd><dt><span class="section"><a href="#_migration_notes">A.3. Migration notes</a></span></dt><dd><dl><dt><span class="section"><a href="#_migration_from_weld_1_x_to_2_0">A.3.1. Migration from Weld 1.x to 2.0</a></span></dt><dt><span class="section"><a href="#_migration_from_weld_2_0_to_2_1">A.3.2. Migration from Weld 2.0 to 2.1</a></span></dt><dt><span class="section"><a href="#_migration_from_weld_2_1_to_2_2">A.3.3. Migration from Weld 2.1 to 2.2</a></span></dt></dl></dd></dl></dd></dl></dd></dl></div>

<div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_a_note_about_naming_and_nomenclature"/>A note about naming and nomenclature</h2></div></div></div>

<p>Throughout this document, mentions of JSR-299 and JSR-346 appear. JSR is
a document of a proposed specification used in the Java Community
Process (JCP). JSRs are somewhat analogous to RFCs used by IETF. JSR-299
and JSR-346 are the JCP specification names for the 1.0 and 1.1 versions
of CDI, respectively.</p>
<p>Shortly before the final draft of JSR-299 was submitted, the
specification changed its name from "Web Beans" to "Java Contexts and
Dependency Injection for the Java EE platform", abbreviated CDI. For a
brief period after the renaming, the reference implementation adopted
the name "Web Beans". However, this ended up causing more confusion than
it solved and Red Hat decided to change the name of the reference
implementation to "Weld". You may still find other documentation, blogs,
forum posts, etc. that use the old nomenclature. Please update any
references you can. The naming game is over.</p>
<p>You’ll also find that some of the functionality that once existed in the
specification is now missing, such as defining beans in XML. These
features will be available as portable extensions.</p>
<p>Note that this reference guide was started while changes were still
being made to the specification. We’ve done our best to update it for
accuracy. If you discover a conflict between what is written in this
guide and the specification, the specification is the authority—assume
it is correct. If you believe you have found an error in the
specification, please report it to the CDI EG.</p>
</div>
<div class="part" lang="en-US"><div class="titlepage"><div><div><h1 class="title"><a id="_beans"/>Part I. Beans</h1></div></div></div>

<div class="partintro" lang="en-US"><div/>
<p>The <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://jcp.org/en/jsr/detail?id=346">CDI</a> specification defines a set
of complementary services that help improve the structure of application
code. CDI layers an enhanced lifecycle and interaction model over
existing Java component types, including managed beans and Enterprise
Java Beans. The CDI services provide:</p>
<div class="itemizedlist"><ul><li>
an improved lifecycle for stateful objects, bound to well-defined
<span class="emphasis"><em>contexts</em></span>,
</li><li>
a typesafe approach to <span class="emphasis"><em>dependency injection</em></span>,
</li><li>
object interaction via an <span class="emphasis"><em>event notification facility</em></span>,
</li><li>
a better approach to binding <span class="emphasis"><em>interceptors</em></span> to objects, along with a
new kind of interceptor, called a <span class="emphasis"><em>decorator</em></span>, that is more appropriate
for use in solving business problems, and
</li><li>
an <span class="emphasis"><em>SPI</em></span> for developing portable extensions to the container.
</li></ul></div>

<p>The CDI services are a core aspect of the Java EE platform and include
full support for Java EE modularity and the Java EE component
architecture. But the specification does not limit the use of CDI to the
Java EE environment. In the Java SE environment, the services might be
provided by a standalone CDI implementation like Weld (see <a href="#_cdi_se_module" title="18.4.1. CDI SE Module">Section 18.4.1, “CDI SE Module”</a>), or even
by a container that also implements the subset of EJB defined for
embedded usage by the EJB 3.2 specification. CDI is especially useful in
the context of web application development, but the problems it solves
are general development concerns and it is therefore applicable to a
wide variety of application.</p>
<p>An object bound to a lifecycle context is called a bean. CDI includes
built-in support for several different kinds of bean, including the
following Java EE component types:</p>
<div class="itemizedlist"><ul><li>
managed beans, and
</li><li>
EJB session beans.
</li></ul></div>

<p>Both managed beans and EJB session beans may inject other beans. But
some other objects, which are not themselves beans in the sense used
here, may also have beans injected via CDI. In the Java EE platform, the
following kinds of component may have beans injected:</p>
<div class="itemizedlist"><ul><li>
message-driven beans,
</li><li>
interceptors,
</li><li>
servlets, servlet filters and servlet event listeners,
</li><li>
JAX-WS service endpoints and handlers,
</li><li>
JAX-RS resources, providers and <code class="literal">javax.ws.rs.core.Application</code>
subclasses, and
</li><li>
JSP tag handlers and tag library event listeners.
</li></ul></div>

<p>CDI relieves the user of an unfamiliar API of the need to answer the
following questions:</p>
<div class="itemizedlist"><ul><li>
What is the lifecycle of this object?
</li><li>
How many simultaneous clients can it have?
</li><li>
Is it multithreaded?
</li><li>
How do I get access to it from a client?
</li><li>
Do I need to explicitly destroy it?
</li><li>
Where should I keep the reference to it when I’m not currently using
it?
</li><li>
How can I define an alternative implementation, so that the
implementation can vary at deployment time?
</li><li>
How should I go about sharing this object between other objects?
</li></ul></div>

<p>CDI is more than a framework. It’s a whole, rich programming model. The
<span class="emphasis"><em>theme</em></span> of CDI is <span class="emphasis"><em>loose-coupling with strong typing</em></span>. Let’s study what
that phrase means.</p>
<p>A bean specifies only the type and semantics of other beans it depends
upon. It need not be aware of the actual lifecycle, concrete
implementation, threading model or other clients of any bean it
interacts with. Even better, the concrete implementation, lifecycle and
threading model of a bean may vary according to the deployment scenario,
without affecting any client. This loose-coupling makes your code easier
to maintain.</p>
<p>Events, interceptors and decorators enhance the loose-coupling inherent
in this model:</p>
<div class="itemizedlist"><ul><li>
<span class="emphasis"><em>event notifications</em></span> decouple event producers from event consumers,
</li><li>
<span class="emphasis"><em>interceptors</em></span> decouple technical concerns from business logic, and
</li><li>
<span class="emphasis"><em>decorators</em></span> allow business concerns to be compartmentalized.
</li></ul></div>

<p>What’s even more powerful (and comforting) is that CDI provides all
these facilities in a <span class="emphasis"><em>typesafe</em></span> way. CDI never relies on string-based
identifiers to determine how collaborating objects fit together.
Instead, CDI uses the typing information that is already available in
the Java object model, augmented using a new programming pattern, called
<span class="emphasis"><em>qualifier annotations</em></span>, to wire together beans, their dependencies,
their interceptors and decorators, and their event consumers. Usage of
XML descriptors is minimized to truly deployment-specific information.</p>
<p>But CDI isn’t a restrictive programming model. It doesn’t tell you how
you should to structure your application into layers, how you should
handle persistence, or what web framework you have to use. You’ll have
to decide those kinds of things for yourself.</p>
<p>CDI even provides a comprehensive SPI, allowing other kinds of object
defined by future Java EE specifications or by third-party frameworks to
be cleanly integrated with CDI, take advantage of the CDI services, and
interact with any other kind of bean.</p>
<p>CDI was influenced by a number of existing Java frameworks, including
Seam, Guice and Spring. However, CDI has its own, very distinct,
character: more typesafe than Seam, more stateful and less XML-centric
than Spring, more web and enterprise-application capable than Guice. But
it couldn’t have been any of these without inspiration from the
frameworks mentioned and <span class="emphasis"><em>lots</em></span> of collaboration and hard work by the
JSR-299 and JSR-346 Expert Groups (EG).</p>
<p>Finally, CDI is a <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://jcp.org">Java Community Process</a> (JCP) standard.
Java EE 7 requires that all compliant application servers provide
support for JSR-346 (even in the web profile).</p>
<div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#_introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#_what_is_a_bean">1.1. What is a bean?</a></span></dt><dt><span class="section"><a href="#_getting_our_feet_wet">1.2. Getting our feet wet</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_more_about_beans">2. More about beans</a></span></dt><dd><dl><dt><span class="section"><a href="#_the_anatomy_of_a_bean">2.1. The anatomy of a bean</a></span></dt><dd><dl><dt><span class="section"><a href="#_bean_types_qualifiers_and_dependency_injection">2.1.1. Bean types, qualifiers and dependency injection</a></span></dt><dt><span class="section"><a href="#_scope">2.1.2. Scope</a></span></dt><dt><span class="section"><a href="#_el_name">2.1.3. EL name</a></span></dt><dt><span class="section"><a href="#_alternatives">2.1.4. Alternatives</a></span></dt><dt><span class="section"><a href="#_interceptor_binding_types">2.1.5. Interceptor binding types</a></span></dt></dl></dd><dt><span class="section"><a href="#_what_kinds_of_classes_are_beans">2.2. What kinds of classes are beans?</a></span></dt><dd><dl><dt><span class="section"><a href="#_managed_beans">2.2.1. Managed beans</a></span></dt><dt><span class="section"><a href="#_session_beans">2.2.2. Session beans</a></span></dt><dt><span class="section"><a href="#_producer_methods">2.2.3. Producer methods</a></span></dt><dt><span class="section"><a href="#_producer_fields">2.2.4. Producer fields</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_jsf_web_application_example">3. JSF web application example</a></span></dt><dt><span class="chapter"><a href="#_dependency_injection_and_programmatic_lookup">4. Dependency injection and programmatic lookup</a></span></dt><dd><dl><dt><span class="section"><a href="#_injection_points">4.1. Injection points</a></span></dt><dt><span class="section"><a href="#_what_gets_injected">4.2. What gets injected</a></span></dt><dt><span class="section"><a href="#_qualifier_annotations">4.3. Qualifier annotations</a></span></dt><dt><span class="section"><a href="#_the_built_in_qualifiers_literal_default_literal_and_literal_any_literal">4.4. The built-in qualifiers <code class="literal">@Default</code> and <code class="literal">@Any</code></a></span></dt><dt><span class="section"><a href="#_qualifiers_with_members">4.5. Qualifiers with members</a></span></dt><dt><span class="section"><a href="#_multiple_qualifiers">4.6. Multiple qualifiers</a></span></dt><dt><span class="section"><a href="#alternatives">4.7. Alternatives</a></span></dt><dt><span class="section"><a href="#_fixing_unsatisfied_and_ambiguous_dependencies">4.8. Fixing unsatisfied and ambiguous dependencies</a></span></dt><dt><span class="section"><a href="#_client_proxies">4.9. Client proxies</a></span></dt><dt><span class="section"><a href="#_obtaining_a_contextual_instance_by_programmatic_lookup">4.10. Obtaining a contextual instance by programmatic lookup</a></span></dt><dt><span class="section"><a href="#_the_literal_injectionpoint_literal_object">4.11. The <code class="literal">InjectionPoint</code> object</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_scopes_and_contexts">5. Scopes and contexts</a></span></dt><dd><dl><dt><span class="section"><a href="#_scope_types">5.1. Scope types</a></span></dt><dt><span class="section"><a href="#_built_in_scopes">5.2. Built-in scopes</a></span></dt><dt><span class="section"><a href="#_the_conversation_scope">5.3. The conversation scope</a></span></dt><dd><dl><dt><span class="section"><a href="#_conversation_demarcation">5.3.1. Conversation demarcation</a></span></dt><dt><span class="section"><a href="#_conversation_propagation">5.3.2. Conversation propagation</a></span></dt><dt><span class="section"><a href="#_conversation_timeout">5.3.3. Conversation timeout</a></span></dt><dt><span class="section"><a href="#_cdi_conversation_filter">5.3.4. CDI Conversation filter</a></span></dt><dt><span class="section"><a href="#_lazy_and_eager_conversation_context_initialization">5.3.5. Lazy and eager conversation context initialization</a></span></dt></dl></dd><dt><span class="section"><a href="#_the_singleton_pseudo_scope">5.4. The singleton pseudo-scope</a></span></dt><dt><span class="section"><a href="#_the_dependent_pseudo_scope">5.5. The dependent pseudo-scope</a></span></dt><dt><span class="section"><a href="#_the_literal_new_literal_qualifier">5.6. The <code class="literal">@New</code> qualifier</a></span></dt></dl></dd></dl></div></div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_introduction"/>Chapter 1. Introduction</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_what_is_a_bean">1.1. What is a bean?</a></span></dt><dt><span class="section"><a href="#_getting_our_feet_wet">1.2. Getting our feet wet</a></span></dt></dl></div>

<p>So you’re keen to get started writing your first bean? Or perhaps you’re
skeptical, wondering what kinds of hoops the CDI specification will make
you jump through! The good news is that you’ve probably already written
and used hundreds, perhaps thousands of beans. CDI just makes it easier
to actually use them to build an application!</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_what_is_a_bean"/>1.1. What is a bean?</h2></div></div></div>

<p>A bean is exactly what you think it is. Only now, it has a true identity
in the container environment.</p>
<p>Prior to Java EE 6, there was no clear definition of the term "bean" in
the Java EE platform. Of course, we’ve been calling Java classes used in
web and enterprise applications "beans" for years. There were even a
couple of different kinds of things called "beans" in EE specifications,
including EJB beans and JSF managed beans. Meanwhile, other third-party
frameworks such as Spring and Seam introduced their own ideas of what it
meant to be a "bean". What we’ve been missing is a common definition.</p>
<p>Java EE 6 finally laid down that common definition in the Managed Beans
specification. Managed Beans are defined as container-managed objects
with minimal programming restrictions, otherwise known by the acronym
POJO (Plain Old Java Object). They support a small set of basic
services, such as resource injection, lifecycle callbacks and
interceptors. Companion specifications, such as EJB and CDI, build on
this basic model. But, <span class="emphasis"><em>at last</em></span>, there’s a uniform concept of a bean
and a lightweight component model that’s aligned across the Java EE
platform.</p>
<p>With very few exceptions, almost every concrete Java class that has a
constructor with no parameters (or a constructor designated with the
annotation <code class="literal">@Inject</code>) is a bean. This includes every JavaBean and every
EJB session bean. If you’ve already got some JavaBeans or session beans
lying around, they’re already beans—you won’t need any additional
special metadata.</p>
<p>The JavaBeans and EJBs you’ve been writing every day, up until now, have
not been able to take advantage of the new services defined by the CDI
specification. But you’ll be able to use every one of them with
CDI—allowing the container to create and destroy instances of your beans
and associate them with a designated context, injecting them into other
beans, using them in EL expressions, specializing them with qualifier
annotations, even adding interceptors and decorators to them—without
modifying your existing code. At most, you’ll need to add some
annotations.</p>
<p>Now let’s see how to create your first bean that actually uses CDI.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_getting_our_feet_wet"/>1.2. Getting our feet wet</h2></div></div></div>

<p>Suppose that we have two existing Java classes that we’ve been using for
years in various applications. The first class parses a string into a
list of sentences:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SentenceParser</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;parse</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;text</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The second existing class is a stateless session bean front-end for an
external system that is able to translate sentences from one language to
another:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SentenceTranslator</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Translator</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;translate</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;sentence</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Where <code class="literal">Translator</code> is the EJB local interface:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Local</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Translator</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;translate</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;sentence</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Unfortunately, we don’t have a class that translates whole text
documents. So let’s write a bean for this job:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">TextTranslator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">SentenceParser</span><span class="java_plain">&nbsp;sentenceParser</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Translator</span><span class="java_plain">&nbsp;sentenceTranslator</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">TextTranslator</span><span class="java_separator">(</span><span class="java_type">SentenceParser</span><span class="java_plain">&nbsp;sentenceParser</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Translator</span><span class="java_plain">&nbsp;sentenceTranslator</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">sentenceParser&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;sentenceParser</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">sentenceTranslator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;sentenceTranslator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;translate</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;text</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_plain">&nbsp;sb&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;sentence</span><span class="java_operator">:</span><span class="java_plain">&nbsp;sentenceParser</span><span class="java_separator">.</span><span class="java_plain">parse</span><span class="java_separator">(</span><span class="java_plain">text</span><span class="java_separator">))</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">sentenceTranslator</span><span class="java_separator">.</span><span class="java_plain">translate</span><span class="java_separator">(</span><span class="java_plain">sentence</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;sb</span><span class="java_separator">.</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>But wait! <code class="literal">TextTranslator</code> does not have a constructor with no
parameters! Is it still a bean? If you remember, a class that does not
have a constructor with no parameters can still be a bean if it has a
constructor annotated <code class="literal">@Inject</code>.</p>
<p>As you’ve guessed, the <code class="literal">@Inject</code> annotation has something to do with
dependency injection! <code class="literal">@Inject</code> may be applied to a constructor or
method of a bean, and tells the container to call that constructor or
method when instantiating the bean. The container will inject other
beans into the parameters of the constructor or method.</p>
<p>We may obtain an instance of <code class="literal">TextTranslator</code> by injecting it into a
constructor, method or field of a bean, or a field or method of a Java
EE component class such as a servlet. The container chooses the object
to be injected based on the type of the injection point, not the name of
the field, method or parameter.</p>
<p>Let’s create a UI controller bean that uses field injection to obtain an
instance of the <code class="literal">TextTranslator</code>, translating the text entered by a
user:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Named</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">RequestScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">TranslateController</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">TextTranslator</span><span class="java_plain">&nbsp;textTranslator</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO1-1"/><img src="images/seamframework/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;inputText</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;translation</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;JSF&nbsp;action&nbsp;method</span><span class="java_separator">,</span><span class="java_plain">&nbsp;perhaps</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;translate</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;translation&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;textTranslator</span><span class="java_separator">.</span><span class="java_plain">translate</span><span class="java_separator">(</span><span class="java_plain">inputText</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getInputText</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;inputText</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setInputText</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;text</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">inputText&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;text</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getTranslation</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;translation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#CO1-1"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>Field injection of <code class="literal">TextTranslator</code> instance</p>
    
  </td></tr></table></div>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2>
<p>Notice the controller bean is request-scoped and named. Since this
combination is so common in web applications, there’s a built-in
annotation for it in CDI that we could have used as a shorthand. When
the (stereotype) annotation <code class="literal">@Model</code> is declared on a class, it creates
a request-scoped and named bean.</p>
</div>

<p>Alternatively, we may obtain an instance of <code class="literal">TextTranslator</code>
programmatically from an injected instance of <code class="literal">Instance</code>, parameterized
with the bean type:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Instance</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">.</span><span class="java_type">Inject</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_separator">....</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">Instance</span><span class="java_operator">&lt;</span><span class="java_type">TextTranslator</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;textTranslatorInstance</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;translate</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;textTranslatorInstance</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">().</span><span class="java_plain">translate</span><span class="java_separator">(</span><span class="java_plain">inputText</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Notice that it isn’t necessary to create a getter or setter method to
inject one bean into another. CDI can access an injected field directly
(even if it’s private!), which sometimes helps eliminate some wasteful
code. The name of the field is arbitrary. It’s the field’s type that
determines what is injected.</p>
<p>At system initialization time, the container must validate that exactly
one bean exists which satisfies each injection point. In our example, if
no implementation of <code class="literal">Translator</code> is available—if the
<code class="literal">SentenceTranslator</code> EJB was not deployed—the container would inform us
of an <span class="emphasis"><em>unsatisfied dependency</em></span>. If more than one implementation of
<code class="literal">Translator</code> were available, the container would inform us of the
<span class="emphasis"><em>ambiguous dependency</em></span>.</p>
<p>Before we get too deep in the details, let’s pause and examine a bean’s
anatomy. What aspects of the bean are significant, and what gives it its
identity? Instead of just giving examples of beans, we’re going to
define what <span class="emphasis"><em>makes</em></span> something a bean.</p>
</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_more_about_beans"/>Chapter 2. More about beans</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_the_anatomy_of_a_bean">2.1. The anatomy of a bean</a></span></dt><dd><dl><dt><span class="section"><a href="#_bean_types_qualifiers_and_dependency_injection">2.1.1. Bean types, qualifiers and dependency injection</a></span></dt><dt><span class="section"><a href="#_scope">2.1.2. Scope</a></span></dt><dt><span class="section"><a href="#_el_name">2.1.3. EL name</a></span></dt><dt><span class="section"><a href="#_alternatives">2.1.4. Alternatives</a></span></dt><dt><span class="section"><a href="#_interceptor_binding_types">2.1.5. Interceptor binding types</a></span></dt></dl></dd><dt><span class="section"><a href="#_what_kinds_of_classes_are_beans">2.2. What kinds of classes are beans?</a></span></dt><dd><dl><dt><span class="section"><a href="#_managed_beans">2.2.1. Managed beans</a></span></dt><dt><span class="section"><a href="#_session_beans">2.2.2. Session beans</a></span></dt><dt><span class="section"><a href="#_producer_methods">2.2.3. Producer methods</a></span></dt><dt><span class="section"><a href="#_producer_fields">2.2.4. Producer fields</a></span></dt></dl></dd></dl></div>

<p>A bean is usually an application class that contains business logic. It
may be called directly from Java code, or it may be invoked via the
Unified EL. A bean may access transactional resources. Dependencies
between beans are managed automatically by the container. Most beans are
<span class="emphasis"><em>stateful</em></span> and <span class="emphasis"><em>contextual</em></span>. The lifecycle of a bean is managed by the
container.</p>
<p>Let’s back up a second. What does it really mean to be <span class="emphasis"><em>contextual</em></span>?
Since beans may be stateful, it matters <span class="emphasis"><em>which</em></span> bean instance I have.
Unlike a stateless component model (for example, stateless session
beans) or a singleton component model (such as servlets, or singleton
beans), different clients of a bean see the bean in different states.
The client-visible state depends upon which instance of the bean the
client has a reference to.</p>
<p>However, like a stateless or singleton model, but <span class="emphasis"><em>unlike</em></span> stateful
session beans, the client does not control the lifecycle of the instance
by explicitly creating and destroying it. Instead, the <span class="emphasis"><em>scope</em></span> of the
bean determines:</p>
<div class="itemizedlist"><ul><li>
the lifecycle of each instance of the bean and
</li><li>
which clients share a reference to a particular instance of the bean.
</li></ul></div>

<p>For a given thread in a CDI application, there may be an <span class="emphasis"><em>active
context</em></span> associated with the scope of the bean. This context may be
unique to the thread (for example, if the bean is request scoped), or it
may be shared with certain other threads (for example, if the bean is
session scoped) or even all other threads (if it is application scoped).</p>
<p>Clients (for example, other beans) executing in the same context will
see the same instance of the bean. But clients in a different context
may see a different instance (depending on the relationship between the
contexts).</p>
<p>One great advantage of the contextual model is that it allows stateful
beans to be treated like services! The client need not concern itself
with managing the lifecycle of the bean it’s using, <span class="emphasis"><em>nor does it even
need to know what that lifecycle is.</em></span> Beans interact by passing
messages, and the bean implementations define the lifecycle of their own
state. The beans are loosely coupled because:</p>
<div class="itemizedlist"><ul><li>
they interact via well-defined public APIs
</li><li>
their lifecycles are completely decoupled
</li></ul></div>

<p>We can replace one bean with another different bean that implements the
same interface and has a different lifecycle (a different scope) without
affecting the other bean implementation. In fact, CDI defines a simple
facility for overriding bean implementations at deployment time, as we
will see in <a href="#alternatives" title="4.7. Alternatives">Section 4.7, “Alternatives”</a>.</p>
<p>Note that not all clients of a bean are beans themselves. Other objects
such as servlets or message-driven beans—which are by nature not
injectable, contextual objects—may also obtain references to beans by
injection.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_anatomy_of_a_bean"/>2.1. The anatomy of a bean</h2></div></div></div>

<p>Enough hand-waving. More formally, the anatomy of a bean, according to
the spec:</p>
<div class="blockquote"><blockquote class="blockquote">
  
<p>A bean comprises the following attributes:</p>
<div class="itemizedlist"><ul><li>
A (nonempty) set of bean types
</li><li>
A (nonempty) set of qualifiers
</li><li>
A scope
</li><li>
Optionally, a bean EL name
</li><li>
A set of interceptor bindings
</li><li>
A bean implementation
</li></ul></div>

<p>Furthermore, a bean may or may not be an alternative.</p>
</blockquote></div>

<p>Let’s see what all this new terminology means.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_bean_types_qualifiers_and_dependency_injection"/>2.1.1. Bean types, qualifiers and dependency injection</h3></div></div></div>

<p>Beans usually acquire references to other beans via dependency
injection. Any injected attribute specifies a "contract" that must be
satisfied by the bean to be injected. The contract is:</p>
<div class="itemizedlist"><ul><li>
a bean type, together with
</li><li>
a set of qualifiers.
</li></ul></div>

<p>A bean type is a user-defined class or interface; a type that is
client-visible. If the bean is an EJB session bean, the bean type is the
<code class="literal">@Local</code> interface or bean-class local view. A bean may have multiple
bean types. For example, the following bean has four bean types:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BookShop</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Business</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Shop</span><span class="java_operator">&lt;</span><span class="java_type">Book</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The bean types are <code class="literal">BookShop</code>, <code class="literal">Business</code> and <code class="literal">Shop&lt;Book&gt;</code>, as well as
the implicit type <code class="literal">java.lang.Object</code>. (Notice that a parameterized type
is a legal bean type).</p>
<p>Meanwhile, this session bean has only the local interfaces <code class="literal">BookShop</code>,
<code class="literal">Auditable</code> and <code class="literal">java.lang.Object</code> as bean types, since the bean class,
<code class="literal">BookShopBean</code> is not a client-visible type.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Stateful</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BookShopBean</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Business</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">BookShop</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Auditable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The bean types of a session bean include local interfaces and the bean
class local view (if any). EJB remote interfaces are not considered bean
types of a session bean. You can’t inject an EJB using its remote
interface unless you define a <span class="emphasis"><em>resource</em></span>, which we’ll meet in
<a href="#_java_ee_component_environment_resources" title="Chapter 14. Java EE component environment resources">Chapter 14, <i xmlns:xlink="http://www.w3.org/1999/xlink">Java EE component environment resources</i></a>.</p>
</div>

<p>Bean types may be restricted to an explicit set by annotating the bean
with the <code class="literal">@Typed</code> annotation and listing the classes that should be bean
types. For instance, the bean types of this bean have been restricted to
<code class="literal">Shop&lt;Book&gt;</code>, together with <code class="literal">java.lang.Object</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Typed</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">Shop</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BookShop</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Business</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Shop</span><span class="java_operator">&lt;</span><span class="java_type">Book</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Sometimes, a bean type alone does not provide enough information for the
container to know which bean to inject. For instance, suppose we have
two implementations of the <code class="literal">PaymentProcessor</code> interface:
<code class="literal">CreditCardPaymentProcessor</code> and <code class="literal">DebitPaymentProcessor</code>. Injecting a
field of type <code class="literal">PaymentProcessor</code> introduces an ambiguous condition. In
these cases, the client must specify some additional quality of the
implementation it is interested in. We model this kind of "quality"
using a qualifier.</p>
<p>A qualifier is a user-defined annotation that is itself annotated
<code class="literal">@Qualifier</code>. A qualifier annotation is an extension of the type system.
It lets us disambiguate a type without having to fall back to
string-based names. Here’s an example of a qualifier annotation:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">CreditCard</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>You may not be used to seeing the definition of an annotation. In fact,
this might be the first time you’ve encountered one. With CDI,
annotation definitions will become a familiar artifact as you’ll be
creating them from time to time.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Pay attention to the names of the built-in annotations in CDI and EJB.
You’ll notice that they are often adjectives. We encourage you to follow
this convention when creating your custom annotations, since they serve
to describe the behaviors and roles of the class.</p>
</div>

<p>Now that we have defined a qualifier annotation, we can use it to
disambiguate an injection point. The following injection point has the
bean type <code class="literal">PaymentProcessor</code> and qualifier <code class="literal">@CreditCard</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">CreditCard</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;paymentProcessor</span></pre>

<p>For each injection point, the container searches for a bean which
satisfies the contract, one which has the bean type and all the
qualifiers. If it finds exactly one matching bean, it injects an
instance of that bean. If it doesn’t, it reports an error to the user.</p>
<p>How do we specify that qualifiers of a bean? By annotating the bean
class, of course! The following bean has the qualifier <code class="literal">@CreditCard</code> and
implements the bean type <code class="literal">PaymentProcessor</code>. Therefore, it satisfies our
qualified injection point:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">CreditCard</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CreditCardPaymentProcessor</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>If a bean or an injection point does not explicitly specify a qualifier,
it has the default qualifier, <code class="literal">@Default</code>.</p>
</div>

<p>That’s not quite the end of the story. CDI also defines a simple
<span class="emphasis"><em>resolution rule</em></span> that helps the container decide what to do if there is
more than one bean that satisfies a particular contract. We’ll get into
the details in <a href="#_dependency_injection_and_programmatic_lookup" title="Chapter 4. Dependency injection and programmatic lookup">Chapter 4, <i xmlns:xlink="http://www.w3.org/1999/xlink">Dependency injection and programmatic lookup</i></a>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_scope"/>2.1.2. Scope</h3></div></div></div>

<p>The <span class="emphasis"><em>scope</em></span> of a bean defines the lifecycle and visibility of its
instances. The CDI context model is extensible, accommodating arbitrary
scopes. However, certain important scopes are built into the
specification, and provided by the container. Each scope is represented
by an annotation type.</p>
<p>For example, any web application may have <span class="emphasis"><em>session scoped</em></span> bean:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">SessionScoped</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>An instance of a session-scoped bean is bound to a user session and is
shared by all requests that execute in the context of that session.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Keep in mind that once a bean is bound to a context, it remains in that
context until the context is destroyed. There is no way to manually
remove a bean from a context. If you don’t want the bean to sit in the
session indefinitely, consider using another scope with a shorted
lifespan, such as the request or conversation scope.</p>
</div>

<p>If a scope is not explicitly specified, then the bean belongs to a
special scope called the <span class="emphasis"><em>dependent pseudo-scope</em></span>. Beans with this scope
live to serve the object into which they were injected, which means
their lifecycle is bound to the lifecycle of that object.</p>
<p>We’ll talk more about scopes in <a href="#_scopes_and_contexts" title="Chapter 5. Scopes and contexts">Chapter 5, <i xmlns:xlink="http://www.w3.org/1999/xlink">Scopes and contexts</i></a>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_el_name"/>2.1.3. EL name</h3></div></div></div>

<p>If you want to reference a bean in non-Java code that supports Unified
EL expressions, for example, in a JSP or JSF page, you must assign the
bean an <span class="emphasis"><em>EL name</em></span>.</p>
<p>The EL name is specified using the <code class="literal">@Named</code> annotation, as shown here:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">SessionScoped</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Named</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;cart&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>Now we can easily use the bean in any JSF or JSP page:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:dataTable</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{cart.lineItems}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">var</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;item&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:dataTable</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The <code class="literal">@Named</code> annotation is not what makes the class a bean. Most classes
in a bean archive are already recognized as beans. The <code class="literal">@Named</code>
annotation just makes it possible to reference the bean from the EL,
most commonly from a JSF view.</p>
</div>

<p>We can let CDI choose a name for us by leaving off the value of the
<code class="literal">@Named</code> annotation:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">SessionScoped</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Named</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>The name defaults to the unqualified class name, decapitalized; in this
case, <code class="literal">shoppingCart</code>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_alternatives"/>2.1.4. Alternatives</h3></div></div></div>

<p>We’ve already seen how qualifiers let us choose between multiple
implementations of an interface at development time. But sometimes we
have an interface (or other bean type) whose implementation varies
depending upon the deployment environment. For example, we may want to
use a mock implementation in a testing environment. An <span class="emphasis"><em>alternative</em></span> may
be declared by annotating the bean class with the <code class="literal">@Alternative</code>
annotation.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Alternative</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MockPaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessorImpl</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>We normally annotate a bean <code class="literal">@Alternative</code> only when there is some other
implementation of an interface it implements (or of any of its bean
types). We can choose between alternatives at deployment time by
<span class="emphasis"><em>selecting</em></span> an alternative in the CDI deployment descriptor
<code class="literal">META-INF/beans.xml</code> of the jar or Java EE module that uses it.
Different modules can specify that they use different alternatives.</p>
<p>We cover alternatives in more detail in <a href="#alternatives" title="4.7. Alternatives">Section 4.7, “Alternatives”</a>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_interceptor_binding_types"/>2.1.5. Interceptor binding types</h3></div></div></div>

<p>You might be familiar with the use of interceptors in EJB 3. Since Java
EE 6, this functionality has been generalized to work with other managed
beans. That’s right, you no longer have to make your bean an EJB just to
intercept its methods. Holler. So what does CDI have to offer above and
beyond that? Well, quite a lot actually. Let’s cover some background.</p>
<p>The way that interceptors were defined in Java EE 5 was
counter-intuitive. You were required to specify the <span class="emphasis"><em>implementation</em></span> of
the interceptor directly on the <span class="emphasis"><em>implementation</em></span> of the EJB, either in
the <code class="literal">@Interceptors</code> annotation or in the XML descriptor. You might as
well just put the interceptor code <span class="emphasis"><em>in</em></span> the implementation! Second, the
order in which the interceptors are applied is taken from the order in
which they are declared in the annotation or the XML descriptor. Perhaps
this isn’t so bad if you’re applying the interceptors to a single bean.
But, if you are applying them repeatedly, then there’s a good chance
that you’ll inadvertently define a different order for different beans.
Now that’s a problem.</p>
<p>CDI provides a new approach to binding interceptors to beans that
introduces a level of indirection (and thus control). We must define an
<span class="emphasis"><em>interceptor binding type</em></span> to describe the behavior implemented by the
interceptor.</p>
<p>An interceptor binding type is a user-defined annotation that is itself
annotated <code class="literal">@InterceptorBinding</code>. It lets us bind interceptor classes to
bean classes with no direct dependency between the two classes.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">InterceptorBinding</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Inherited</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Transactional</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>The interceptor that implements transaction management declares this
annotation:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Transactional</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Interceptor</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">TransactionInterceptor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>We can apply the interceptor to a bean by annotating the bean class with
the same interceptor binding type:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">SessionScoped</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Transactional</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>Notice that <code class="literal">ShoppingCart</code> and <code class="literal">TransactionInterceptor</code> don’t know
anything about each other.</p>
<p>Interceptors are deployment-specific. (We don’t need a
<code class="literal">TransactionInterceptor</code> in our unit tests!) By default, an interceptor
is disabled. We can enable an interceptor using the CDI deployment
descriptor <code class="literal">META-INF/beans.xml</code> of the jar or Java EE module. This is
also where we specify the interceptor ordering.</p>
<p>We’ll discuss interceptors, and their cousins, decorators, in <a href="#_interceptors" title="Chapter 9. Interceptors">Chapter 9, <i xmlns:xlink="http://www.w3.org/1999/xlink">Interceptors</i></a> and <a href="#_decorators" title="Chapter 10. Decorators">Chapter 10, <i xmlns:xlink="http://www.w3.org/1999/xlink">Decorators</i></a>.</p>
</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_what_kinds_of_classes_are_beans"/>2.2. What kinds of classes are beans?</h2></div></div></div>

<p>We’ve already seen two types of beans: JavaBeans and EJB session beans.
Is that the whole story? Actually, it’s just the beginning. Let’s
explore the various kinds of beans that CDI implementations must support
out-of-the-box.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_managed_beans"/>2.2.1. Managed beans</h3></div></div></div>

<p>A managed bean is a Java class. The basic lifecycle and semantics of a
managed bean are defined by the Managed Beans specification. You can
explicitly declare a managed bean by annotating the bean class
<code class="literal">@ManagedBean</code>, but in CDI you don’t need to. According to the
specification, the CDI container treats any class that satisfies the
following conditions as a managed bean:</p>
<div class="itemizedlist"><ul><li>
It is not a non-static inner class.
</li><li>
It is a concrete class, or is annotated <code class="literal">@Decorator</code>.
</li><li>
It is not annotated with an EJB component-defining annotation or
declared as an EJB bean class in <code class="literal">ejb-jar.xml</code>.
</li><li>
It does not implement <code class="literal">javax.enterprise.inject.spi.Extension</code>.
</li><li>
<p>It has an appropriate constructor—either:</p>
<div class="itemizedlist"><ul><li>
the class has a constructor with no parameters, or
</li><li>
the class declares a constructor annotated <code class="literal">@Inject</code>.
</li></ul></div>

</li></ul></div>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>According to this definition, JPA entities are technically managed
beans. However, entities have their own special lifecycle, state and
identity model and are usually instantiated by JPA or using <code class="literal">new</code>.
Therefore we don’t recommend directly injecting an entity class. We
especially recommend against assigning a scope other than <code class="literal">@Dependent</code>
to an entity class, since JPA is not able to persist injected CDI
proxies.</p>
</div>

<p>The unrestricted set of bean types for a managed bean contains the bean
class, every superclass and all interfaces it implements directly or
indirectly.</p>
<p>If a managed bean has a public field, it must have the default scope
<code class="literal">@Dependent</code>.</p>
<p>Managed beans support the <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code> lifecycle
callbacks.</p>
<p>Session beans are also, technically, managed beans. However, since they
have their own special lifecycle and take advantage of additional
enterprise services, the CDI specification considers them to be a
different kind of bean.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_session_beans"/>2.2.2. Session beans</h3></div></div></div>

<p>Session beans belong to the EJB specification. They have a special
lifecycle, state management and concurrency model that is different to
other managed beans and non-managed Java objects. But session beans
participate in CDI just like any other bean. You can inject one session
bean into another session bean, a managed bean into a session bean, a
session bean into a managed bean, have a managed bean observe an event
raised by a session bean, and so on.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Message-driven and entity beans are by nature non-contextual objects and
may not be injected into other objects. However, message-driven beans
can take advantage of some CDI functionality, such as dependency
injection, interceptors and decorators. In fact, CDI will perform
injection into any session or message-driven bean, even those which are
not contextual instances.</p>
</div>

<p>The unrestricted set of bean types for a session bean contains all local
interfaces of the bean and their superinterfaces. If the session bean
has a bean class local view, the unrestricted set of bean types contains
the bean class and all superclasses. In addition, <code class="literal">java.lang.Object</code> is
a bean type of every session bean. But remote interfaces are <span class="emphasis"><em>not</em></span>
included in the set of bean types.</p>
<p>There’s no reason to explicitly declare the scope of a stateless session
bean or singleton session bean. The EJB container controls the lifecycle
of these beans, according to the semantics of the <code class="literal">@Stateless</code> or
<code class="literal">@Singleton</code> declaration. On the other hand, a stateful session bean may
have any scope.</p>
<p>Stateful session beans may define a <span class="emphasis"><em>remove method</em></span>, annotated
<code class="literal">@Remove</code>, that is used by the application to indicate that an instance
should be destroyed. However, for a contextual instance of the bean—an
instance under the control of CDI—this method may only be called by the
application if the bean has scope <code class="literal">@Dependent</code>. For beans with other
scopes, the application must let the container destroy the bean.</p>
<p>So, when should we use a session bean instead of a plain managed bean?
Whenever we need the advanced enterprise services offered by EJB, such
as:</p>
<div class="itemizedlist"><ul><li>
method-level transaction management and security,
</li><li>
concurrency management,
</li><li>
instance-level passivation for stateful session beans and
instance-pooling for stateless session beans,
</li><li>
remote or web service invocation, or
</li><li>
timers and asynchronous methods,
</li></ul></div>

<p>When we don’t need any of these things, an ordinary managed bean will
serve just fine.</p>
<p>Many beans (including any <code class="literal">@SessionScoped</code> or <code class="literal">@ApplicationScoped</code>
beans) are available for concurrent access. Therefore, the concurrency
management provided by EJB 3.2 is especially useful. Most session and
application scoped beans should be EJBs.</p>
<p>Beans which hold references to heavy-weight resources, or hold a lot of
internal state benefit from the advanced container-managed lifecycle
defined by the EJB stateless/stateful/singleton model, with its support
for passivation and instance pooling.</p>
<p>Finally, it’s usually obvious when method-level transaction management,
method-level security, timers, remote methods or asynchronous methods
are needed.</p>
<p>The point we’re trying to make is: use a session bean when you need the
services it provides, not just because you want to use dependency
injection, lifecycle management, or interceptors. Java EE 7 provides a
graduated programming model. It’s usually easy to start with an ordinary
managed bean, and later turn it into an EJB just by adding one of the
following annotations: <code class="literal">@Stateless</code>, <code class="literal">@Stateful</code> or <code class="literal">@Singleton</code>.</p>
<p>On the other hand, don’t be scared to use session beans just because
you’ve heard your friends say they’re "heavyweight". It’s nothing more
than superstition to think that something is "heavier" just because it’s
hosted natively within the Java EE container, instead of by a
proprietary bean container or dependency injection framework that runs
as an additional layer of obfuscation. And as a general principle, you
should be skeptical of folks who use vaguely defined terminology like
"heavyweight".</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_producer_methods"/>2.2.3. Producer methods</h3></div></div></div>

<p>Not everything that needs to be injected can be boiled down to a bean
class instantiated by the container using <code class="literal">new</code>. There are plenty of
cases where we need additional control. What if we need to decide at
runtime which implementation of a type to instantiate and inject? What
if we need to inject an object that is obtained by querying a service or
transactional resource, for example by executing a JPA query?</p>
<p>A <span class="emphasis"><em>producer method</em></span> is a method that acts as a source of bean instances.
The method declaration itself describes the bean and the container
invokes the method to obtain an instance of the bean when no instance
exists in the specified context. A producer method lets the application
take full control of the bean instantiation process.</p>
<p>A producer method is declared by annotating a method of a bean class
with the <code class="literal">@Produces</code> annotation.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ApplicationScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">RandomNumberGenerator</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">Random</span><span class="java_plain">&nbsp;random&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">Random</span><span class="java_separator">(</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">currentTimeMillis</span><span class="java_separator">());</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">Named</span><span class="java_plain">&nbsp;@</span><span class="java_type">Random</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getRandomNumber</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;random</span><span class="java_separator">.</span><span class="java_plain">nextInt</span><span class="java_separator">(</span><span class="java_literal">100</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>We can’t write a bean class that is itself a random number. But we can
certainly write a method that returns a random number. By making the
method a producer method, we allow the return value of the method—in
this case an <code class="literal">Integer</code>—to be injected. We can even specify a
qualifier—in this case <code class="literal">@Random</code>, a scope—which in this case defaults to
<code class="literal">@Dependent</code>, and an EL name—which in this case defaults to
<code class="literal">randomNumber</code> according to the JavaBeans property name convention. Now
we can get a random number anywhere:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Random</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">int</span><!-- <br/> --><span class="java_plain">&nbsp;randomNumber</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>Even in a Unified EL expression:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Your&nbsp;raffle&nbsp;number&nbsp;is&nbsp;#{randomNumber}.</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">p</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>A producer method must be a non-abstract method of a managed bean class
or session bean class. A producer method may be either static or
non-static. If the bean is a session bean, the producer method must be
either a business method of the EJB or a static method of the bean
class.</p>
<p>The bean types of a producer method depend upon the method return type:</p>
<div class="itemizedlist"><ul><li>
If the return type is an interface, the unrestricted set of bean types
contains the return type, all interfaces it extends directly or
indirectly and <code class="literal">java.lang.Object</code>.
</li><li>
If a return type is primitive or is a Java array type, the
unrestricted set of bean types contains exactly two types: the method
return type and <code class="literal">java.lang.Object</code>.
</li><li>
If the return type is a class, the unrestricted set of bean types
contains the return type, every superclass and all interfaces it
implements directly or indirectly.
</li></ul></div>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Producer methods and fields may have a primitive bean type. For the
purpose of resolving dependencies, primitive types are considered to be
identical to their corresponding wrapper types in <code class="literal">java.lang</code>.</p>
</div>

<p>If the producer method has method parameters, the container will look
for a bean that satisfies the type and qualifiers of each parameter and
pass it to the method automatically—another form of dependency
injection.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Set</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Roles</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;getRoles</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">User</span><!-- <br/> --><span class="java_plain">&nbsp;user</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;user</span><span class="java_separator">.</span><span class="java_plain">getRoles</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>We’ll talk much more about producer methods in <a href="#producer_methods" title="Chapter 8. Producer methods">Chapter 8, <i xmlns:xlink="http://www.w3.org/1999/xlink">Producer methods</i></a>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_producer_fields"/>2.2.4. Producer fields</h3></div></div></div>

<p>A <span class="emphasis"><em>producer field</em></span> is a simpler alternative to a producer method. A
producer field is declared by annotating a field of a bean class with
the <code class="literal">@Produces</code> annotation—the same annotation used for producer
methods.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Shop</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;paymentProcessor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">....;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">Catalog</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">....;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The rules for determining the bean types of a producer field parallel
the rules for producer methods.</p>
<p>A producer field is really just a shortcut that lets us avoid writing a
useless getter method. However, in addition to convenience, producer
fields serve a specific purpose as an adaptor for Java EE component
environment injection, but to learn more about that, you’ll have to wait
until <a href="#_java_ee_component_environment_resources" title="Chapter 14. Java EE component environment resources">Chapter 14, <i xmlns:xlink="http://www.w3.org/1999/xlink">Java EE component environment resources</i></a>. Because we can’t wait to get
to work on some examples.</p>
</div>
</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_jsf_web_application_example"/>Chapter 3. JSF web application example</h2></div></div></div>

<p>Let’s illustrate these ideas with a full example. We’re going to
implement user login/logout for an application that uses JSF. First,
we’ll define a request-scoped bean to hold the username and password
entered during login, with constraints defined using annotations from
the Bean Validation specification:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Named</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">RequestScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Credentials</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;password</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span><span class="java_plain">&nbsp;@</span><span class="java_type">Length</span><span class="java_separator">(</span><span class="java_plain">min</span><span class="java_operator">=</span><span class="java_literal">3</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max</span><span class="java_operator">=</span><span class="java_literal">25</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getUsername</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUsername</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;username</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">username&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span><span class="java_plain">&nbsp;@</span><span class="java_type">Length</span><span class="java_separator">(</span><span class="java_plain">min</span><span class="java_operator">=</span><span class="java_literal">6</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max</span><span class="java_operator">=</span><span class="java_literal">20</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getPassword</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;password</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setPassword</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;password</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">password&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;password</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>This bean is bound to the login prompt in the following JSF form:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:form</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:panelGrid</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">columns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rendered</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{!login.loggedIn}&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">f:validateBean</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:outputLabel</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">for</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;username&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Username:</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:outputLabel</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:inputText</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;username&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{credentials.username}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:outputLabel</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">for</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;password&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Password:</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:outputLabel</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:inputSecret</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;password&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{credentials.password}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">f:validateBean</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:panelGrid</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:commandButton</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Login&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">action</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{login.login}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rendered</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{!login.loggedIn}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:commandButton</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Logout&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">action</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{login.logout}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rendered</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{login.loggedIn}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:form</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>Users are represented by a JPA entity:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;@</span><span class="java_type">NotNull</span><span class="java_plain">&nbsp;@</span><span class="java_type">Length</span><span class="java_separator">(</span><span class="java_plain">min</span><span class="java_operator">=</span><span class="java_literal">3</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max</span><span class="java_operator">=</span><span class="java_literal">25</span><span class="java_separator">)</span><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;@</span><span class="java_type">NotNull</span><span class="java_plain">&nbsp;@</span><span class="java_type">Length</span><span class="java_separator">(</span><span class="java_plain">min</span><span class="java_operator">=</span><span class="java_literal">6</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max</span><span class="java_operator">=</span><span class="java_literal">20</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;password</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getUsername</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUsername</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;username</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">username&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;username</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;setPassword</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;password</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">password&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;password</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>(Note that we’re also going to need a <code class="literal">persistence.xml</code> file to
configure the JPA persistence unit containing <code class="literal">User</code>.)</p>
<p>The actual work is done by a session-scoped bean that maintains
information about the currently logged-in user and exposes the <code class="literal">User</code>
entity to other beans:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">SessionScoped</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Named</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">Credentials</span><span class="java_plain">&nbsp;credentials</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">UserDatabase</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;userDatabase</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;login</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">User</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;userDatabase</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;select&nbsp;u&nbsp;from&nbsp;User&nbsp;u&nbsp;where&nbsp;u.username&nbsp;=&nbsp;:username&nbsp;and&nbsp;u.password&nbsp;=&nbsp;:password&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setParameter</span><span class="java_separator">(</span><span class="java_literal">&quot;username&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;credentials</span><span class="java_separator">.</span><span class="java_plain">getUsername</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setParameter</span><span class="java_separator">(</span><span class="java_literal">&quot;password&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;credentials</span><span class="java_separator">.</span><span class="java_plain">getPassword</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_operator">!</span><span class="java_plain">results</span><span class="java_separator">.</span><span class="java_plain">isEmpty</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;results</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;perhaps&nbsp;add&nbsp;code&nbsp;here&nbsp;to&nbsp;report&nbsp;a&nbsp;failed&nbsp;login</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;logout</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isLoggedIn</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;user&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">LoggedIn</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;getCurrentUser</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p><code class="literal">@LoggedIn</code> and <code class="literal">@UserDatabase</code> are custom qualifier annotations:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">LoggedIn</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">UserDatabase</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>We need an adaptor bean to expose our typesafe <code class="literal">EntityManager</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">UserDatabaseProducer</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">UserDatabase</span><span class="java_plain">&nbsp;@</span><span class="java_type">PersistenceContext</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;userDatabase</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Now <code class="literal">DocumentEditor</code>, or any other bean, can easily inject the current
user:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">DocumentEditor</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">Document</span><span class="java_plain">&nbsp;document</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">LoggedIn</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;currentUser</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentDatabase</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;docDatabase</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;save</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document</span><span class="java_separator">.</span><span class="java_plain">setCreatedBy</span><span class="java_separator">(</span><span class="java_plain">currentUser</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docDatabase</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">document</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Or we can reference the current user in a JSF view:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:panelGroup</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rendered</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{login.loggedIn}&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;signed&nbsp;in&nbsp;as&nbsp;#{currentUser.username}</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:panelGroup</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>Hopefully, this example gave you a taste of the CDI programming model.
In the next chapter, we’ll explore dependency injection in greater
depth.</p>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_dependency_injection_and_programmatic_lookup"/>Chapter 4. Dependency injection and programmatic lookup</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_injection_points">4.1. Injection points</a></span></dt><dt><span class="section"><a href="#_what_gets_injected">4.2. What gets injected</a></span></dt><dt><span class="section"><a href="#_qualifier_annotations">4.3. Qualifier annotations</a></span></dt><dt><span class="section"><a href="#_the_built_in_qualifiers_literal_default_literal_and_literal_any_literal">4.4. The built-in qualifiers <code class="literal">@Default</code> and <code class="literal">@Any</code></a></span></dt><dt><span class="section"><a href="#_qualifiers_with_members">4.5. Qualifiers with members</a></span></dt><dt><span class="section"><a href="#_multiple_qualifiers">4.6. Multiple qualifiers</a></span></dt><dt><span class="section"><a href="#alternatives">4.7. Alternatives</a></span></dt><dt><span class="section"><a href="#_fixing_unsatisfied_and_ambiguous_dependencies">4.8. Fixing unsatisfied and ambiguous dependencies</a></span></dt><dt><span class="section"><a href="#_client_proxies">4.9. Client proxies</a></span></dt><dt><span class="section"><a href="#_obtaining_a_contextual_instance_by_programmatic_lookup">4.10. Obtaining a contextual instance by programmatic lookup</a></span></dt><dt><span class="section"><a href="#_the_literal_injectionpoint_literal_object">4.11. The <code class="literal">InjectionPoint</code> object</a></span></dt></dl></div>

<p>One of the most significant features of CDI—certainly the most
recognized—is dependency injection; excuse me, <span class="emphasis"><em>typesafe</em></span> dependency
injection.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_injection_points"/>4.1. Injection points</h2></div></div></div>

<p>The <code class="literal">@Inject</code> annotation lets us define an injection point that is
injected during bean instantiation. Injection can occur via three
different mechanisms.</p>
<p><span class="emphasis"><em>Bean constructor</em></span> parameter injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Checkout</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Checkout</span><span class="java_separator">(</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">cart&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>A bean can only have one injectable constructor.</p>
<p><span class="emphasis"><em>Initializer method</em></span> parameter injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Checkout</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setShoppingCart</span><span class="java_separator">(</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">cart&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>A bean can have multiple initializer methods. If the bean is a session
bean, the initializer method is not required to be a business method of
the session bean.</p>
</div>

<p>And direct field injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Checkout</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;cart</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Getter and setter methods are not required for field injection to work
(unlike with JSF managed beans).</p>
</div>

<p>Dependency injection always occurs when the bean instance is first
instantiated by the container. Simplifying just a little, things happen
in this order:</p>
<div class="itemizedlist"><ul><li>
First, the container calls the bean constructor (the default
constructor or the one annotated <code class="literal">@Inject</code>), to obtain an instance of
the bean.
</li><li>
Next, the container initializes the values of all injected fields of
the bean.
</li><li>
Next, the container calls all initializer methods of bean (the call
order is not portable, don’t rely on it).
</li><li>
Finally, the <code class="literal">@PostConstruct</code> method, if any, is called.
</li></ul></div>

<p>(The only complication is that the container might call initializer
methods declared by a superclass before initializing injected fields
declared by a subclass.)</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>One major advantage of constructor injection is that it allows the bean
to be immutable.</p>
</div>

<p>CDI also supports parameter injection for some other methods that are
invoked by the container. For instance, parameter injection is supported
for producer methods:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Checkout</span><!-- <br/> --><span class="java_plain">&nbsp;createCheckout</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">ShoppingCart</span><!-- <br/> --><span class="java_plain">&nbsp;cart</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Checkout</span><span class="java_separator">(</span><span class="java_plain">cart</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>This is a case where the <code class="literal">@Inject</code> annotation <span class="emphasis"><em>is not</em></span> required at the
injection point. The same is true for observer methods (which we’ll meet
in <a href="#_events" title="Chapter 11. Events">Chapter 11, <i xmlns:xlink="http://www.w3.org/1999/xlink">Events</i></a>) and disposer methods.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_what_gets_injected"/>4.2. What gets injected</h2></div></div></div>

<p>The CDI specification defines a procedure, called <span class="emphasis"><em>typesafe resolution</em></span>,
that the container follows when identifying the bean to inject to an
injection point. This algorithm looks complex at first, but once you
understand it, it’s really quite intuitive. Typesafe resolution is
performed at system initialization time, which means that the container
will inform the developer immediately if a bean’s dependencies cannot be
satisfied.</p>
<p>The purpose of this algorithm is to allow multiple beans to implement
the same bean type and either:</p>
<div class="itemizedlist"><ul><li>
allow the client to select which implementation it requires using a
<span class="emphasis"><em>qualifier</em></span> or
</li><li>
allow the application deployer to select which implementation is
appropriate for a particular deployment, without changes to the client,
by enabling or disabling an <span class="emphasis"><em>alternative</em></span>, or
</li><li>
allow the beans to be isolated into separate modules.
</li></ul></div>

<p>Obviously, if you have exactly one bean of a given type, and an
injection point with that same type, then bean A is going to go into
slot A. That’s the simplest possible scenario. When you first start your
application, you’ll likely have lots of those.</p>
<p>But then, things start to get complicated. Let’s explore how the
container determines which bean to inject in more advanced cases. We’ll
start by taking a closer look at qualifiers.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_qualifier_annotations"/>4.3. Qualifier annotations</h2></div></div></div>

<p>If we have more than one bean that implements a particular bean type,
the injection point can specify exactly which bean should be injected
using a qualifier annotation. For example, there might be two
implementations of <code class="literal">PaymentProcessor</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Synchronous</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SynchronousPaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;process</span><span class="java_separator">(</span><span class="java_type">Payment</span><span class="java_plain">&nbsp;payment</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Asynchronous</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AsynchronousPaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;process</span><span class="java_separator">(</span><span class="java_type">Payment</span><span class="java_plain">&nbsp;payment</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Where <code class="literal">@Synchronous</code> and <code class="literal">@Asynchronous</code> are qualifier annotations:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Synchronous</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>A client bean developer uses the qualifier annotation to specify exactly
which bean should be injected.</p>
<p>Using field injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Synchronous</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;syncPaymentProcessor</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">;</span></pre>

<p>Using initializer method injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setPaymentProcessors</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Synchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;syncPaymentProcessor</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">syncPaymentProcessor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;syncPaymentProcessor</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">asyncPaymentProcessor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Using constructor injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Checkout</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Synchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;syncPaymentProcessor</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">syncPaymentProcessor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;syncPaymentProcessor</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">asyncPaymentProcessor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Qualifier annotations can also qualify method arguments of producer,
disposer and observer methods. Combining qualified arguments with
producer methods is a good way to have an implementation of a bean type
selected at runtime based on the state of the system:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span>
<!--  --><br/><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;getPaymentProcessor</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Synchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;syncPaymentProcessor</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;isSynchronous</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;syncPaymentProcessor&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;asyncPaymentProcessor</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>If an injected field or a parameter of a bean constructor or initializer
method is not explicitly annotated with a qualifier, the default
qualifier,<code class="literal">@Default</code>, is assumed.</p>
<p>Now, you may be thinking, <span class="emphasis"><em>"What’s the different between using a
qualifier and just specifying the exact implementation class you want?"</em></span>
It’s important to understand that a qualifier is like an extension of
the interface. It does not create a direct dependency to any particular
implementation. There may be multiple alternative implementations of
<code class="literal">@Asynchronous PaymentProcessor</code>!</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_built_in_qualifiers_literal_default_literal_and_literal_any_literal"/>4.4. The built-in qualifiers <code class="literal">@Default</code> and <code class="literal">@Any</code></h2></div></div></div>

<p>Whenever a bean or injection point does not explicitly declare a
qualifier, the container assumes the qualifier <code class="literal">@Default</code>. From time to
time, you’ll need to declare an injection point without specifying a
qualifier. There’s a qualifier for that too. All beans have the
qualifier`
                @Any`. Therefore, by explicitly specifying <code class="literal">@Any</code> at an
injection point, you suppress the default qualifier, without otherwise
restricting the beans that are eligible for injection.</p>
<p>This is especially useful if you want to iterate over all beans with a
certain bean type. For example:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Instance</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_type">void</span><span class="java_plain">&nbsp;initServices</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Any</span><span class="java_plain">&nbsp;</span><span class="java_type">Instance</span><span class="java_operator">&lt;</span><span class="java_type">Service</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;services</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Service</span><span class="java_plain">&nbsp;service</span><span class="java_operator">:</span><span class="java_plain">&nbsp;services</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service</span><span class="java_separator">.</span><span class="java_plain">init</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_qualifiers_with_members"/>4.5. Qualifiers with members</h2></div></div></div>

<p>Java annotations can have members. We can use annotation members to
further discriminate a qualifier. This prevents a potential explosion of
new annotations. For example, instead of creating several qualifiers
representing different payment methods, we could aggregate them into a
single annotation with a member:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">PayBy</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">PaymentMethod</span><span class="java_plain">&nbsp;value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Then we select one of the possible member values when applying the
qualifier:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">private</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">PayBy</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">CHECK</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;checkPayment</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>We can force the container to ignore a member of a qualifier type by
annotating the member <code class="literal">@Nonbinding</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">PayBy</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">PaymentMethod</span><span class="java_plain">&nbsp;value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Nonbinding</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;comment</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_multiple_qualifiers"/>4.6. Multiple qualifiers</h2></div></div></div>

<p>An injection point may specify multiple qualifiers:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Synchronous</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Reliable</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;syncPaymentProcessor</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>Then only a bean which has <span class="emphasis"><em>both</em></span> qualifier annotations would be
eligible for injection.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Synchronous</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Reliable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SynchronousReliablePaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;process</span><span class="java_separator">(</span><span class="java_type">Payment</span><span class="java_plain">&nbsp;payment</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="alternatives"/>4.7. Alternatives</h2></div></div></div>

<p>Alternatives are beans whose implementation is specific to a particular
client module or deployment scenario. This alternative defines a mock
implementation of both <code class="literal">@Synchronous PaymentProcessor</code> and
<code class="literal">@Asynchronous PaymentProcessor</code>, all in one:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Alternative</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Synchronous</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Asynchronous</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MockPaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;process</span><span class="java_separator">(</span><span class="java_type">Payment</span><span class="java_plain">&nbsp;payment</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>By default, <code class="literal">@Alternative</code> beans are disabled. We need to <span class="emphasis"><em>enable</em></span> an
alternative in the <code class="literal">beans.xml</code> descriptor of a bean archive to make it
available for instantiation and injection. However, this activation only
applies to the beans in that archive. From CDI 1.1 onwards the
alternative can be enabled for the whole application using <code class="literal">@Priority</code>
annotation.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">beans</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">alternatives</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mycompany.mock.MockPaymentProcessor</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">alternatives</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>When an ambiguous dependency exists at an injection point, the container
attempts to resolve the ambiguity by looking for an enabled alternative
among the beans that could be injected. If there is exactly one enabled
alternative, that’s the bean that will be injected. If there are more
beans with priority, the one with the highest priority value is
selected.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_fixing_unsatisfied_and_ambiguous_dependencies"/>4.8. Fixing unsatisfied and ambiguous dependencies</h2></div></div></div>

<p>The typesafe resolution algorithm fails when, after considering the
qualifier annotations on all beans that implement the bean type of an
injection point and filtering out disabled beans (<code class="literal">@Alternative</code> beans
which are not explicitly enabled), the container is unable to identify
exactly one bean to inject. The container will abort deployment,
informing us of the unsatisfied or ambiguous dependency.</p>
<p>During the course of your development, you’re going to encounter this
situation. Let’s learn how to resolve it.</p>
<p>To fix an <span class="emphasis"><em>unsatisfied dependency</em></span>, either:</p>
<div class="itemizedlist"><ul><li>
create a bean which implements the bean type and has all the qualifier
types of the injection point,
</li><li>
make sure that the bean you already have is in the classpath of the
module with the injection point, or
</li><li>
explicitly enable an <code class="literal">@Alternative</code> bean that implements the bean type
and has the appropriate qualifier types, using <code class="literal">beans.xml</code>.
</li><li>
enable an <code class="literal">@Alternative</code> bean that implements the bean type and has
the appropriate qualifier types, using <code class="literal">@Priority</code> annotation.
</li></ul></div>

<p>To fix an <span class="emphasis"><em>ambiguous dependency</em></span>, either:</p>
<div class="itemizedlist"><ul><li>
introduce a qualifier to distinguish between the two implementations
of the bean type,
</li><li>
exclude one of the beans from discovery (either by means of
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/cdi/api/1.1/javax/enterprise/inject/Vetoed.html">@Vetoed</a>
or <code class="literal">beans.xml</code>),
</li><li>
disable one of the beans by annotating it <code class="literal">@Alternative</code>,
</li><li>
move one of the implementations to a module that is not in the
classpath of the module with the injection point, or
</li><li>
disable one of two <code class="literal">@Alternative</code> beans that are trying to occupy the
same space, using <code class="literal">beans.xml</code>,
</li><li>
change priority value of one of two <code class="literal">@Alternative</code> beans with the
<code class="literal">@Priority</code> if they have the same highest priority value.
</li></ul></div>

<p>Just remember: "There can be only one."</p>
<p>On the other hand, if you really do have an optional or multivalued
injection point, you should change the type of your injection point to
<code class="literal">Instance</code>, as we’ll see in <a href="#_obtaining_a_contextual_instance_by_programmatic_lookup" title="4.10. Obtaining a contextual instance by programmatic lookup">Section 4.10, “Obtaining a contextual instance by programmatic lookup”</a>.</p>
<p>Now there’s one more issue you need to be aware of when using the
dependency injection service.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_client_proxies"/>4.9. Client proxies</h2></div></div></div>

<p>Clients of an injected bean do not usually hold a direct reference to a
bean instance, unless the bean is a dependent object (scope
<code class="literal">@Dependent</code>).</p>
<p>Imagine that a bean bound to the application scope held a direct
reference to a bean bound to the request scope. The application-scoped
bean is shared between many different requests. However, each request
should see a different instance of the request scoped bean—the current
one!</p>
<p>Now imagine that a bean bound to the session scope holds a direct
reference to a bean bound to the application scope. From time to time,
the session context is serialized to disk in order to use memory more
efficiently. However, the application scoped bean instance should not be
serialized along with the session scoped bean! It can get that reference
any time. No need to hoard it!</p>
<p>Therefore, unless a bean has the default scope <code class="literal">@Dependent</code>, the
container must indirect all injected references to the bean through a
proxy object. This <span class="emphasis"><em>client proxy</em></span> is responsible for ensuring that the
bean instance that receives a method invocation is the instance that is
associated with the current context. The client proxy also allows beans
bound to contexts such as the session context to be serialized to disk
without recursively serializing other injected beans.</p>
<p>Unfortunately, due to limitations of the Java language, some Java types
cannot be proxied by the container. If an injection point declared with
one of these types resolves to a bean with any scope other than
<code class="literal">@Dependent</code>, the container will abort deployment, informing us of the
problem.</p>
<p>The following Java types cannot be proxied by the container:</p>
<div class="itemizedlist"><ul><li>
classes which don’t have a non-private constructor with no parameters,
and
</li><li>
classes which are declared <code class="literal">final</code> or have a <code class="literal">final</code> method,
</li><li>
arrays and primitive types.
</li></ul></div>

<p>It’s usually very easy to fix an unproxyable dependency problem. If an
injection point of type <code class="literal">X</code> results in an unproxyable dependency,
simply:</p>
<div class="itemizedlist"><ul><li>
add a constructor with no parameters to <code class="literal">X</code>,
</li><li>
change the type of the injection point to`Instance&lt;X&gt;`,
</li><li>
introduce an interface <code class="literal">Y</code>, implemented by the injected bean, and
change the type of the injection point to <code class="literal">Y</code>, or
</li><li>
if all else fails, change the scope of the injected bean to
<code class="literal">@Dependent</code>.
</li></ul></div>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Weld also supports a non-standard workaround for this limitation, using
non-portable JVM APIs:</p>
<div class="itemizedlist"><ul><li>
Sun, IcedTea, Mac: <code class="literal">Unsafe.allocateInstance()</code> (The most efficient)
</li><li>
IBM, JRockit: <code class="literal">ReflectionFactory.newConstructorForSerialization()</code>
</li></ul></div>

<p>To enable this workaround, simply put an empty marker file
<code class="literal">META-INF/org.jboss.weld.enableUnsafeProxies</code> somewhere on the
application’s classpath.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_obtaining_a_contextual_instance_by_programmatic_lookup"/>4.10. Obtaining a contextual instance by programmatic lookup</h2></div></div></div>

<p>In certain situations, injection is not the most convenient way to
obtain a contextual reference. For example, it may not be used when:</p>
<div class="itemizedlist"><ul><li>
the bean type or qualifiers vary dynamically at runtime, or
</li><li>
depending upon the deployment, there may be no bean which satisfies
the type and qualifiers, or
</li><li>
we would like to iterate over all beans of a certain type.
</li></ul></div>

<p>In these situations, the application may obtain an instance of the
interface <code class="literal">Instance</code>, parameterized for the bean type, by injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Instance</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;paymentProcessorSource</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>The <code class="literal">get()</code> method of <code class="literal">Instance</code> produces a contextual instance of the
bean.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;p&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;paymentProcessorSource</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">get</span><!-- <br/> --><span class="java_separator">();</span></pre>

<p>Qualifiers can be specified in one of two ways:</p>
<div class="itemizedlist"><ul><li>
by annotating the <code class="literal">Instance</code> injection point, or
</li><li>
by passing qualifiers to the <code class="literal">select()</code> of <code class="literal">Event</code>.
</li></ul></div>

<p>Specifying the qualifiers at the injection point is much, much easier:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Asynchronous</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Instance</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;paymentProcessorSource</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>Now, the <code class="literal">PaymentProcessor</code> returned by <code class="literal">get()</code> will have the qualifier
<code class="literal">@Asynchronous</code>.</p>
<p>Alternatively, we can specify the qualifier dynamically. First, we add
the <code class="literal">@Any</code> qualifier to the injection point, to suppress the default
qualifier. (All beans have the qualifier <code class="literal">@Any</code> .)</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Instance</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">Any</span><span class="java_plain">&nbsp;</span><span class="java_type">Instance</span><span class="java_operator">&lt;</span><span class="java_type">PaymentProcessor</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;paymentProcessorSource</span><span class="java_separator">;</span></pre>

<p>Next, we need to obtain an instance of our qualifier type. Since
annotations are interfaces, we can’t just write <code class="literal">new Asynchronous()</code>.
It’s also quite tedious to create a concrete implementation of an
annotation type from scratch. Instead, CDI lets us obtain a qualifier
instance by subclassing the helper class <code class="literal">AnnotationLiteral</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">AsynchronousQualifier</span>
<!--  --><br/><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Asynchronous</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Asynchronous</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>In some cases, we can use an anonymous class:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;p&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;paymentProcessorSource</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">select</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Asynchronous</span><span class="java_operator">&gt;</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{});</span></pre>

<p>However, we can’t use an anonymous class to implement a qualifier type
with members.</p>
<p>Now, finally, we can pass the qualifier to the <code class="literal">select()</code> method
of <code class="literal">Instance</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Annotation</span><!-- <br/> --><span class="java_plain">&nbsp;qualifier&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;synchronously&nbsp;</span><!-- <br/> --><span class="java_operator">?</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">SynchronousQualifier</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AsynchronousQualifier</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;p&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;anyPaymentProcessor</span><span class="java_separator">.</span><span class="java_plain">select</span><span class="java_separator">(</span><span class="java_plain">qualifier</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">().</span><span class="java_plain">process</span><span class="java_separator">(</span><span class="java_plain">payment</span><span class="java_separator">);</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_literal_injectionpoint_literal_object"/>4.11. The <code class="literal">InjectionPoint</code> object</h2></div></div></div>

<p>There are certain kinds of dependent objects (beans with scope
<code class="literal">@Dependent</code>) that need to know something about the object or injection
point into which they are injected in order to be able to do what they
do. For example:</p>
<div class="itemizedlist"><ul><li>
The log category for a <code class="literal">Logger</code> depends upon the class of the object
that owns it.
</li><li>
Injection of a HTTP parameter or header value depends upon what
parameter or header name was specified at the injection point.
</li><li>
Injection of the result of an EL expression evaluation depends upon
the expression that was specified at the injection point.
</li></ul></div>

<p>A bean with scope <code class="literal">@Dependent</code> may inject an instance of
<code class="literal">InjectionPoint</code> and access metadata relating to the injection point to
which it belongs.</p>
<p>Let’s look at an example. The following code is verbose, and vulnerable
to refactoring problems:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Logger</span><!-- <br/> --><span class="java_plain">&nbsp;log&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Logger</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getLogger</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">MyClass</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getName</span><!-- <br/> --><span class="java_separator">());</span></pre>

<p>This clever little producer method lets you inject a JDK <code class="literal">Logger</code>
without explicitly specifying the log category:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">spi</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">InjectionPoint</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">enterprise</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">.</span><span class="java_type">Produces</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LogFactory</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;</span><span class="java_type">Logger</span><span class="java_plain">&nbsp;createLogger</span><span class="java_separator">(</span><span class="java_type">InjectionPoint</span><span class="java_plain">&nbsp;injectionPoint</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">Logger</span><span class="java_separator">.</span><span class="java_plain">getLogger</span><span class="java_separator">(</span><span class="java_plain">injectionPoint</span><span class="java_separator">.</span><span class="java_plain">getMember</span><span class="java_separator">().</span><span class="java_plain">getDeclaringClass</span><span class="java_separator">().</span><span class="java_plain">getName</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>We can now write:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Logger</span><!-- <br/> --><span class="java_plain">&nbsp;log</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>Not convinced? Then here’s a second example. To inject HTTP parameters,
we need to define a qualifier type:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">HttpParam</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Nonbinding</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>We would use this qualifier type at injection points as follows:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">HttpParam</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;username&quot;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">String</span><!-- <br/> --><span class="java_plain">&nbsp;username</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">HttpParam</span><span class="java_separator">(</span><span class="java_literal">&quot;password&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;password</span><span class="java_separator">;</span></pre>

<p>The following producer method does the work:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">enterprise</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">.</span><span class="java_plain">spi</span><span class="java_separator">.</span><span class="java_type">InjectionPoint</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">HttpParams</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">HttpParam</span><span class="java_separator">(</span><span class="java_literal">&quot;&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getParamValue</span><span class="java_separator">(</span><span class="java_type">InjectionPoint</span><span class="java_plain">&nbsp;ip</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ServletRequest</span><span class="java_plain">&nbsp;request&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">ServletRequest</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">FacesContext</span><span class="java_separator">.</span><span class="java_plain">getCurrentInstance</span><span class="java_separator">().</span><span class="java_plain">getExternalContext</span><span class="java_separator">().</span><span class="java_plain">getRequest</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;request</span><span class="java_separator">.</span><span class="java_plain">getParameter</span><span class="java_separator">(</span><span class="java_plain">ip</span><span class="java_separator">.</span><span class="java_plain">getAnnotated</span><span class="java_separator">().</span><span class="java_plain">getAnnotation</span><span class="java_separator">(</span><span class="java_type">HttpParam</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">value</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Note that acquiring of the request in this example is JSF-centric. For a
more generic solution you could write your own producer for the request
and have it injected as a method parameter.</p>
<p>Note also that the <code class="literal">value()</code> member of the <code class="literal">HttpParam</code> annotation is
ignored by the container since it is annotated <code class="literal">@Nonbinding.</code></p>
<p>The container provides a built-in bean that implements the
<code class="literal">InjectionPoint</code> interface:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">InjectionPoint</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Type</span><span class="java_plain">&nbsp;getType</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getQualifiers</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Bean</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;getBean</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Member</span><span class="java_plain">&nbsp;getMember</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotated</span><span class="java_plain">&nbsp;getAnnotated</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isDelegate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isTransient</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_scopes_and_contexts"/>Chapter 5. Scopes and contexts</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_scope_types">5.1. Scope types</a></span></dt><dt><span class="section"><a href="#_built_in_scopes">5.2. Built-in scopes</a></span></dt><dt><span class="section"><a href="#_the_conversation_scope">5.3. The conversation scope</a></span></dt><dd><dl><dt><span class="section"><a href="#_conversation_demarcation">5.3.1. Conversation demarcation</a></span></dt><dt><span class="section"><a href="#_conversation_propagation">5.3.2. Conversation propagation</a></span></dt><dt><span class="section"><a href="#_conversation_timeout">5.3.3. Conversation timeout</a></span></dt><dt><span class="section"><a href="#_cdi_conversation_filter">5.3.4. CDI Conversation filter</a></span></dt><dt><span class="section"><a href="#_lazy_and_eager_conversation_context_initialization">5.3.5. Lazy and eager conversation context initialization</a></span></dt></dl></dd><dt><span class="section"><a href="#_the_singleton_pseudo_scope">5.4. The singleton pseudo-scope</a></span></dt><dt><span class="section"><a href="#_the_dependent_pseudo_scope">5.5. The dependent pseudo-scope</a></span></dt><dt><span class="section"><a href="#_the_literal_new_literal_qualifier">5.6. The <code class="literal">@New</code> qualifier</a></span></dt></dl></div>

<p>So far, we’ve seen a few examples of <span class="emphasis"><em>scope type annotations</em></span>. The scope
of a bean determines the lifecycle of instances of the bean. The scope
also determines which clients refer to which instances of the bean.
According to the CDI specification, a scope determines:</p>
<div class="blockquote"><blockquote class="blockquote">
  
<div class="itemizedlist"><ul><li>
When a new instance of any bean with that scope is created
</li><li>
When an existing instance of any bean with that scope is destroyed
</li><li>
Which injected references refer to any instance of a bean with that
scope
</li></ul></div>

</blockquote></div>

<p>For example, if we have a session-scoped bean, <code class="literal">CurrentUser</code>, all beans
that are called in the context of the same <code class="literal">HttpSession</code> will see the
same instance of <code class="literal">CurrentUser</code>. This instance will be automatically
created the first time a <code class="literal">CurrentUser</code> is needed in that session, and
automatically destroyed when the session ends.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>JPA entities aren’t a great fit for this model. Entities have their
whole own lifecycle and identity model which just doesn’t map naturally
to the model used in CDI. Therefore, we recommend against treating
entities as CDI beans. You’re certainly going to run into problems if
you try to give an entity a scope other than the default scope
<code class="literal">@Dependent</code>. The client proxy will get in the way if you try to pass an
injected instance to the JPA <code class="literal">EntityManager</code>.</p>
</div>

<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_scope_types"/>5.1. Scope types</h2></div></div></div>

<p>CDI features an <span class="emphasis"><em>extensible context model</em></span>. It’s possible to define new
scopes by creating a new scope type annotation:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">ScopeType</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">ClusterScoped</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>Of course, that’s the easy part of the job. For this scope type to be
useful, we will also need to define a <code class="literal">Context</code> object that implements
the scope! Implementing a <code class="literal">Context</code> is usually a very technical task,
intended for framework development only.</p>
<p>We can apply a scope type annotation to a bean implementation class to
specify the scope of the bean:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">ClusterScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SecondLevelCache</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>Usually, you’ll use one of CDI’s built-in scopes.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_built_in_scopes"/>5.2. Built-in scopes</h2></div></div></div>

<p>CDI defines four built-in scopes:</p>
<div class="itemizedlist"><ul><li>
<code class="literal">@RequestScoped</code>
</li><li>
<code class="literal">@SessionScoped</code>
</li><li>
<code class="literal">@ApplicationScoped</code>
</li><li>
<code class="literal">@ConversationScoped</code>
</li></ul></div>

<p>For a web application that uses CDI, any servlet request has access to
active request, session and application scopes. Furthermore, since CDI
1.1 the conversation context is active during every servlet request.</p>
<p>The request and application scopes are also active:</p>
<div class="itemizedlist"><ul><li>
during invocations of EJB remote methods,
</li><li>
during invocations of EJB asynchronous methods,
</li><li>
during EJB timeouts,
</li><li>
during message delivery to a message-driven bean,
</li><li>
during web service invocations, and
</li><li>
during <code class="literal">@PostConstruct</code> callback of any bean
</li></ul></div>

<p>If the application tries to invoke a bean with a scope that does not
have an active context, a <code class="literal">ContextNotActiveException</code> is thrown by the
container at runtime.</p>
<p>Managed beans with scope <code class="literal">@SessionScoped</code> or <code class="literal">@ConversationScoped</code> must
be serializable, since the container passivates the HTTP session from
time to time.</p>
<p>Three of the four built-in scopes should be extremely familiar to every
Java EE developer, so let’s not waste time discussing them here. One of
the scopes, however, is new.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_conversation_scope"/>5.3. The conversation scope</h2></div></div></div>

<p>The conversation scope is a bit like the traditional session scope in
that it holds state associated with a user of the system, and spans
multiple requests to the server. However, unlike the session scope, the
conversation scope:</p>
<div class="itemizedlist"><ul><li>
is demarcated explicitly by the application, and
</li><li>
holds state associated with a particular web browser tab in a web
application (browsers tend to share domain cookies, and hence the
session cookie, between tabs, so this is not the case for the session
scope).
</li></ul></div>

<p>A conversation represents a task—a unit of work from the point of view
of the user. The conversation context holds state associated with what
the user is currently working on. If the user is doing multiple things
at the same time, there are multiple conversations.</p>
<p>The conversation context is active during any servlet request (since CDI
1.1). Most conversations are destroyed at the end of the request. If a
conversation should hold state across multiple requests, it must be
explicitly promoted to a <span class="emphasis"><em>long-running conversation</em></span>.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_conversation_demarcation"/>5.3.1. Conversation demarcation</h3></div></div></div>

<p>CDI provides a built-in bean for controlling the lifecycle of
conversations in a CDI application. This bean may be obtained by
injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Conversation</span><!-- <br/> --><span class="java_plain">&nbsp;conversation</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>To promote the conversation associated with the current request to a
long-running conversation, call the <code class="literal">begin()</code> method from application
code. To schedule the current long-running conversation context for
destruction at the end of the current request, call <code class="literal">end()</code>.</p>
<p>In the following example, a conversation-scoped bean controls the
conversation with which it is associated:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">.</span><span class="java_type">Inject</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">persistence</span><span class="java_separator">.</span><span class="java_type">PersistenceContextType</span><span class="java_separator">.</span><span class="java_plain">EXTENDED</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ConversationScoped</span><span class="java_plain">&nbsp;@</span><span class="java_type">Stateful</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">OrderBuilder</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;order</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">Conversation</span><span class="java_plain">&nbsp;conversation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;@</span><span class="java_type">PersistenceContext</span><span class="java_separator">(</span><span class="java_plain">type&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;EXTENDED</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;getOrder</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;order</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;createOrder</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conversation</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;order</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;addLineItem</span><span class="java_separator">(</span><span class="java_type">Product</span><span class="java_plain">&nbsp;product</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;quantity</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">LineItem</span><span class="java_separator">(</span><span class="java_plain">product</span><span class="java_separator">,</span><span class="java_plain">&nbsp;quantity</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;saveOrder</span><span class="java_separator">(</span><span class="java_type">Order</span><span class="java_plain">&nbsp;order</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">order</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conversation</span><span class="java_separator">.</span><span class="java_plain">end</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Remove</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;destroy</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>This bean is able to control its own lifecycle through use of the
<code class="literal">Conversation</code> API. But some other beans have a lifecycle which depends
completely upon another object.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_conversation_propagation"/>5.3.2. Conversation propagation</h3></div></div></div>

<p>The conversation context automatically propagates with any JSF faces
request (JSF form submission) or redirect. It does not automatically
propagate with non-faces requests, for example, navigation via a link.</p>
<p>We can force the conversation to propagate with a non-faces request by
including the unique identifier of the conversation as a request
parameter. The CDI specification reserves the request parameter named
<code class="literal">cid</code> for this use. The unique identifier of the conversation may be
obtained from the <code class="literal">Conversation</code> object, which has the EL bean name
<code class="literal">javax.enterprise.context.conversation</code>.</p>
<p>Therefore, the following link propagates the conversation:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">a</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/addProduct.jsp?cid=#{javax.enterprise.context.conversation.id}&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Add&nbsp;Product</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">a</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>It’s probably better to use one of the link components in JSF 2:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">outcome</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/addProduct.xhtml&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Add&nbsp;Product&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">f:param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cid&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{javax.enterprise.context.conversation.id}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:link</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2>
<p>The conversation context propagates across redirects, making it very
easy to implement the common POST-then-redirect pattern, without resort
to fragile constructs such as a "flash" object. The container
automatically adds the conversation id to the redirect URL as a request
parameter.</p>
</div>

<p>In certain scenarios it may be desired to suppress propagation of a
long-running conversation. The <code class="literal">conversationPropagation</code> request
parameter (introduced in CDI 1.1) may be used for this purpose. If the
<code class="literal">conversationPropagation</code> request parameter has the value <code class="literal">none</code> , the
container will not reassociate the existing conversation but will
instead associate the request with a new transient conversation even
though the conversation id was propagated.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_conversation_timeout"/>5.3.3. Conversation timeout</h3></div></div></div>

<p>The container is permitted to destroy a conversation and all state held
in its context at any time in order to conserve resources. A CDI
implementation will normally do this on the basis of some kind of
timeout—though this is not required by the specification. The timeout is
the period of inactivity before the conversation is destroyed (as
opposed to the amount of time the conversation is active).</p>
<p>The <code class="literal">Conversation</code> object provides a method to set the timeout. This is
a hint to the container, which is free to ignore the setting.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">conversation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">setTimeout</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">timeoutInMillis</span><!-- <br/> --><span class="java_separator">);</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_cdi_conversation_filter"/>5.3.4. CDI Conversation filter</h3></div></div></div>

<p>The conversation management is not always smooth. For example, if the
propagated conversation cannot be restored, the
<code class="literal">javax.enterprise.context.NonexistentConversationException</code> is thrown.
Or if there are concurrent requests for a one long-running conversation,
`javax.enterprise.context.BusyConversationException ` is thrown. For
such cases, developer has no opportunity to deal with the exception by
default, as the conversation associated with a Servlet request is
determined at the beginning of the request before calling any service()
method of any servlet in the web application, even before calling any of
the filters in the web application and before the container calls any
ServletRequestListener or AsyncListener in the web application.</p>
<p>To be allowed to handle the exceptions, a filter defined in the CDI 1.1
with the name ` CDI
            Conversation Filter ` can be used. By mapping the
` CDI Conversation Filter ` in the web.xml just after some other
filters, we are able to catch the exceptions in them since the ordering
in the web.xml specifies the ordering in which the filters will be
called (described in the servlet specification).</p>
<p>In the following example, a filter MyFilter checks for the
BusyConversationException thrown during the conversation association. In
the web.xml example, the filter is mapped before the CDI Conversation
Filter.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">MyFilter</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Filter</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;doFilter</span><span class="java_separator">(</span><span class="java_type">ServletRequest</span><span class="java_plain">&nbsp;request</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ServletResponse</span><span class="java_plain">&nbsp;response</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">FilterChain</span><span class="java_plain">&nbsp;chain</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">IOException</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ServletException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain</span><span class="java_separator">.</span><span class="java_plain">doFilter</span><span class="java_separator">(</span><span class="java_plain">request</span><span class="java_separator">,</span><span class="java_plain">&nbsp;response</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">BusyConversationException</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response</span><span class="java_separator">.</span><span class="java_plain">setContentType</span><span class="java_separator">(</span><span class="java_literal">&quot;text/plain&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response</span><span class="java_separator">.</span><span class="java_plain">getWriter</span><span class="java_separator">().</span><span class="java_plain">print</span><span class="java_separator">(</span><span class="java_literal">&quot;BusyConversationException&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">...</span></pre>

<p>To make it work, we need to map our MyFilter before the CDI Conversation
Filter in the web.xml file.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">filter-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">filter-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">My&nbsp;Filter</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">filter-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/*</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">filter-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">filter-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">filter-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">CDI&nbsp;Conversation&nbsp;Filter</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">filter-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/*</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">filter-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2>
<p>The mapping of the <code class="literal">CDI Conversation Filter</code> determines when Weld reads
the <code class="literal">cid</code> request parameter. This process forces request body parsing.
If your application relies on setting a custom character encoding for
the request or parsing the request body itself by reading an
<code class="literal">InputStream</code> or <code class="literal">Reader</code>, make sure that this is performed in a filter
that executes before the CDI Conversation Filter is executed. See
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://weld.cdi-spec.org/documentation/#3">this FAQ page for details</a>.
Alternatively, the lazy conversation context initialization (see below)
may be used.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_lazy_and_eager_conversation_context_initialization"/>5.3.5. Lazy and eager conversation context initialization</h3></div></div></div>

<p>Conversation context may be initialized lazily or eagerly.</p>
<p>When initialized lazily, the conversation context (no matter if
transient or long-running) is only initialized when a
<code class="literal">@ConversationScoped</code> bean is accessed for the first time. At that
point, the <code class="literal">cid</code> parameter is read and the conversation is restored. The
conversation context may not be initialized at all throughout the
request processing if no conversation state is accessed. Note that if a
problem occurs during this delayed initialization, the conversation
state access (bean method invocation) may result in
<code class="literal">BusyConversationException</code> or <code class="literal">NonexistentConversationException</code> being
thrown.</p>
<p>When initialized eagerly, the conversation context is initialized at a
predefined time. Either at the beginning of the request processing
before any listener, filter or servlet is invoked or, if the
<code class="literal">CDI Conversation Filter</code> is mapped, during execution of this filter.</p>
<p>Conversation context initialization mode may be configured using the
<code class="literal">org.jboss.weld.context.conversation.lazy</code> init parameter.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">context-param</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.weld.context.conversation.lazy</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">param-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param-value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">true</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">param-value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">context-param</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>If the init parameter is not set, the following default behavior
applies:</p>
<div class="itemizedlist"><ul><li>
If the <code class="literal">CDI Conversation Filter</code> is mapped, the conversation context is
initialized eagerly within this filter
</li><li>
If an observer for <code class="literal">@Initialized(ConversationScoped.class)</code> or
<code class="literal">@Destroyed(ConversationScoped.class)</code> event exists in the application,
the conversation context is initialized eagerly
</li><li>
Otherwise, the conversation context is initialized lazily
</li></ul></div>

</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_singleton_pseudo_scope"/>5.4. The singleton pseudo-scope</h2></div></div></div>

<p>In addition to the four built-in scopes, CDI also supports two
<span class="emphasis"><em>pseudo-scopes</em></span>. The first is the <span class="emphasis"><em>singleton pseudo-scope</em></span>, which we
specify using the annotation <code class="literal">@Singleton</code>.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Unlike the other scopes, which belong to the package
<code class="literal">javax.enterprise.context</code>, the <code class="literal">@Singleton</code> annotation is defined in
the package <code class="literal">javax.inject</code>.</p>
</div>

<p>You can guess what "singleton" means here. It means a bean that is
instantiated once. Unfortunately, there’s a little problem with this
pseudo-scope. Beans with scope <code class="literal">@Singleton</code> don’t have a proxy object.
Clients hold a direct reference to the singleton instance. So we need to
consider the case of a client that can be serialized, for example, any
bean with scope <code class="literal">@SessionScoped</code> or <code class="literal">@ConversationScoped</code>, any dependent
object of a bean with scope <code class="literal">@SessionScoped</code> or <code class="literal">@ConversationScoped</code>,
or any stateful session bean.</p>
<p>Now, if the singleton instance is a simple, immutable, serializable
object like a string, a number or a date, we probably don’t mind too
much if it gets duplicated via serialization. However, that makes it no
stop being a true singleton, and we may as well have just declared it
with the default scope.</p>
<p>There are several ways to ensure that the singleton bean remains a
singleton when its client gets serialized:</p>
<div class="itemizedlist"><ul><li>
have the singleton bean implement <code class="literal">writeResolve()</code> and <code class="literal">readReplace()</code>
(as defined by the Java serialization specification),
</li><li>
make sure the client keeps only a transient reference to the singleton
bean, or
</li><li>
give the client a reference of type <code class="literal">Instance&lt;X&gt;</code> where <code class="literal">X</code> is the
bean type of the singleton bean.
</li></ul></div>

<p>A fourth, better solution is to instead use <code class="literal">@ApplicationScoped</code>,
allowing the container to proxy the bean, and take care of serialization
problems automatically.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_dependent_pseudo_scope"/>5.5. The dependent pseudo-scope</h2></div></div></div>

<p>Finally, CDI features the so-called <span class="emphasis"><em>dependent pseudo-scope</em></span>. This is
the default scope for a bean which does not explicitly declare a scope
type.</p>
<p>For example, this bean has the scope type <code class="literal">@Dependent</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Calculator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<p>An instance of a dependent bean is never shared between different
clients or different injection points. It is strictly a <span class="emphasis"><em>dependent
object</em></span> of some other object. It is instantiated when the object it
belongs to is created, and destroyed when the object it belongs to is
destroyed.</p>
<p>If a Unified EL expression refers to a dependent bean by EL name, an
instance of the bean is instantiated every time the expression is
evaluated. The instance is not reused during any other expression
evaluation.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>If you need to access a bean directly by EL name in a JSF page, you
probably need to give it a scope other than <code class="literal">@Dependent</code>. Otherwise, any
value that gets set to the bean by a JSF input will be lost immediately.
That’s why CDI features the <code class="literal">@Model</code> stereotype; it lets you give a bean
a name, and set its scope to <code class="literal">@RequestScoped</code> in one stroke. If you need
to access a bean that really <span class="emphasis"><em>has</em></span> to have the scope <code class="literal">@Dependent</code> from a
JSF page, inject it into a different bean, and expose it to EL via a
getter method.</p>
</div>

<p>Beans with scope <code class="literal">@Dependent</code> don’t need a proxy object. The client
holds a direct reference to its instance.</p>
<p>CDI makes it easy to obtain a dependent instance of a bean, even if the
bean is already declared as a bean with some other scope type.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_literal_new_literal_qualifier"/>5.6. The <code class="literal">@New</code> qualifier</h2></div></div></div>

<p>The built-in qualifier <code class="literal">@New</code> allows us to obtain a dependent object of
a specified class.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">New</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Calculator</span><!-- <br/> --><span class="java_plain">&nbsp;calculator</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>The class must be a valid managed bean or session bean, but need not be
an enabled bean.</p>
<p>This works even if <code class="literal">Calculator</code> is <span class="emphasis"><em>already</em></span> declared with a different
scope type, for example:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">ConversationScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Calculator</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>So the following injected attributes each get a different instance of
<code class="literal">Calculator</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaymentCalc</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">Calculator</span><span class="java_plain">&nbsp;calculator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">New</span><span class="java_plain">&nbsp;</span><span class="java_type">Calculator</span><span class="java_plain">&nbsp;newCalculator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The <code class="literal">calculator</code> field has a conversation-scoped instance of
<code class="literal">Calculator</code> injected. The <code class="literal">newCalculator</code> field has a new instance of
<code class="literal">Calculator</code> injected, with a lifecycle that is bound to the owning
<code class="literal">PaymentCalc</code>.</p>
<p>This feature is particularly useful with producer methods, as we’ll see
in <a href="#producer_methods" title="Chapter 8. Producer methods">Chapter 8, <i xmlns:xlink="http://www.w3.org/1999/xlink">Producer methods</i></a>.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2>
<p>The <code class="literal">@New</code> qualifier was deprecated in CDI 1.1. CDI applications are
encouraged to inject @Dependent scoped beans instead.</p>
</div>

</div>
</div>
</div>
<div class="part" lang="en-US"><div class="titlepage"><div><div><h1 class="title"><a id="_getting_start_with_weld_the_cdi_reference_implementation"/>Part II. Getting Start with Weld, the CDI Reference Implementation</h1></div></div></div>

<div class="partintro" lang="en-US"><div/>
<p>Weld, the CDI Reference Implementation (RI), can be downloaded from the
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://weld.cdi-spec.org/download">download page</a>. Information about the
Weld source code repository and instructions about how to obtain and
build the source can be found on the same page.</p>
<p>Weld provides a complete SPI allowing Java EE containers such as
WildFly, GlassFish and WebLogic to use Weld as their built-in CDI
implementation. Weld also runs in servlet engines like Tomcat and Jetty,
or even in a plain Java SE environment.</p>
<p>Weld comes with an extensive library of examples, which are a great
starting point from which to learn CDI. In addition, a number of
quickstarts featuring CDI can be found at the
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/developer/quickstarts.html">JBoss Developer site</a></p>
<div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#_getting_started_with_weld">6. Getting started with Weld</a></span></dt><dd><dl><dt><span class="section"><a href="#_prerequisites">6.1. Prerequisites</a></span></dt><dt><span class="section"><a href="#_deploying_to_wildfly">6.2. Deploying to WildFly</a></span></dt><dt><span class="section"><a href="#_deploying_to_glassfish">6.3. Deploying to GlassFish</a></span></dt><dt><span class="section"><a href="#_deploying_to_apache_tomcat">6.4. Deploying to Apache Tomcat</a></span></dt><dt><span class="section"><a href="#_deploying_to_jetty">6.5. Deploying to Jetty</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_diving_into_the_weld_examples">7. Diving into the Weld examples</a></span></dt><dd><dl><dt><span class="section"><a href="#_the_numberguess_example_in_depth">7.1. The numberguess example in depth</a></span></dt><dd><dl><dt><span class="section"><a href="#_the_numberguess_example_in_apache_tomcat_or_jetty">7.1.1. The numberguess example in Apache Tomcat or Jetty</a></span></dt></dl></dd><dt><span class="section"><a href="#_the_numberguess_example_for_java_se_with_swing">7.2. The numberguess example for Java SE with Swing</a></span></dt><dd><dl><dt><span class="section"><a href="#_creating_the_eclipse_project">7.2.1. Creating the Eclipse project</a></span></dt><dt><span class="section"><a href="#_running_the_example_from_eclipse">7.2.2. Running the example from Eclipse</a></span></dt><dt><span class="section"><a href="#_running_the_example_from_the_command_line">7.2.3. Running the example from the command line</a></span></dt><dt><span class="section"><a href="#_understanding_the_code">7.2.4. Understanding the code</a></span></dt></dl></dd><dt><span class="section"><a href="#_the_translator_example_in_depth">7.3. The translator example in depth</a></span></dt></dl></dd></dl></div></div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_getting_started_with_weld"/>Chapter 6. Getting started with Weld</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_prerequisites">6.1. Prerequisites</a></span></dt><dt><span class="section"><a href="#_deploying_to_wildfly">6.2. Deploying to WildFly</a></span></dt><dt><span class="section"><a href="#_deploying_to_glassfish">6.3. Deploying to GlassFish</a></span></dt><dt><span class="section"><a href="#_deploying_to_apache_tomcat">6.4. Deploying to Apache Tomcat</a></span></dt><dt><span class="section"><a href="#_deploying_to_jetty">6.5. Deploying to Jetty</a></span></dt></dl></div>

<p>Weld comes with a number of examples. We recommend you start with
<code class="literal">examples/jsf/numberguess</code> and <code class="literal">examples/jsf/translator</code>. Numberguess is
a web (war) example containing only non-transactional managed beans.
This example can be run on a wide range of servers, including WildFly ,
GlassFish, Apache Tomcat, Jetty, Google App Engine, and any compliant
Java EE 7 container. Translator is an enterprise (ear) example that
contains session beans. This example must be run on WildFly 8 or better,
GlassFish 4 or better, or any compliant Java EE 7 container.</p>
<p>Both examples use JSF 2.2 as the web framework and, as such, can be
found in the <code class="literal">examples/jsf</code> directory of the Weld distribution.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_prerequisites"/>6.1. Prerequisites</h2></div></div></div>

<p>To run the examples with the provided build scripts, you’ll need the
following:</p>
<div class="itemizedlist"><ul><li>
the latest release of Weld, which contains the examples
</li><li>
Maven 3, to build and deploy the examples
</li><li>
<p>a supported runtime environment (minimum versions shown)</p>
<div class="itemizedlist"><ul><li>
WildFly 8.0.0.Final,
</li><li>
GlassFish 4.0,
</li><li>
Apache Tomcat 7 or better (war example only), or
</li><li>
Jetty 7 or better (war example only)
</li></ul></div>

</li></ul></div>

<p>In the next few sections, you’ll be using the Maven command (<code class="literal">mvn</code>) to
invoke the Maven project file in each example to compile, assemble and
deploy the example to WildFly and, for the war example, Apache Tomcat.
You can also deploy the generated artifact (war or ear) to any other
container that supports Java EE 7, such as GlassFish 4.</p>
<p>The sections below cover the steps for deploying with Maven in detail.
Let’s start with WildFly.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_deploying_to_wildfly"/>6.2. Deploying to WildFly</h2></div></div></div>

<p>To deploy the examples to WildFly, you’ll need
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://wildfly.org/downloads/">WildFly 8.0.0.Final</a> or above. The good
news is that there are no additional modifications you have to make to
the server. It’s ready to go!</p>
<p>After you have downloaded WildFly, extract it. (We recommended renaming
the folder to include the <code class="literal">as</code> qualifier so it’s clear that it’s the
application server). You can move the extracted folder anywhere you
like. Wherever it lays to rest, that’s what we’ll call the WildFly
installation directory, or <code class="literal">JBOSS_HOME</code>.</p>
<pre class="programlisting">$&gt; unzip wildfly-8.0.0.Final.zip
$&gt; mv wildfly-8.*/ wildfly-8</pre>

<p>In order for the build scripts to know where to deploy the example, you
have to tell them where to find your WildFly installation. Set the
<code class="literal">JBOSS_HOME</code> environment variable to point to the WildFly installation,
e.g.:</p>
<pre class="programlisting">$&gt; export JBOSS_HOME=/path/to/wildfly-8</pre>

<p>You’re now ready to run your first example!</p>
<p>Switch to the <code class="literal">examples/jsf/numberguess</code> directory and execute the Maven
<code class="literal">deploy</code> target:</p>
<pre class="programlisting">$&gt; cd examples/jsf/numberguess
$&gt; mvn jboss-as:run</pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>If you are using Eclipse, you should seriously consider installing the
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/tools">JBoss Tools</a> add-ons, which include a wide
variety of tooling for CDI and Java EE development, as well as an
enhanced WildFly server view.</p>
</div>

<p>Wait a few seconds for the application to deploy (or the application
server to start) and see if you can determine the most efficient
approach to pinpoint the random number at the local URL
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://localhost:8080/weld-numberguess">http://localhost:8080/weld-numberguess</a>.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The Maven WildFly plugin includes additional goals for WildFly to deploy
and undeploy the archive.</p>
<div class="itemizedlist"><ul><li>
<code class="literal">mvn wildfly:deploy</code> - deploy the example to a running WildFly
instance
</li><li>
<code class="literal">mvn wildfly:undeploy</code> - undeploy the example from a running WildFly
instance
</li><li>
<code class="literal">mvn wildfly:redeploy</code> - redeploys the example
</li></ul></div>

<p>For more information on the WildFly Maven plugin see the
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://docs.jboss.org/wildfly/plugins/maven/latest/">plugin
documentation</a>.</p>
</div>

<p>You can also run functional tests to verify that the example works as
expected. Run:</p>
<pre class="programlisting">$&gt; mvn verify -Darquillian=wildfly-managed-8</pre>

<p>You should see the following output:</p>
<pre class="programlisting">Tests run: 2, Failures: 0, Errors: 0, Skipped: 0</pre>

<p>The second starter example, <code class="literal">weld-translator</code>, will translate your text
into Latin. (Well, not really, but the stub is there for you to
implement, at least. Good luck!) To try it out, switch to the translator
example directory and execute the deploy target:</p>
<pre class="programlisting">$&gt; cd examples/jsf/translator/ear
$&gt; mvn jboss-as:run</pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The translator uses session beans, which are packaged in an EJB module
within an ear. Java EE 7 allows session beans to be deployed in war
modules, but that’s a topic for a later chapter.</p>
</div>

<p>Again, wait a few seconds for the application to deploy (if you’re
really bored, read the log messages), and visit
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://localhost:8080/weld-translator">http://localhost:8080/weld-translator</a> to begin pseudo-translating.</p>
<p>Again, functional tests can be running by executing:</p>
<pre class="programlisting">$&gt; cd examples/jsf/translator/ftest
$&gt; mvn verify -Darquillian=wildfly-managed-8</pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_deploying_to_glassfish"/>6.3. Deploying to GlassFish</h2></div></div></div>

<p>Deploying to GlassFish should be easy and familiar, right? After all,
it’s the Java EE 7 reference implementation and Weld is the CDI
reference implementation, meaning Weld gets bundled with GlassFish. So
yes, it’s all quite easy and familiar.</p>
<p>To deploy the examples to GlassFish, you’ll need a
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://glassfish.java.net/download.html">GlassFish 4.0</a> release. Select
the release that ends in either <code class="literal">-unix.sh</code> or <code class="literal">-windows.exe</code> depending
on your platform. After the download is complete, execute the installer.
On Linux/Unix, you’ll need to first make the script executable.</p>
<pre class="programlisting">$&gt; chmod 755 glassfish-4.0-unix.sh
$&gt; ./glassfish-4.0-unix.sh</pre>

<p>On Windows you can just click on the executable. Follow the instructions
in the installer. It will create a single domain named <code class="literal">domain1</code>. You’ll
use that domain to deploy the example. We recommend that you choose
<code class="literal">7070</code> as the main HTTP port to avoid conflicts with a running instance
of WildFly (or Apache Tomcat).</p>
<p>Next, make sure the <code class="literal">GLASSFISH_HOME</code> environment variable is set to
point to the GlassFish installation.</p>
<p>Now switch to the example directory again and create a new GlassFish
domain for the example.</p>
<pre class="programlisting">$&gt; cd examples/jsf/numberguess
$&gt; mvn glassfish:create-domain</pre>

<p>You are now ready to deploy the example by running:</p>
<pre class="programlisting">$&gt; mvn package glassfish:deploy</pre>

<p>Once the command completes the application is available at
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://localhost:7070/weld-numberguess">http://localhost:7070/weld-numberguess</a></p>
<p>The example is deployed using the <code class="literal">maven-glassfish-plugin</code>. For more
information about the plugin see the
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://maven-glassfish-plugin.java.net/">plugin documentation</a></p>
<p>There are alternative ways of,deploying applications to GlassFish either
by using the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://localhost:4848">GlassFish Admin Console</a> or the
<code class="literal">asadmin</code> command.</p>
<p>The reason the same artifact can be deployed to both WildFly and
GlassFish, without any modifications, is because all of the features
being used are part of the standard platform. And what a capable
platform it has become!</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_deploying_to_apache_tomcat"/>6.4. Deploying to Apache Tomcat</h2></div></div></div>

<p>Servlet containers are not required to support Java EE services like
CDI. However, you can use CDI in a servlet container like Tomcat by
embedding a standalone CDI implementation such as Weld.</p>
<p>Weld comes with servlet integration extension which bootstraps the CDI
environment and provides injection into servlets components. Basically,
it emulates some of the work done by the Java EE container, but you
don’t get the enterprise features such as session beans and
container-managed transactions.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Note that due to limitations of servlet containers (e.g. read-only JNDI)
your application might require some additional configuration as well
(see <a href="#_tomcat" title="18.3.1. Tomcat">Section 18.3.1, “Tomcat”</a> and <a href="#_jetty" title="18.3.2. Jetty">Section 18.3.2, “Jetty”</a> for more info).</p>
</div>

<p>Let’s give the Weld servlet extension a spin on Apache Tomcat. First,
you’ll need to download Tomcat 7.0.50 or later from
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://tomcat.apache.org/download-70.cgi">tomcat.apache.org</a> and extract
it.</p>
<pre class="programlisting">$&gt; unzip apache-tomcat-7.0.53.zip</pre>

<p>The Maven plugin communicates with Tomcat over HTTP, so it doesn’t care
where you have installed Tomcat. However, the plugin configuration
assumes you are running Tomcat in its default configuration, with a
hostname of localhost and port <code class="literal">8080</code>. The <code class="literal">readme.txt</code> file in the
example directory has information about how to modify the Maven settings
to accommodate a different setup.</p>
<p>To allow Maven to communicate with Tomcat over HTTP, edit the
<code class="literal">conf/tomcat-users.xml</code> file in your Tomcat installation. For Tomcat 7
and higher add the following line:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">user</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">username</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;admin&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">password</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">roles</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;manager-script&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>Next, start Tomcat. You can either start Tomcat from a Linux shell:</p>
<pre class="programlisting">$&gt; cd /path/to/apache-tomcat-7
$&gt; ./bin/start.sh</pre>

<p>a Windows command window:</p>
<pre class="programlisting">$&gt; cd c:\path\to\apache-tomcat-7\bin
$&gt; start</pre>

<p>or you can start the server using an IDE, like Eclipse.</p>
<p>Now you’re ready to deploy the numberguess example to Tomcat!</p>
<p>Change to the <code class="literal">examples/jsf/numberguess</code> directory again and run the
following Maven command:</p>
<pre class="programlisting">$&gt; cd examples/jsf/numberguess
$&gt; mvn clean compile war:exploded tomcat7:deploy -Ptomcat</pre>

<p>Once the application is deployed, you can redeploy it using this
command:</p>
<pre class="programlisting">$&gt; mvn tomcat7:redeploy -Ptomcat</pre>

<p>The <code class="literal">-Ptomcat</code> argument activates the <code class="literal">tomcat</code> profile defined in the
Maven POM (<code class="literal">pom.xml</code>). Among other things, this profile activates the
Tomcat plugin.</p>
<p>Rather than shipping the container off to a standalone Tomcat
installation, you can also execute the application in an embedded Tomcat
6 container:</p>
<pre class="programlisting">$&gt; mvn war:inplace tomcat7:run -Ptomcat</pre>

<p>The advantage of using the embedded server is that changes to assets in
<code class="literal">src/main/webapp</code> take effect immediately. If a change to a webapp
configuration file is made, the application may automatically redeploy
(depending on the plugin configuration). If you make a change to a
classpath resource, you need to execute a build:</p>
<pre class="programlisting">$&gt; mvn compile war:inplace -Ptomcat</pre>

<p>Finally, you can run the functional tests:</p>
<pre class="programlisting">$&gt; mvn verify -Darquillian=tomcat-embedded-7 -Ptomcat</pre>

<p>There are several other Maven goals that you can use if you are hacking
on the example, which are documented in the example’s <code class="literal">README.md</code> file.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_deploying_to_jetty"/>6.5. Deploying to Jetty</h2></div></div></div>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2>
<p>Jetty Maven plugin is temporarily unsupported in Weld examples.</p>
</div>

<p>If you’ve read through the entire Tomcat section, then you’re all ready
to go. The Maven build parallels the embedded Tomcat deployment. If not,
don’t worry. We’ll still go over everything that you need to know again
in this section.</p>
<p>The Maven POM (<code class="literal">pom.xml</code>) includes a profile named <code class="literal">jetty</code> that
activates the Maven Jetty plugin, which you can use to start Jetty in
embedded mode and deploy the application in place. You don’t need
anything else installed except to have the Maven command (<code class="literal">mvn</code>) on your
path. The rest will be downloaded from the internet when the build is
run.</p>
<p>To run the <code class="literal">weld-numberguess</code> example on Jetty, switch to the example
directory and execute the <code class="literal">inplace</code> goal of the Maven war plugin
followed by the <code class="literal">run</code> goal of the Maven Jetty plugin with the <code class="literal">jetty</code>
profile enabled, as follows:</p>
<pre class="programlisting">$&gt; cd examples/jsf/numberguess
$&gt; mvn war:inplace jetty:run -Pjetty</pre>

<p>The log output of Jetty will be shown in the console. Once Jetty reports
that the application has deployed, you can access it at the following
local URL: <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://localhost:9090/weld-numberguess">http://localhost:9090/weld-numberguess</a>. The port is defined
in the Maven Jetty plugin configuration within the <code class="literal">jetty</code> profile.</p>
<p>Any changes to assets in <code class="literal">src/main/webapp</code> take effect immediately. If a
change to a webapp configuration file is made, the application may
automatically redeploy. The redeploy behavior can be fined-tuned in the
plugin configuration. If you make a change to a classpath resource, you
need to execute a build and the <code class="literal">inplace</code> goal of the Maven war plugin,
again with the <code class="literal">jetty</code> profile enabled.</p>
<pre class="programlisting">$&gt; mvn compile war:inplace -Pjetty</pre>

<p>The <code class="literal">war:inplace</code> goal copies the compiled classes and jars inside
<code class="literal">src/main/webapp</code>, under <code class="literal">WEB-INF/classes</code> and <code class="literal">WEB-INF/lib</code>,
respectively, mixing source and compiled files. However, the build does
work around these temporary files by excluding them from the packaged
war and cleaning them during the Maven clean phase.</p>
<p>Finally, you can run the functional tests:</p>
<pre class="programlisting">$&gt; mvn verify -Darquillian=jetty-embedded-7 -Pjetty</pre>

<p>Now that you have gotten the starter applications deployed on the server
of your choice, you probably want to know a little bit about how they
actually work.</p>
</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_diving_into_the_weld_examples"/>Chapter 7. Diving into the Weld examples</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_the_numberguess_example_in_depth">7.1. The numberguess example in depth</a></span></dt><dd><dl><dt><span class="section"><a href="#_the_numberguess_example_in_apache_tomcat_or_jetty">7.1.1. The numberguess example in Apache Tomcat or Jetty</a></span></dt></dl></dd><dt><span class="section"><a href="#_the_numberguess_example_for_java_se_with_swing">7.2. The numberguess example for Java SE with Swing</a></span></dt><dd><dl><dt><span class="section"><a href="#_creating_the_eclipse_project">7.2.1. Creating the Eclipse project</a></span></dt><dt><span class="section"><a href="#_running_the_example_from_eclipse">7.2.2. Running the example from Eclipse</a></span></dt><dt><span class="section"><a href="#_running_the_example_from_the_command_line">7.2.3. Running the example from the command line</a></span></dt><dt><span class="section"><a href="#_understanding_the_code">7.2.4. Understanding the code</a></span></dt></dl></dd><dt><span class="section"><a href="#_the_translator_example_in_depth">7.3. The translator example in depth</a></span></dt></dl></div>

<p>It’s time to pull the covers back and dive into the internals of Weld
example applications. Let’s start with the simpler of the two examples,
<code class="literal">weld-numberguess</code>.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_numberguess_example_in_depth"/>7.1. The numberguess example in depth</h2></div></div></div>

<p>In the numberguess application you get 10 attempts to guess a number
between 1 and 100. After each attempt, you’re told whether your guess
was too high or too low.</p>
<p>The numberguess example is comprised of a number of beans, configuration
files and Facelets (JSF) views, packaged as a war module. Let’s start by
examining the configuration files.</p>
<p>All the configuration files for this example are located in <code class="literal">WEB-INF/</code>,
which can be found in the <code class="literal">src/main/webapp</code> directory of the example.
First, we have the JSF 2.2 version of <code class="literal">faces-config.xml</code>. A standardized
version of Facelets is the default view handler in JSF 2.2, so there’s
really nothing that we have to configure. Thus, the configuration
consists of only the root element.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">faces-config</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2.2&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee/web-facesconfig_2_2.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">numberguess</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">faces-config</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>There’s also an empty <code class="literal">beans.xml</code> file, which tells the container to
look for beans in this archive and to activate the CDI services.</p>
<p>Finally, some of the supported servers also need a <code class="literal">web.xml</code> which is
located in <code class="literal">src/main/webapp-[server]/WEB-INF</code>.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>This demo uses JSF 2 as the view framework, but you can use Weld with
any servlet-based web framework, such as JSF 1.2 or Wicket.</p>
</div>

<p>Let’s take a look at the main JSF view, <code class="literal">src/main/webapp/home.xhtml</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_plain">!</span><span class="xml_attribute_name">DOCTYPE</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">html</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">PUBLIC</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_value">&quot;-//W3C//DTD&nbsp;XHTML&nbsp;1.0&nbsp;Transitional//EN&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_value">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">html</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:ui</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/jsf/facelets&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:h</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/jsf/html&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:f</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/jsf/core&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">ui:composition</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">template</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/template.xhtml&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<a xmlns="http://www.w3.org/1999/xhtml" id="CO2-1"/><img src="images/seamframework/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">ui:define</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;content&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h1</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Guess&nbsp;a&nbsp;number...</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h1</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:form</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;numberGuess&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">div</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">style</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;color:&nbsp;red&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:messages</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;messages&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">globalOnly</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<a xmlns="http://www.w3.org/1999/xhtml" id="CO2-2"/><img src="images/seamframework/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:outputText</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Higher&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Higher!&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rendered</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{game.guessLower}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:outputText</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Lower&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Lower!&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rendered</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{game.guessHigher}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I'm&nbsp;thinking&nbsp;of&nbsp;a&nbsp;number&nbsp;between</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">span</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;numberGuess:smallest&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">#{game.smallest}</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">span</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">span</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;numberGuess:biggest&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">#{game.biggest}</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">span</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">.</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;You&nbsp;have&nbsp;#{game.remainingGuesses}&nbsp;guesses&nbsp;remaining.&nbsp;</span><br />
<a xmlns="http://www.w3.org/1999/xhtml" id="CO2-3"/><img src="images/seamframework/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Your&nbsp;guess:</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:inputText</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;inputGuess&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{game.guess}&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">required</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">size</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;3&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">disabled</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{game.guessCorrect}&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">validator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{game.validateNumberRange}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<a xmlns="http://www.w3.org/1999/xhtml" id="CO2-4"/><img src="images/seamframework/docbook/callouts/4.png" alt="4" border="0" height="17px" width="17px"/><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;</span><br />
<a xmlns="http://www.w3.org/1999/xhtml" id="CO2-5"/><img src="images/seamframework/docbook/callouts/5.png" alt="5" border="0" height="17px" width="17px"/><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:commandButton</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;guessButton&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Guess&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">action</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{game.check}&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">disabled</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{game.guessCorrect}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<a xmlns="http://www.w3.org/1999/xhtml" id="CO2-6"/><img src="images/seamframework/docbook/callouts/6.png" alt="6" border="0" height="17px" width="17px"/><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:commandButton</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;restartButton&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Reset&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">action</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{game.reset}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">immediate</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:form</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">ui:define</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">ui:composition</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">html</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#CO2-1"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>Facelets is the built-in templating language for JSF. Here we are
wrapping our page in a template which defines the layout.</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO2-2"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>There are a number of messages which can be sent to the user, "Higher!",
"Lower!" and "Correct!"</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO2-3"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>As the user guesses, the range of numbers they can guess gets smaller -
this sentence changes to make sure they know the number range of a valid
guess.</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO2-4"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/4.png" alt="4" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>This input field is bound to a bean property using a value expression.</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO2-5"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/5.png" alt="5" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>A validator binding is used to make sure the user doesn’t accidentally
input a number outside of the range in which they can guess - if the
validator wasn’t here, the user might use up a guess on an out of bounds
number.</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO2-6"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/6.png" alt="6" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>And, of course, there must be a way for the user to send their guess to
the server. Here we bind to an action method on the bean.</p>
    
  </td></tr></table></div>

<p>The example consists of 4 classes, the first two of which are
qualifiers. First, there is the <code class="literal">@Random</code> qualifier, used for injecting
a random number:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Random</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>There is also the <code class="literal">@MaxNumber</code> qualifier, used for injecting the maximum
number that can be injected:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">MaxNumber</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>The application-scoped <code class="literal">Generator</code> class is responsible for creating the
random number, via a producer method. It also exposes the maximum
possible number via a producer method:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">ApplicationScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Generator</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">Random</span><span class="java_plain">&nbsp;random&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">Random</span><span class="java_separator">(</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">currentTimeMillis</span><span class="java_separator">());</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;MAX_NUMBER&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">100</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">Random</span><span class="java_plain">&nbsp;getRandom</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;random</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Random</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;next</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">a&nbsp;number&nbsp;between&nbsp;</span><span class="java_literal">1</span><span class="java_plain">&nbsp;and&nbsp;</span><span class="java_literal">100</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;getRandom</span><span class="java_separator">().</span><span class="java_plain">nextInt</span><span class="java_separator">(</span><span class="java_plain">MAX_NUMBER&nbsp;</span><span class="java_operator">-</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MaxNumber</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getMaxNumber</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;MAX_NUMBER</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The <code class="literal">Generator</code> is application scoped, so we don’t get a different
random each time.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The package declaration and imports have been excluded from these
listings. The complete listing is available in the example source code.</p>
</div>

<p>The final bean in the application is the session-scoped <code class="literal">Game</code> class.
This is the primary entry point of the application. It’s responsible for
setting up or resetting the game, capturing and validating the user’s
guess and providing feedback to the user with a <code class="literal">FacesMessage</code>. We’ve
used the post-construct lifecycle method to initialize the game by
retrieving a random number from the <code class="literal">@Random
         Instance&lt;Integer&gt;</code> bean.</p>
<p>You’ll notice that we’ve also added the <code class="literal">@Named</code> annotation to this
class. This annotation is only required when you want to make the bean
accessible to a JSF view via EL (i.e., #{game}).</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Instance</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Named</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">SessionScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Game</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;DEFAULT_REMAINING_GUESSES&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;guess</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;smallest</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;biggest</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;remainingGuesses</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MaxNumber</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;maxNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Random</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Instance</span><span class="java_operator">&lt;</span><span class="java_type">Integer</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;randomNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Game</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getNumber</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getGuess</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;guess</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setGuess</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;guess</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;guess</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getSmallest</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;smallest</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getBiggest</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;biggest</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getRemainingGuesses</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;remainingGuesses</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;check</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;biggest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">-</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;smallest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">FacesContext</span><span class="java_separator">.</span><span class="java_plain">getCurrentInstance</span><span class="java_separator">().</span><span class="java_plain">addMessage</span><span class="java_separator">(</span><span class="java_literal">null</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">FacesMessage</span><span class="java_separator">(</span><span class="java_literal">&quot;Correct!&quot;</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remainingGuesses</span><span class="java_operator">--</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PostConstruct</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;reset</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">smallest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">remainingGuesses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;DEFAULT_REMAINING_GUESSES</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">biggest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;maxNumber</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">number&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;randomNumber</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;validateNumberRange</span><span class="java_separator">(</span><span class="java_type">FacesContext</span><span class="java_plain">&nbsp;context</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">UIComponent</span><span class="java_plain">&nbsp;toValidate</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;value</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">remainingGuesses&nbsp;</span><span class="java_operator">&lt;=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">FacesMessage</span><span class="java_plain">&nbsp;message&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">FacesMessage</span><span class="java_separator">(</span><span class="java_literal">&quot;No&nbsp;guesses&nbsp;left!&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context</span><span class="java_separator">.</span><span class="java_plain">addMessage</span><span class="java_separator">(</span><span class="java_plain">toValidate</span><span class="java_separator">.</span><span class="java_plain">getClientId</span><span class="java_separator">(</span><span class="java_plain">context</span><span class="java_separator">),</span><span class="java_plain">&nbsp;message</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">((</span><span class="java_type">UIInput</span><span class="java_separator">)</span><span class="java_plain">&nbsp;toValidate</span><span class="java_separator">).</span><span class="java_plain">setValid</span><span class="java_separator">(</span><span class="java_literal">false</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;input&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">input&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;smallest&nbsp;</span><span class="java_operator">||</span><span class="java_plain">&nbsp;input&nbsp;</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;biggest</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">((</span><span class="java_type">UIInput</span><span class="java_separator">)</span><span class="java_plain">&nbsp;toValidate</span><span class="java_separator">).</span><span class="java_plain">setValid</span><span class="java_separator">(</span><span class="java_literal">false</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">FacesMessage</span><span class="java_plain">&nbsp;message&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">FacesMessage</span><span class="java_separator">(</span><span class="java_literal">&quot;Invalid&nbsp;guess&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context</span><span class="java_separator">.</span><span class="java_plain">addMessage</span><span class="java_separator">(</span><span class="java_plain">toValidate</span><span class="java_separator">.</span><span class="java_plain">getClientId</span><span class="java_separator">(</span><span class="java_plain">context</span><span class="java_separator">),</span><span class="java_plain">&nbsp;message</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isGuessHigher</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_operator">&amp;&amp;</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isGuessLower</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_operator">&amp;&amp;</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isGuessCorrect</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_the_numberguess_example_in_apache_tomcat_or_jetty"/>7.1.1. The numberguess example in Apache Tomcat or Jetty</h3></div></div></div>

<p>A couple of modifications must be made to the numberguess artifact in
order to deploy it to Tomcat or Jetty. First, Weld must be deployed as a
Web Application library under <code class="literal">WEB-INF/lib</code> since the servlet container
does not provide the CDI services. For your convenience we provide a
single jar suitable for running Weld in any servlet container (including
Jetty), <code class="literal">weld-servlet.jar</code>.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>You must also include the jars for JSF, EL, and the common annotations
(<code class="literal">jsr250-api.jar</code>), all of which are provided by the Java EE platform (a
Java EE application server).</p>
</div>

<p>Second, we need to explicitly specify the servlet listener in <code class="literal">web.xml</code>,
again because the container isn’t doing this stuff for you. The servlet
listener boots Weld and controls it’s interaction with requests.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.weld.environment.servlet.Listener</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">listener-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">listener</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>When Weld boots, it places the
<code class="literal">javax.enterprise.inject.spi.BeanManager</code>, the portable SPI for
obtaining bean instances, in the <code class="literal">ServletContext</code> under a variable name
equal to the fully-qualified interface name. You generally don’t need to
access this interface, but Weld makes use of it.</p>
</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_numberguess_example_for_java_se_with_swing"/>7.2. The numberguess example for Java SE with Swing</h2></div></div></div>

<p>This example shows how to use the Weld SE extension in a Java SE based
Swing application with no EJB or servlet dependencies. This example can
be found in the <code class="literal">examples/se/numberguess</code> folder of the Weld
distribution.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_creating_the_eclipse_project"/>7.2.1. Creating the Eclipse project</h3></div></div></div>

<p>To use the Weld SE numberguess example in Eclipse, you can either import
it as a Maven project if you have the
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://m2eclipse.sonatype.org/">m2eclipse plugin</a> installed, or generate
an Eclipse project and import it.</p>
<p>With m2eclipse installed, you can open any Maven project directly. From
within Eclipse, select <span class="emphasis"><em>File -&gt; Import… -&gt; Existing Maven Projects</em></span>.
Then, browse to the location of the Weld SE numberguess example. You
should see that Eclipse recognizes the Maven project.</p>
<p>Without m2eclipse plugin, you first have to generate an Eclipse project.
Switch into the Weld SE numberguess example folder, then execute the
Maven Eclipse plugin, as follows:</p>
<pre class="programlisting">mvn eclipse:configure-workspace -Declipse.workspace=/path/to/your/eclipse/workspace</pre>

<p>and then</p>
<pre class="programlisting">mvn eclipse:eclipse</pre>

<p>Then from within Eclipse, select <span class="emphasis"><em>File -&gt; Import… -&gt; Existing Projects
into Workspace</em></span> and browse to the location of the Weld SE numberguess
example.</p>
<p>In both cases, you should now see a project in your workspace called
<code class="literal">weld-se-numberguess</code>.</p>
<p>It’s time to get the example running!</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_running_the_example_from_eclipse"/>7.2.2. Running the example from Eclipse</h3></div></div></div>

<p>Disable m2eclipse’s <span class="emphasis"><em>Workspace Resolution</em></span>, to make sure that Eclipse
can find <code class="literal">StartMain</code>. Right click on the project, and choose <span class="emphasis"><em>Properties
-&gt; Maven</em></span>, and uncheck <span class="emphasis"><em>Resolve dependencies from Workspace projects</em></span>:</p>
<p><span class="inlinemediaobject"><img src="images/weld-se-numberguess-m2eclipse-1.png" alt="image"/></span></p>
<p>Right click on the project, and choose <span class="emphasis"><em>Run As -&gt; Java Application</em></span>:</p>
<p><span class="inlinemediaobject"><img src="images/weld-se-numberguess-m2eclipse-2.png" alt="image"/></span></p>
<p>Locate the <code class="literal">StartMain</code> class:</p>
<p><span class="inlinemediaobject"><img src="images/weld-se-numberguess-m2eclipse-3.png" alt="image"/></span></p>
<p>The application should now launch!</p>
<p><span class="inlinemediaobject"><img src="images/weld-se-numberguess-m2eclipse-4.png" alt="image"/></span></p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_running_the_example_from_the_command_line"/>7.2.3. Running the example from the command line</h3></div></div></div>

<div class="itemizedlist"><ul><li>
Ensure that Maven 3 is installed and in your PATH
</li><li>
Ensure that the <code class="literal">JAVA_HOME</code> environment variable is pointing to your
JDK installation
</li><li>
Open a command line or terminal window in the
<code class="literal">examples/se/numberguess</code> directory
</li><li>
<p>Execute the following command</p>
<pre class="programlisting">mvn -Drun</pre>

</li></ul></div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_understanding_the_code"/>7.2.4. Understanding the code</h3></div></div></div>

<p>Let’s have a look at the significant code and configuration files that
make up this example.</p>
<p>There is an empty <code class="literal">beans.xml</code> file in the root package
(<code class="literal">src/main/resources/META-INF/beans.xml</code>), which marks this application
as a CDI application.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The <code class="literal">beans.xml</code> file is no longer required for CDI enablement as of CDI
1.1. CDI is automatically enabled for archives which don’t contain
<code class="literal">beans.xml</code> but contain one or more bean classes with a <span class="emphasis"><em>bean defining
annotation</em></span>, as described in section <a href="#_implicit_bean_archive" title="15.6.2. Implicit bean archive">Section 15.6.2, “Implicit bean archive”</a>.</p>
</div>

<p>The game’s main logic is located in <code class="literal">Game.java</code>. Here is the code for
that class, highlighting the ways in which this differs from the web
application version:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">ApplicationScoped</span><!-- <br/> --><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO3-1"/><img src="images/seamframework/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Game</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO3-2"/><img src="images/seamframework/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;MAX_NUM_GUESSES&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;smallest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MaxNumber</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;maxNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;biggest</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;remainingGuesses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;MAX_NUM_GUESSES</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;validNumberRange&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Generator</span><span class="java_plain">&nbsp;rndGenerator</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Game</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getNumber</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getGuess</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;guess</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setGuess</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;guess</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;guess</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getSmallest</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;smallest</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getBiggest</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;biggest</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getRemainingGuesses</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;remainingGuesses</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isValidNumberRange</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO3-3"/><img src="images/seamframework/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;validNumberRange</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isGameWon</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isGameLost</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;number&nbsp;</span><span class="java_operator">&amp;&amp;</span><span class="java_plain">&nbsp;remainingGuesses&nbsp;</span><span class="java_operator">&lt;=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;check</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO3-4"/><img src="images/seamframework/docbook/callouts/4.png" alt="4" border="0" height="17px" width="17px"/></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">checkNewNumberRangeIsValid</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;biggest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">-</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;smallest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remainingGuesses</span><span class="java_operator">--</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;result</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;checkNewNumberRangeIsValid</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;validNumberRange&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">((</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">&gt;=</span><span class="java_plain">&nbsp;smallest</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">&amp;&amp;</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">&lt;=</span><span class="java_plain">&nbsp;biggest</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PostConstruct</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;reset</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO3-5"/><img src="images/seamframework/docbook/callouts/5.png" alt="5" border="0" height="17px" width="17px"/></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">smallest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">guess&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">remainingGuesses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">biggest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;maxNumber</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">number&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rndGenerator</span><span class="java_separator">.</span><span class="java_plain">next</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_literal">&quot;psst!&nbsp;the&nbsp;number&nbsp;is&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">number</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#CO3-1"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>The bean is application scoped rather than session scoped, since an
instance of a Swing application typically represents a single <span class="emphasis"><em>session</em></span>.</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO3-2"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>Notice that the bean is not named, since it doesn’t need to be accessed
via EL.</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO3-3"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>In Java SE there is no JSF <code class="literal">FacesContext</code> to which messages can be
added. Instead the <code class="literal">Game</code> class provides additional information about
the state of the current game including:</p>
    
<div class="itemizedlist"><ul><li>
If the game has been won or lost
</li><li>
<p>If the most recent guess was invalid</p>
<p>This allows the Swing UI to query the state of the game, which it does
indirectly via a class called <code class="literal">MessageGenerator</code>, in order to determine
the appropriate messages to display to the user during the game.</p>
</li></ul></div>

    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO3-4"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/4.png" alt="4" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>Since there is no dedicated validation phase, validation of user input
is performed during the <code class="literal">check()</code> method.</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO3-5"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/5.png" alt="5" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>The <code class="literal">reset()</code> method makes a call to the injected <code class="literal">rndGenerator</code> in
order to get the random number at the start of each game. Note that it
can’t use <code class="literal">Instance.get()</code> like the JSF example does because there will
not be any active contexts like there are during a JSF request.</p>
    
  </td></tr></table></div>

<p>The <code class="literal">MessageGenerator</code> class depends on the current instance of <code class="literal">Game</code>
and queries its state in order to determine the appropriate messages to
provide as the prompt for the user’s next guess and the response to the
previous guess. The code for <code class="literal">MessageGenerator</code> is as follows:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">MessageGenerator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO4-1"/><img src="images/seamframework/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Game</span><span class="java_plain">&nbsp;game</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getChallengeMessage</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO4-2"/><img src="images/seamframework/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_plain">&nbsp;challengeMsg&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_separator">(</span><span class="java_literal">&quot;I'm&nbsp;thinking&nbsp;of&nbsp;a&nbsp;number&nbsp;between&nbsp;&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;challengeMsg</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">game</span><span class="java_separator">.</span><span class="java_plain">getSmallest</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;challengeMsg</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_literal">&quot;&nbsp;and&nbsp;&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;challengeMsg</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">game</span><span class="java_separator">.</span><span class="java_plain">getBiggest</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;challengeMsg</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_literal">&quot;.&nbsp;Can&nbsp;you&nbsp;guess&nbsp;what&nbsp;it&nbsp;is?&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;challengeMsg</span><span class="java_separator">.</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getResultMessage</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO4-3"/><img src="images/seamframework/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">game</span><span class="java_separator">.</span><span class="java_plain">isGameWon</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;You&nbsp;guessed&nbsp;it!&nbsp;The&nbsp;number&nbsp;was&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;game</span><span class="java_separator">.</span><span class="java_plain">getNumber</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">game</span><span class="java_separator">.</span><span class="java_plain">isGameLost</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;You&nbsp;are&nbsp;fail!&nbsp;The&nbsp;number&nbsp;was&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;game</span><span class="java_separator">.</span><span class="java_plain">getNumber</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_operator">!</span><span class="java_plain">game</span><span class="java_separator">.</span><span class="java_plain">isValidNumberRange</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Invalid&nbsp;number&nbsp;range!&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">game</span><span class="java_separator">.</span><span class="java_plain">getRemainingGuesses</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_type">Game</span><span class="java_separator">.</span><span class="java_plain">MAX_NUM_GUESSES</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;What&nbsp;is&nbsp;your&nbsp;first&nbsp;guess?&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;direction&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">game</span><span class="java_separator">.</span><span class="java_plain">getGuess</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;game</span><span class="java_separator">.</span><span class="java_plain">getNumber</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;direction&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Higher&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;direction&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Lower&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;direction&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;!&nbsp;You&nbsp;have&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;game</span><span class="java_separator">.</span><span class="java_plain">getRemainingGuesses</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&nbsp;guesses&nbsp;left.&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#CO4-1"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>The instance of <code class="literal">Game</code> for the application is injected here.</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO4-2"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>The <code class="literal">Game</code>'s state is interrogated to determine the appropriate
challenge message …</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO4-3"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>… and again to determine whether to congratulate, console or encourage
the user to continue.</p>
    
  </td></tr></table></div>

<p>Finally we come to the <code class="literal">NumberGuessFrame</code> class which provides the Swing
front end to our guessing game.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">event</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NumberGuessFrame</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">swing</span><span class="java_separator">.</span><span class="java_type">JFrame</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Game</span><span class="java_plain">&nbsp;game</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO5-1"/><img src="images/seamframework/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">MessageGenerator</span><span class="java_plain">&nbsp;msgGenerator</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO5-2"/><img src="images/seamframework/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;start</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_plain">&nbsp;</span><span class="java_type">ContainerInitialized</span><span class="java_plain">&nbsp;event</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO5-3"/><img src="images/seamframework/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">awt</span><span class="java_separator">.</span><span class="java_type">EventQueue</span><span class="java_separator">.</span><span class="java_plain">invokeLater</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Runnable</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;run</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initComponents</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setVisible</span><span class="java_separator">(</span><span class="java_literal">true</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">});</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initComponents</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO5-4"/><img src="images/seamframework/docbook/callouts/4.png" alt="4" border="0" height="17px" width="17px"/></span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;borderPanel&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">swing</span><span class="java_separator">.</span><span class="java_type">JPanel</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gamePanel&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">swing</span><span class="java_separator">.</span><span class="java_type">JPanel</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inputsPanel&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">swing</span><span class="java_separator">.</span><span class="java_type">JPanel</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buttonPanel&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">swing</span><span class="java_separator">.</span><span class="java_type">JPanel</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;guessButton&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">swing</span><span class="java_separator">.</span><span class="java_type">JButton</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainLabel</span><span class="java_separator">.</span><span class="java_plain">setText</span><span class="java_separator">(</span><span class="java_plain">msgGenerator</span><span class="java_separator">.</span><span class="java_plain">getChallengeMessage</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainMsgPanel</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">mainLabel</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageLabel</span><span class="java_separator">.</span><span class="java_plain">setText</span><span class="java_separator">(</span><span class="java_plain">msgGenerator</span><span class="java_separator">.</span><span class="java_plain">getResultMessage</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainMsgPanel</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">messageLabel</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;guessButtonActionPerformed</span><span class="java_separator">(</span><span class="java_plain">java</span><span class="java_separator">.</span><span class="java_plain">awt</span><span class="java_separator">.</span><span class="java_plain">event</span><span class="java_separator">.</span><span class="java_type">ActionEvent</span><span class="java_plain">&nbsp;evt</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO5-5"/><img src="images/seamframework/docbook/callouts/5.png" alt="5" border="0" height="17px" width="17px"/></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;guess&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_operator">-</span><span class="java_literal">1</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;guess&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_separator">.</span><span class="java_plain">parseInt</span><span class="java_separator">(</span><span class="java_plain">guessText</span><span class="java_separator">.</span><span class="java_plain">getText</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">NumberFormatException</span><span class="java_plain">&nbsp;nfe</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;noop</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;game</span><span class="java_separator">.</span><span class="java_plain">setGuess</span><span class="java_separator">(</span><span class="java_plain">guess</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;game</span><span class="java_separator">.</span><span class="java_plain">check</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;refreshUI</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">game</span><span class="java_separator">.</span><span class="java_plain">isGameWon</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">||</span><span class="java_plain">&nbsp;game</span><span class="java_separator">.</span><span class="java_plain">isGameLost</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switchButtons</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;replayBtnActionPerformed</span><span class="java_separator">(</span><span class="java_plain">java</span><span class="java_separator">.</span><span class="java_plain">awt</span><span class="java_separator">.</span><span class="java_plain">event</span><span class="java_separator">.</span><span class="java_type">ActionEvent</span><span class="java_plain">&nbsp;evt</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><a xmlns="http://www.w3.org/1999/xhtml" id="CO5-6"/><img src="images/seamframework/docbook/callouts/6.png" alt="6" border="0" height="17px" width="17px"/></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;game</span><span class="java_separator">.</span><span class="java_plain">reset</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;refreshUI</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switchButtons</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;switchButtons</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CardLayout</span><span class="java_plain">&nbsp;buttonLyt&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">CardLayout</span><span class="java_separator">)</span><span class="java_plain">&nbsp;buttonPanel</span><span class="java_separator">.</span><span class="java_plain">getLayout</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buttonLyt</span><span class="java_separator">.</span><span class="java_plain">next</span><span class="java_separator">(</span><span class="java_plain">buttonPanel</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;refreshUI</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainLabel</span><span class="java_separator">.</span><span class="java_plain">setText</span><span class="java_separator">(</span><span class="java_plain">msgGenerator</span><span class="java_separator">.</span><span class="java_plain">getChallengeMessage</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageLabel</span><span class="java_separator">.</span><span class="java_plain">setText</span><span class="java_separator">(</span><span class="java_plain">msgGenerator</span><span class="java_separator">.</span><span class="java_plain">getResultMessage</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;guessText</span><span class="java_separator">.</span><span class="java_plain">setText</span><span class="java_separator">(</span><span class="java_literal">&quot;&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;guessesLeftBar</span><span class="java_separator">.</span><span class="java_plain">setValue</span><span class="java_separator">(</span><span class="java_plain">game</span><span class="java_separator">.</span><span class="java_plain">getRemainingGuesses</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;guessText</span><span class="java_separator">.</span><span class="java_plain">requestFocus</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;swing&nbsp;components</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">swing</span><span class="java_separator">.</span><span class="java_type">JPanel</span><span class="java_plain">&nbsp;borderPanel</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">swing</span><span class="java_separator">.</span><span class="java_type">JButton</span><span class="java_plain">&nbsp;replayBtn</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#CO5-1"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>The injected instance of the game (logic and state).</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO5-2"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>The injected message generator for UI messages.</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO5-3"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>This application is started in the prescribed Weld SE way, by observing
the <code class="literal">ContainerInitialized</code> event.</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO5-4"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/4.png" alt="4" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p>This method initializes all of the Swing components. Note the use of the
<code class="literal">msgGenerator</code> here.</p>
    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO5-5"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/5.png" alt="5" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p><code class="literal">guessButtonActionPerformed</code> is called when the <span class="emphasis"><em>Guess</em></span> button is
clicked, and it does the following:</p>
    
<div class="itemizedlist"><ul><li>
Gets the guess entered by the user and sets it as the current guess in
the <code class="literal">Game</code>
</li><li>
Calls <code class="literal">game.check()</code> to validate and perform one <span class="emphasis"><em>turn</em></span> of the game
</li><li>
Calls <code class="literal">refreshUI</code>. If there were validation errors with the input,
this will have been captured during <code class="literal">game.check()</code> and as such will be
reflected in the messages returned by <code class="literal">MessageGenerator</code> and
subsequently presented to the user. If there are no validation errors
then the user will be told to guess again (higher or lower) or that the
game has ended either in a win (correct guess) or a loss (ran out of
guesses).
</li><li>
Sets the button’s label based on the game state.
</li></ul></div>

    
  </td></tr><tr><td width="5%" valign="top" align="left"><a href="#CO5-6"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/seamframework/docbook/callouts/6.png" alt="6" border="0" height="17px" width="17px"/></a> </td><td valign="top" align="left">
    <p><code class="literal">replayBtnActionPerformed</code> simply calls <code class="literal">game.reset()</code> to start a new
game, refreshes the messages in the UI and sets the button’s label based
on the game state.</p>
    
  </td></tr></table></div>

</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_translator_example_in_depth"/>7.3. The translator example in depth</h2></div></div></div>

<p>The translator example will take any sentences you enter, and translate
them to Latin. (Well, not really, but the stub is there for you to
implement, at least. Good luck!)</p>
<p>The translator example is built as an EAR and contains EJBs. As a
result, it’s structure is more complex than the numberguess example.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Java EE 7, which bundles EJB 3.2, allows you to package EJBs in a WAR,
which will make this structure much simpler! Still, there are other
advantages of using an EAR.</p>
</div>

<p>First, let’s take a look at the EAR aggregator project, which is located
in the example’s <code class="literal">ear</code> directory. Maven automatically generates the
<code class="literal">application.xml</code> for us from this plugin configuration:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">plugin</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.apache.maven.plugins</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">maven-ear-plugin</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">modules</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">webModule</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.weld.examples.jsf.translator</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">weld-jsf-translator-war</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">contextRoot</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/weld-translator</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">contextRoot</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">webModule</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">modules</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">plugin</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>This configuration overrides the web context path, resulting in this
application URL: <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://localhost:8080/weld-translator">http://localhost:8080/weld-translator</a>.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>If you weren’t using Maven to generate these files, you would need
<code class="literal">META-INF/application.xml</code>:</p>
<pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">application</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;7&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee/application_7.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">display-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">weld-jsf-translator-ear</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">display-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">description</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">The&nbsp;Weld&nbsp;JSF&nbsp;translator&nbsp;example&nbsp;(ear)</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">description</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">web</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">web-uri</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">weld-translator.war</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">web-uri</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">context-root</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/weld-translator</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">context-root</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">web</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">module</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">ejb</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">weld-translator.jar</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">ejb</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">module</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">application</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

</div>

<p>Next, let’s look at the WAR, which is located in the example’s <code class="literal">war</code>
directory. Just as in the numberguess example, we have a
<code class="literal">faces-config.xml</code> for JSF 2.2 and a <code class="literal">web.xml</code> (to activate JSF) under
WEB-INF, both sourced from <code class="literal">src/main/webapp/WEB-INF</code>.</p>
<p>More interesting is the JSF view used to translate text. Just as in the
numberguess example we have a template, which surrounds the form
(omitted here for brevity):</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:form</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;TranslatorMain&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">table</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">tr</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">align</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;center&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">style</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;font-weight:&nbsp;bold&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">td</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Your&nbsp;text</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">td</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">td</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Translation</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">td</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">tr</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">tr</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">td</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:inputTextarea</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;text&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{translator.text}&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">required</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rows</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;5&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">cols</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;80&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">td</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">td</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:outputText</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{translator.translatedText}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">td</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">tr</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">table</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">h:commandButton</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;button&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Translate&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">action</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;#{translator.translate}&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">div</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">h:form</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>The user can enter some text in the left-hand text area, and hit the
translate button to see the result to the right.</p>
<p>Finally, let’s look at the EJB module, which is located in the example’s
<code class="literal">ejb</code> directory. In <code class="literal">src/main/resources/META-INF</code> there is just an empty
<code class="literal">beans.xml</code>, used to mark the archive as containing beans.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The <code class="literal">beans.xml</code> file is no longer required for CDI enablement as of CDI
1.1. CDI is automatically enabled for archives which don’t contain
<code class="literal">beans.xml</code> but contain one or more bean classes with a <span class="emphasis"><em>bean defining
annotation</em></span>, as described in section <a href="#_implicit_bean_archive" title="15.6.2. Implicit bean archive">Section 15.6.2, “Implicit bean archive”</a>.</p>
</div>

<p>We’ve saved the most interesting bit for last, the code! The project has
two simple beans, <code class="literal">SentenceParser</code> and <code class="literal">TextTranslator</code> and two session
beans, <code class="literal">TranslatorControllerBean</code> and <code class="literal">SentenceTranslator</code>. You should
be getting quite familiar with what a bean looks like by now, so we’ll
just highlight the most interesting bits here.</p>
<p>Both <code class="literal">SentenceParser</code> and <code class="literal">TextTranslator</code> are dependent beans, and
<code class="literal">TextTranslator</code> uses constructor injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">TextTranslator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Serializable</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">SentenceParser</span><span class="java_plain">&nbsp;sentenceParser</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@EJB&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Translator</span><span class="java_plain">&nbsp;translator</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">TextTranslator</span><span class="java_separator">(</span><span class="java_type">SentenceParser</span><span class="java_plain">&nbsp;sentenceParser</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">sentenceParser&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;sentenceParser</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;translate</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;text</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_plain">&nbsp;sb&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;sentence</span><span class="java_operator">:</span><span class="java_plain">&nbsp;sentenceParser</span><span class="java_separator">.</span><span class="java_plain">parse</span><span class="java_separator">(</span><span class="java_plain">text</span><span class="java_separator">))</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">translator</span><span class="java_separator">.</span><span class="java_plain">translate</span><span class="java_separator">(</span><span class="java_plain">sentence</span><span class="java_separator">)).</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_literal">&quot;.&nbsp;&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;sb</span><span class="java_separator">.</span><span class="java_plain">toString</span><span class="java_separator">().</span><span class="java_plain">trim</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p><code class="literal">TextTranslator</code> uses the simple bean (really just a plain Java class!)
<code class="literal">SentenceParser</code> to parse the sentence and then calls on the stateless
bean with the local business interface <code class="literal">Translator</code> to perform the
translation. That’s where the magic happens. Of course, we couldn’t
develop a full translator, but it’s convincing enough to anyone who
doesn’t understand Latin!</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SentenceTranslator</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Translator</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;translate</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;sentence</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Lorem&nbsp;ipsum&nbsp;dolor&nbsp;sit&nbsp;amet&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Finally, there is UI orientated controller. This is a request scoped,
named, stateful session bean, which injects the translator. It collects
the text from the user and dispatches it to the translator. The bean
also has getters and setters for all the fields on the page.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Stateful</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">RequestScoped</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Named</span><span class="java_separator">(</span><span class="java_literal">&quot;translator&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">TranslatorControllerBean</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">TranslatorController</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">TextTranslator</span><span class="java_plain">&nbsp;translator</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;inputText</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;translatedText</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;translate</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;translatedText&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;translator</span><span class="java_separator">.</span><span class="java_plain">translate</span><span class="java_separator">(</span><span class="java_plain">inputText</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getText</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;inputText</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setText</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;text</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">inputText&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;text</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getTranslatedText</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;translatedText</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Remove</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;remove</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>That concludes our short tour of the Weld starter examples. For more
information on Weld, please visit <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://weld.cdi-spec.org/">http://weld.cdi-spec.org/</a>.</p>
</div>
</div>
</div>
<div class="part" lang="en-US"><div class="titlepage"><div><div><h1 class="title"><a id="_loose_coupling_with_strong_typing"/>Part III. Loose coupling with strong typing</h1></div></div></div>

<div class="partintro" lang="en-US"><div/>
<p>The first major theme of CDI is <span class="emphasis"><em>loose coupling</em></span>. We’ve already seen
three means of achieving loose coupling:</p>
<div class="itemizedlist"><ul><li>
<span class="emphasis"><em>alternatives</em></span> enable deployment time polymorphism,
</li><li>
<span class="emphasis"><em>producer methods</em></span> enable runtime polymorphism, and
</li><li>
<span class="emphasis"><em>contextual lifecycle management</em></span> decouples bean lifecycles.
</li></ul></div>

<p>These techniques serve to enable loose coupling of client and server.
The client is no longer tightly bound to an implementation of an
interface, nor is it required to manage the lifecycle of the
implementation. This approach lets <span class="emphasis"><em>stateful objects interact as if they
were services</em></span>.</p>
<p>Loose coupling makes a system more <span class="emphasis"><em>dynamic</em></span>. The system can respond to
change in a well-defined manner. In the past, frameworks that attempted
to provide the facilities listed above invariably did it by sacrificing
type safety (most notably by using XML descriptors). CDI is the first
technology, and certainly the first specification in the Java EE
platform, that achieves this level of loose coupling in a typesafe way.</p>
<p>CDI provides three extra important facilities that further the goal of
loose coupling:</p>
<div class="itemizedlist"><ul><li>
<span class="emphasis"><em>interceptors</em></span> decouple technical concerns from business logic,
</li><li>
<span class="emphasis"><em>decorators</em></span> may be used to decouple some business concerns, and
</li><li>
<span class="emphasis"><em>event notifications</em></span> decouple event producers from event consumers.
</li></ul></div>

<p>The second major theme of CDI is <span class="emphasis"><em>strong typing</em></span>. The information about
the dependencies, interceptors and decorators of a bean, and the
information about event consumers for an event producer, is contained in
typesafe Java constructs that may be validated by the compiler.</p>
<p>You don’t see string-based identifiers in CDI code, not because the
framework is hiding them from you using clever defaulting
rules—so-called "configuration by convention"—but because there are
simply no strings there to begin with!</p>
<p>The obvious benefit of this approach is that <span class="emphasis"><em>any</em></span> IDE can provide
autocompletion, validation and refactoring without the need for special
tooling. But there is a second, less-immediately-obvious, benefit. It
turns out that when you start thinking of identifying objects, events or
interceptors via annotations instead of names, you have an opportunity
to lift the semantic level of your code.</p>
<p>CDI encourages you develop annotations that model concepts, for example,</p>
<div class="itemizedlist"><ul><li>
<code class="literal">@Asynchronous</code>,
</li><li>
<code class="literal">@Mock</code>,
</li><li>
<code class="literal">@Secure</code> or
</li><li>
<code class="literal">@Updated</code>,
</li></ul></div>

<p>instead of using compound names like</p>
<div class="itemizedlist"><ul><li>
<code class="literal">asyncPaymentProcessor</code>,
</li><li>
<code class="literal">mockPaymentProcessor</code>,
</li><li>
<code class="literal">SecurityInterceptor</code> or
</li><li>
<code class="literal">DocumentUpdatedEvent</code>.
</li></ul></div>

<p>The annotations are reusable. They help describe common qualities of
disparate parts of the system. They help us categorize and understand
our code. They help us deal with common concerns in a common way. They
make our code more literate and more understandable.</p>
<p>CDI <span class="emphasis"><em>stereotypes</em></span> take this idea a step further. A stereotype models a
common <span class="emphasis"><em>role</em></span> in your application architecture. It encapsulates various
properties of the role, including scope, interceptor bindings,
qualifiers, etc, into a single reusable package. (Of course, there is
also the benefit of tucking some of those annotations away).</p>
<p>We’re now ready to meet some more advanced features of CDI. Bear in mind
that these features exist to make our code both easier to validate and
more understandable. Most of the time you don’t ever really <span class="emphasis"><em>need</em></span> to
use these features, but if you use them wisely, you’ll come to
appreciate their power.</p>
<div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#producer_methods">8. Producer methods</a></span></dt><dd><dl><dt><span class="section"><a href="#_scope_of_a_producer_method">8.1. Scope of a producer method</a></span></dt><dt><span class="section"><a href="#_injection_into_producer_methods">8.2. Injection into producer methods</a></span></dt><dt><span class="section"><a href="#_use_of_literal_new_literal_with_producer_methods">8.3. Use of <code class="literal">@New</code> with producer methods</a></span></dt><dt><span class="section"><a href="#_disposer_methods">8.4. Disposer methods</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_interceptors">9. Interceptors</a></span></dt><dd><dl><dt><span class="section"><a href="#_interceptor_bindings">9.1. Interceptor bindings</a></span></dt><dt><span class="section"><a href="#_implementing_interceptors">9.2. Implementing interceptors</a></span></dt><dt><span class="section"><a href="#_enabling_interceptors">9.3. Enabling interceptors</a></span></dt><dt><span class="section"><a href="#_interceptor_bindings_with_members">9.4. Interceptor bindings with members</a></span></dt><dt><span class="section"><a href="#_multiple_interceptor_binding_annotations">9.5. Multiple interceptor binding annotations</a></span></dt><dt><span class="section"><a href="#_interceptor_binding_type_inheritance">9.6. Interceptor binding type inheritance</a></span></dt><dt><span class="section"><a href="#_use_of_literal_interceptors_literal">9.7. Use of <code class="literal">@Interceptors</code></a></span></dt></dl></dd><dt><span class="chapter"><a href="#_decorators">10. Decorators</a></span></dt><dd><dl><dt><span class="section"><a href="#_delegate_object">10.1. Delegate object</a></span></dt><dt><span class="section"><a href="#_enabling_decorators">10.2. Enabling decorators</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_events">11. Events</a></span></dt><dd><dl><dt><span class="section"><a href="#_event_payload">11.1. Event payload</a></span></dt><dt><span class="section"><a href="#_event_observers">11.2. Event observers</a></span></dt><dt><span class="section"><a href="#_event_producers">11.3. Event producers</a></span></dt><dt><span class="section"><a href="#_conditional_observer_methods">11.4. Conditional observer methods</a></span></dt><dt><span class="section"><a href="#_event_qualifiers_with_members">11.5. Event qualifiers with members</a></span></dt><dt><span class="section"><a href="#_multiple_event_qualifiers">11.6. Multiple event qualifiers</a></span></dt><dt><span class="section"><a href="#_transactional_observers">11.7. Transactional observers</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_stereotypes">12. Stereotypes</a></span></dt><dd><dl><dt><span class="section"><a href="#_default_scope_for_a_stereotype">12.1. Default scope for a stereotype</a></span></dt><dt><span class="section"><a href="#_interceptor_bindings_for_stereotypes">12.2. Interceptor bindings for stereotypes</a></span></dt><dt><span class="section"><a href="#_name_defaulting_with_stereotypes">12.3. Name defaulting with stereotypes</a></span></dt><dt><span class="section"><a href="#_alternative_stereotypes">12.4. Alternative stereotypes</a></span></dt><dt><span class="section"><a href="#_stereotype_stacking">12.5. Stereotype stacking</a></span></dt><dt><span class="section"><a href="#_built_in_stereotypes">12.6. Built-in stereotypes</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_specialization_inheritance_and_alternatives">13. Specialization, inheritance and alternatives</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_alternative_stereotypes">13.1. Using alternative stereotypes</a></span></dt><dt><span class="section"><a href="#_a_minor_problem_with_alternatives">13.2. A minor problem with alternatives</a></span></dt><dt><span class="section"><a href="#_using_specialization">13.3. Using specialization</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_java_ee_component_environment_resources">14. Java EE component environment resources</a></span></dt><dd><dl><dt><span class="section"><a href="#_defining_a_resource">14.1. Defining a resource</a></span></dt><dt><span class="section"><a href="#_typesafe_resource_injection">14.2. Typesafe resource injection</a></span></dt></dl></dd></dl></div></div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="producer_methods"/>Chapter 8. Producer methods</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_scope_of_a_producer_method">8.1. Scope of a producer method</a></span></dt><dt><span class="section"><a href="#_injection_into_producer_methods">8.2. Injection into producer methods</a></span></dt><dt><span class="section"><a href="#_use_of_literal_new_literal_with_producer_methods">8.3. Use of <code class="literal">@New</code> with producer methods</a></span></dt><dt><span class="section"><a href="#_disposer_methods">8.4. Disposer methods</a></span></dt></dl></div>

<p>Producer methods let us overcome certain limitations that arise when a
container, instead of the application, is responsible for instantiating
objects. They’re also the easiest way to integrate objects which are not
beans into the CDI environment.</p>
<p>According to the spec:</p>
<div class="blockquote"><blockquote class="blockquote">
  
<p>A producer method acts as a source of objects to be injected, where:</p>
<div class="itemizedlist"><ul><li>
the objects to be injected are not required to be instances of beans,
or
</li><li>
the concrete type of the objects to be injected may vary at runtime,
or
</li><li>
the objects require some custom initialization that is not performed
by the bean constructor.
</li></ul></div>

</blockquote></div>

<p>For example, producer methods let us:</p>
<div class="itemizedlist"><ul><li>
expose a JPA entity as a bean,
</li><li>
expose any JDK class as a bean,
</li><li>
define multiple beans, with different scopes or initialization, for
the same implementation class, or
</li><li>
vary the implementation of a bean type at runtime.
</li></ul></div>

<p>In particular, producer methods let us use runtime polymorphism with
CDI. As we’ve seen, alternative beans are one solution to the problem of
deployment-time polymorphism. But once the system is deployed, the CDI
implementation is fixed. A producer method has no such limitation:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">SessionScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Preferences</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentStrategyType</span><span class="java_plain">&nbsp;paymentStrategy</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">Preferred</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentStrategy</span><span class="java_plain">&nbsp;getPaymentStrategy</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">switch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">paymentStrategy</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">case</span><span class="java_plain">&nbsp;CREDIT_CARD</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CreditCardPaymentStrategy</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">case</span><span class="java_plain">&nbsp;CHECK</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CheckPaymentStrategy</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">case</span><span class="java_plain">&nbsp;PAYPAL</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">PayPalPaymentStrategy</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">default</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Consider an injection point:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Preferred</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaymentStrategy</span><!-- <br/> --><span class="java_plain">&nbsp;paymentStrategy</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>This injection point has the same type and qualifier annotations as the
producer method, so it resolves to the producer method using the usual
CDI injection rules. The producer method will be called by the container
to obtain an instance to service this injection point.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_scope_of_a_producer_method"/>8.1. Scope of a producer method</h2></div></div></div>

<p>The scope of the producer method defaults to <code class="literal">@Dependent</code>, and so it
will be called <span class="emphasis"><em>every time</em></span> the container injects this field or any
other field that resolves to the same producer method. Thus, there could
be multiple instances of the <code class="literal">PaymentStrategy</code> object for each user
session.</p>
<p>To change this behavior, we can add a <code class="literal">@SessionScoped</code> annotation to the
method.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Preferred</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">SessionScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentStrategy</span><span class="java_plain">&nbsp;getPaymentStrategy</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Now, when the producer method is called, the returned <code class="literal">PaymentStrategy</code>
will be bound to the session context. The producer method won’t be
called again in the same session.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>A producer method does <span class="emphasis"><em>not</em></span> inherit the scope of the bean that declares
the method. There are two different beans here: the producer method, and
the bean which declares it. The scope of the producer method determines
how often the method will be called, and the lifecycle of the objects
returned by the method. The scope of the bean that declares the producer
method determines the lifecycle of the object upon which the producer
method is invoked.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_injection_into_producer_methods"/>8.2. Injection into producer methods</h2></div></div></div>

<p>There’s one potential problem with the code above. The implementations
of <code class="literal">CreditCardPaymentStrategy</code> are instantiated using the Java <code class="literal">new</code>
operator. Objects instantiated directly by the application can’t take
advantage of dependency injection and don’t have interceptors.</p>
<p>If this isn’t what we want, we can use dependency injection into the
producer method to obtain bean instances:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Preferred</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">SessionScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentStrategy</span><span class="java_plain">&nbsp;getPaymentStrategy</span><span class="java_separator">(</span><span class="java_type">CreditCardPaymentStrategy</span><span class="java_plain">&nbsp;ccps</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CheckPaymentStrategy</span><span class="java_plain">&nbsp;cps</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">PayPalPaymentStrategy</span><span class="java_plain">&nbsp;ppps</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">switch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">paymentStrategy</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">case</span><span class="java_plain">&nbsp;CREDIT_CARD</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;ccps</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">case</span><span class="java_plain">&nbsp;CHEQUE</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;cps</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">case</span><span class="java_plain">&nbsp;PAYPAL</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;ppps</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">default</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Wait, what if <code class="literal">CreditCardPaymentStrategy</code> is a request-scoped bean? Then
the producer method has the effect of "promoting" the current request
scoped instance into session scope. This is almost certainly a bug! The
request scoped object will be destroyed by the container before the
session ends, but the reference to the object will be left "hanging" in
the session scope. This error will <span class="emphasis"><em>not</em></span> be detected by the container,
so please take extra care when returning bean instances from producer
methods!</p>
<p>There’s at least three ways we could go about fixing this bug. We could
change the scope of the <code class="literal">CreditCardPaymentStrategy</code> implementation, but
this would affect other clients of that bean. A better option would be
to change the scope of the producer method to <code class="literal">@Dependent</code> or
<code class="literal">@RequestScoped</code>.</p>
<p>But a more common solution is to use the special <code class="literal">@New</code> qualifier
annotation.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_use_of_literal_new_literal_with_producer_methods"/>8.3. Use of <code class="literal">@New</code> with producer methods</h2></div></div></div>

<p>Consider the following producer method:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Preferred</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">SessionScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentStrategy</span><span class="java_plain">&nbsp;getPaymentStrategy</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">New</span><span class="java_plain">&nbsp;</span><span class="java_type">CreditCardPaymentStrategy</span><span class="java_plain">&nbsp;ccps</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">New</span><span class="java_plain">&nbsp;</span><span class="java_type">CheckPaymentStrategy</span><span class="java_plain">&nbsp;cps</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">New</span><span class="java_plain">&nbsp;</span><span class="java_type">PayPalPaymentStrategy</span><span class="java_plain">&nbsp;ppps</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">switch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">paymentStrategy</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">case</span><span class="java_plain">&nbsp;CREDIT_CARD</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;ccps</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">case</span><span class="java_plain">&nbsp;CHEQUE</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;cps</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">case</span><span class="java_plain">&nbsp;PAYPAL</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;ppps</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">default</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Then a new <span class="emphasis"><em>dependent</em></span> instance of <code class="literal">CreditCardPaymentStrategy</code> will be
created, passed to the producer method, returned by the producer method
and finally bound to the session context. The dependent object won’t be
destroyed until the <code class="literal">Preferences</code> object is destroyed, at the end of the
session.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2>
<p>The @New qualifier was deprecated in CDI 1.1. CDI applications are
encouraged to inject @Dependent scoped beans instead.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_disposer_methods"/>8.4. Disposer methods</h2></div></div></div>

<p>Some producer methods return objects that require explicit destruction.
For example, somebody needs to close this JDBC connection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">RequestScoped</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Connection</span><!-- <br/> --><span class="java_plain">&nbsp;connect</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">User</span><!-- <br/> --><span class="java_plain">&nbsp;user</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;createConnection</span><span class="java_separator">(</span><span class="java_plain">user</span><span class="java_separator">.</span><span class="java_plain">getId</span><span class="java_separator">(),</span><span class="java_plain">&nbsp;user</span><span class="java_separator">.</span><span class="java_plain">getPassword</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Destruction can be performed by a matching <span class="emphasis"><em>disposer method</em></span>, defined by
the same class as the producer method:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;close</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Disposes</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Connection</span><!-- <br/> --><span class="java_plain">&nbsp;connection</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;connection</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The disposer method must have at least one parameter, annotated
<code class="literal">@Disposes</code>, with the same type and qualifiers as the producer method.
The disposer method is called automatically when the context ends (in
this case, at the end of the request), and this parameter receives the
object produced by the producer method. If the disposer method has
additional method parameters, the container will look for a bean that
satisfies the type and qualifiers of each parameter and pass it to the
method automatically.</p>
<p>Since CDI 1.1 disposer methods may be used for destroying not only
objects produced by producer methods but also objects producer by
<span class="emphasis"><em>producer fields</em></span>.</p>
</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_interceptors"/>Chapter 9. Interceptors</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_interceptor_bindings">9.1. Interceptor bindings</a></span></dt><dt><span class="section"><a href="#_implementing_interceptors">9.2. Implementing interceptors</a></span></dt><dt><span class="section"><a href="#_enabling_interceptors">9.3. Enabling interceptors</a></span></dt><dt><span class="section"><a href="#_interceptor_bindings_with_members">9.4. Interceptor bindings with members</a></span></dt><dt><span class="section"><a href="#_multiple_interceptor_binding_annotations">9.5. Multiple interceptor binding annotations</a></span></dt><dt><span class="section"><a href="#_interceptor_binding_type_inheritance">9.6. Interceptor binding type inheritance</a></span></dt><dt><span class="section"><a href="#_use_of_literal_interceptors_literal">9.7. Use of <code class="literal">@Interceptors</code></a></span></dt></dl></div>

<p>Interceptor functionality is defined in the Java Interceptors
specification.</p>
<p>The Interceptors specification defines three kinds of interception
points:</p>
<div class="itemizedlist"><ul><li>
business method interception,
</li><li>
lifecycle callback interception, and
</li><li>
timeout method interception (EJB only).
</li></ul></div>

<p>A <span class="emphasis"><em>business method interceptor</em></span> applies to invocations of methods of the
bean by clients of the bean:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">TransactionInterceptor</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AroundInvoke</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;manageTransaction</span><span class="java_separator">(</span><span class="java_type">InvocationContext</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>A <span class="emphasis"><em>lifecycle callback interceptor</em></span> applies to invocations of lifecycle
callbacks by the container:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">DependencyInjectionInterceptor</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PostConstruct</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;injectDependencies</span><span class="java_separator">(</span><span class="java_type">InvocationContext</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>An interceptor class may intercept both lifecycle callbacks and business
methods.</p>
<p>A <span class="emphasis"><em>timeout method interceptor</em></span> applies to invocations of EJB timeout
methods by the container:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">TimeoutInterceptor</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AroundTimeout</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;manageTransaction</span><span class="java_separator">(</span><span class="java_type">InvocationContext</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_interceptor_bindings"/>9.1. Interceptor bindings</h2></div></div></div>

<p>Suppose we want to declare that some of our beans are transactional. The
first thing we need is an <span class="emphasis"><em>interceptor binding type</em></span> to specify exactly
which beans we’re interested in:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">InterceptorBinding</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Transactional</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>Now we can easily specify that our <code class="literal">ShoppingCart</code> is a transactional
object:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Transactional</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>Or, if we prefer, we can specify that just one method is transactional:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ShoppingCart</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Transactional</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;checkout</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_implementing_interceptors"/>9.2. Implementing interceptors</h2></div></div></div>

<p>That’s great, but somewhere along the line we’re going to have to
actually implement the interceptor that provides this transaction
management aspect. All we need to do is create a standard interceptor,
and annotate it <code class="literal">@Interceptor</code> and <code class="literal">@Transactional</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Transactional</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Interceptor</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">TransactionInterceptor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AroundInvoke</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;manageTransaction</span><span class="java_separator">(</span><span class="java_type">InvocationContext</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Interceptors can take advantage of dependency injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Transactional</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Interceptor</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">TransactionInterceptor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Resource</span><span class="java_plain">&nbsp;</span><span class="java_type">UserTransaction</span><span class="java_plain">&nbsp;transaction</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AroundInvoke</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;manageTransaction</span><span class="java_separator">(</span><span class="java_type">InvocationContext</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Multiple interceptors may use the same interceptor binding type.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_enabling_interceptors"/>9.3. Enabling interceptors</h2></div></div></div>

<p>By default, all interceptors are disabled. We need to <span class="emphasis"><em>enable</em></span> our
interceptor. We can do it using <code class="literal">beans.xml</code> descriptor of a bean
archive. However, this activation only applies to the beans in that
archive. From CDI 1.1 onwards the interceptor can be enabled for the
whole application using <code class="literal">@Priority</code> annotation.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">beans</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">interceptors</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mycompany.myapp.TransactionInterceptor</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">interceptors</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>Whoah! Why the angle bracket stew?</p>
<p>Well, having the XML declaration is actually a <span class="emphasis"><em>good thing</em></span>. It solves
two problems:</p>
<div class="itemizedlist"><ul><li>
it enables us to specify an ordering for the interceptors in our
system, ensuring deterministic behavior, and
</li><li>
it lets us enable or disable interceptor classes at deployment time.
</li></ul></div>

<p>Having two interceptors without <code class="literal">@Priority</code>, we could specify that our
security interceptor runs before our transaction interceptor.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">beans</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">interceptors</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mycompany.myapp.SecurityInterceptor</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mycompany.myapp.TransactionInterceptor</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">interceptors</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>Or we could turn them both off in our test environment by simply not
mentioning them in <code class="literal">beans.xml</code>! Ah, so simple.</p>
<p>It gets quite tricky when used along with interceptors annotated with
<code class="literal">@Priority</code>. Interceptors enabled using <code class="literal">@Priority</code> are called before
interceptors enabled using <code class="literal">beans.xml</code>, the lower priority values are
called first.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Interceptors with the <code class="literal">@Priority</code> that are listed in the <code class="literal">beans.xml</code>
descriptor will be called twice in Weld. However, this behaviour is
non-portable and this combination should not be used as it can behave
differently in other implementations!</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_interceptor_bindings_with_members"/>9.4. Interceptor bindings with members</h2></div></div></div>

<p>Suppose we want to add some extra information to our <code class="literal">@Transactional</code>
annotation:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">InterceptorBinding</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Transactional</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;requiresNew</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>CDI will use the value of <code class="literal">requiresNew</code> to choose between two different
interceptors, <code class="literal">TransactionInterceptor</code> and
<code class="literal">RequiresNewTransactionInterceptor</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Transactional</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">requiresNew&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">true</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Interceptor</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">RequiresNewTransactionInterceptor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AroundInvoke</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;manageTransaction</span><span class="java_separator">(</span><span class="java_type">InvocationContext</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Now we can use <code class="literal">RequiresNewTransactionInterceptor</code> like this:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Transactional</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">requiresNew&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">true</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>But what if we only have one interceptor and we want the container to
ignore the value of <code class="literal">requiresNew</code> when binding interceptors? Perhaps
this information is only useful for the interceptor implementation. We
can use the <code class="literal">@Nonbinding</code> annotation:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">InterceptorBinding</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Secure</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Nonbinding</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;rolesAllowed</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_multiple_interceptor_binding_annotations"/>9.5. Multiple interceptor binding annotations</h2></div></div></div>

<p>Usually we use combinations of interceptor bindings types to bind
multiple interceptors to a bean. For example, the following declaration
would be used to bind <code class="literal">TransactionInterceptor</code> and <code class="literal">SecurityInterceptor</code>
to the same bean:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Secure</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">rolesAllowed</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;admin&quot;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Transactional</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>However, in very complex cases, an interceptor itself may specify some
combination of interceptor binding types:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Transactional</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Secure</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Interceptor</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">TransactionalSecureInterceptor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>Then this interceptor could be bound to the <code class="literal">checkout()</code> method using
any one of the following combinations:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ShoppingCart</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Transactional</span><span class="java_plain">&nbsp;@</span><span class="java_type">Secure</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;checkout</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Secure</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Transactional</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;checkout</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Transactional</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Secure</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;checkout</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Transactional</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Secure</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;checkout</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_interceptor_binding_type_inheritance"/>9.6. Interceptor binding type inheritance</h2></div></div></div>

<p>One limitation of the Java language support for annotations is the lack
of annotation inheritance. Really, annotations should have reuse built
in, to allow this kind of thing to work:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Action</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Transactional</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Secure</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<p>Well, fortunately, CDI works around this missing feature of Java. We may
annotate one interceptor binding type with other interceptor binding
types (termed a <span class="emphasis"><em>meta-annotation</em></span>). The interceptor bindings are
transitive — any bean with the first interceptor binding inherits the
interceptor bindings declared as meta-annotations.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Transactional</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Secure</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">InterceptorBinding</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">TYPE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Action</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>Now, any bean annotated <code class="literal">@Action</code> will be bound to both
<code class="literal">TransactionInterceptor</code> and <code class="literal">SecurityInterceptor</code>. (And even
<code class="literal">TransactionalSecureInterceptor</code>, if it exists.)</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_use_of_literal_interceptors_literal"/>9.7. Use of <code class="literal">@Interceptors</code></h2></div></div></div>

<p>The <code class="literal">@Interceptors</code> annotation defined by the Interceptors specification
(and used by the Managed Beans and EJB specifications) is still
supported in CDI.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Interceptors</span><!-- <br/> --><span class="java_separator">({</span><!-- <br/> --><span class="java_type">TransactionInterceptor</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SecurityInterceptor</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ShoppingCart</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;checkout</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>However, this approach suffers the following drawbacks:</p>
<div class="itemizedlist"><ul><li>
the interceptor implementation is hardcoded in business code,
</li><li>
interceptors may not be easily disabled at deployment time, and
</li><li>
the interceptor ordering is non-global — it is determined by the order
in which interceptors are listed at the class level.
</li></ul></div>

<p>Therefore, we recommend the use of CDI-style interceptor bindings.</p>
</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_decorators"/>Chapter 10. Decorators</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_delegate_object">10.1. Delegate object</a></span></dt><dt><span class="section"><a href="#_enabling_decorators">10.2. Enabling decorators</a></span></dt></dl></div>

<p>Interceptors are a powerful way to capture and separate concerns which
are <span class="emphasis"><em>orthogonal</em></span> to the application (and type system). Any interceptor
is able to intercept invocations of any Java type. This makes them
perfect for solving technical concerns such as transaction management,
security and call logging. However, by nature, interceptors are unaware
of the actual semantics of the events they intercept. Thus, interceptors
aren’t an appropriate tool for separating business-related concerns.</p>
<p>The reverse is true of <span class="emphasis"><em>decorators</em></span>. A decorator intercepts invocations
only for a certain Java interface, and is therefore aware of all the
semantics attached to that interface. Since decorators directly
implement operations with business semantics, it makes them the perfect
tool for modeling some kinds of business concerns. It also means that a
decorator doesn’t have the generality of an interceptor. Decorators
aren’t able to solve technical concerns that cut across many disparate
types. Interceptors and decorators, though similar in many ways, are
complementary. Let’s look at some cases where decorators fit the bill.</p>
<p>Suppose we have an interface that represents accounts:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Account</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;getBalance</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;getOwner</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;withdraw</span><span class="java_separator">(</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;amount</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;deposit</span><span class="java_separator">(</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;amount</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Several different beans in our system implement the <code class="literal">Account</code> interface.
However, we have a common legal requirement that; for any kind of
account, large transactions must be recorded by the system in a special
log. This is a perfect job for a decorator.</p>
<p>A decorator is a bean (possibly even an abstract class) that implements
the type it decorates and is annotated <code class="literal">@Decorator</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Decorator</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">abstract</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LargeTransactionDecorator</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The decorator implements the methods of the decorated type that it wants
to intercept.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Decorator</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">abstract</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LargeTransactionDecorator</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">Delegate</span><span class="java_plain">&nbsp;@</span><span class="java_type">Any</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;account</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PersistenceContext</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;withdraw</span><span class="java_separator">(</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;amount</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;deposit</span><span class="java_separator">(</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;amount</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Unlike other beans, a decorator may be an abstract class. Therefore, if
there’s nothing special the decorator needs to do for a particular
method of the decorated interface, you don’t need to implement that
method.</p>
<p>Interceptors for a method are called before decorators that apply to the
method.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_delegate_object"/>10.1. Delegate object</h2></div></div></div>

<p>Decorators have a special injection point, called the <span class="emphasis"><em>delegate
injection point</em></span>, with the same type as the beans they decorate, and the
annotation <code class="literal">@Delegate</code>. There must be exactly one delegate injection
point, which can be a constructor parameter, initializer method
parameter or injected field.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Decorator</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">abstract</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LargeTransactionDecorator</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">Delegate</span><span class="java_plain">&nbsp;@</span><span class="java_type">Any</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;account</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>A decorator is bound to any bean which:</p>
<div class="itemizedlist"><ul><li>
has the type of the delegate injection point as a bean type, and
</li><li>
has all qualifiers that are declared at the delegate injection point.
</li></ul></div>

<p>This delegate injection point specifies that the decorator is bound to
all beans that implement <code class="literal">Account</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Delegate</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Any</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Account</span><!-- <br/> --><span class="java_plain">&nbsp;account</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>A delegate injection point may specify any number of qualifier
annotations. The decorator will only be bound to beans with the same
qualifiers.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Delegate</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Foreign</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Account</span><!-- <br/> --><span class="java_plain">&nbsp;account</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>The decorator may invoke the delegate object, which has much the same
effect as calling <code class="literal">InvocationContext.proceed()</code> from an interceptor. The
main difference is that the decorator can invoke <span class="emphasis"><em>any</em></span> business method
on the delegate object.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Decorator</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">abstract</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LargeTransactionDecorator</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">Delegate</span><span class="java_plain">&nbsp;@</span><span class="java_type">Any</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;account</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PersistenceContext</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;withdraw</span><span class="java_separator">(</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;amount</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account</span><span class="java_separator">.</span><span class="java_plain">withdraw</span><span class="java_separator">(</span><span class="java_plain">amount</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;amount</span><span class="java_separator">.</span><span class="java_plain">compareTo</span><span class="java_separator">(</span><span class="java_plain">LARGE_AMOUNT</span><span class="java_separator">)</span><span class="java_operator">&gt;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">LoggedWithdrawl</span><span class="java_separator">(</span><span class="java_plain">amount</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;deposit</span><span class="java_separator">(</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;amount</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account</span><span class="java_separator">.</span><span class="java_plain">deposit</span><span class="java_separator">(</span><span class="java_plain">amount</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;amount</span><span class="java_separator">.</span><span class="java_plain">compareTo</span><span class="java_separator">(</span><span class="java_plain">LARGE_AMOUNT</span><span class="java_separator">)</span><span class="java_operator">&gt;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">LoggedDeposit</span><span class="java_separator">(</span><span class="java_plain">amount</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_enabling_decorators"/>10.2. Enabling decorators</h2></div></div></div>

<p>By default, all decorators are disabled. We need to <span class="emphasis"><em>enable</em></span> our
decorator. We can do it using <code class="literal">beans.xml</code> descriptor of a bean archive.
However, this activation only applies to the beans in that archive. From
CDI 1.1 onwards the decorator can be enabled for the whole application
using <code class="literal">@Priority</code> annotation.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">beans</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">decorators</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mycompany.myapp.LargeTransactionDecorator</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">decorators</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>This declaration serves the same purpose for decorators that the
<code class="literal">&lt;interceptors&gt;</code> declaration serves for interceptors:</p>
<div class="itemizedlist"><ul><li>
it enables us to specify an ordering for decorators in our system,
ensuring deterministic behavior, and
</li><li>
it lets us enable or disable decorator classes at deployment time.
</li></ul></div>

<p>Decorators enabled using <code class="literal">@Priority</code> are called before decorators
enabled using <code class="literal">beans.xml</code>, the lower priority values are called first.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Decorators with the <code class="literal">@Priority</code> that are listed in the <code class="literal">beans.xml</code>
descriptor will be called twice in Weld. However, this behaviour is
non-portable and this combination should not be used as it can behave
differently in other implementations!</p>
</div>

</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_events"/>Chapter 11. Events</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_event_payload">11.1. Event payload</a></span></dt><dt><span class="section"><a href="#_event_observers">11.2. Event observers</a></span></dt><dt><span class="section"><a href="#_event_producers">11.3. Event producers</a></span></dt><dt><span class="section"><a href="#_conditional_observer_methods">11.4. Conditional observer methods</a></span></dt><dt><span class="section"><a href="#_event_qualifiers_with_members">11.5. Event qualifiers with members</a></span></dt><dt><span class="section"><a href="#_multiple_event_qualifiers">11.6. Multiple event qualifiers</a></span></dt><dt><span class="section"><a href="#_transactional_observers">11.7. Transactional observers</a></span></dt></dl></div>

<p>Dependency injection enables loose-coupling by allowing the
implementation of the injected bean type to vary, either at deployment
time or runtime. Events go one step further, allowing beans to interact
with no compile time dependency at all. Event <span class="emphasis"><em>producers</em></span> raise events
that are delivered to event <span class="emphasis"><em>observers</em></span> by the container.</p>
<p>This basic schema might sound like the familiar observer/observable
pattern, but there are a couple of twists:</p>
<div class="itemizedlist"><ul><li>
not only are event producers decoupled from observers; observers are
completely decoupled from producers,
</li><li>
observers can specify a combination of "selectors" to narrow the set
of event notifications they will receive, and
</li><li>
observers can be notified immediately, or can specify that delivery of
the event should be delayed until the end of the current transaction.
</li></ul></div>

<p>The CDI event notification facility uses more or less the same typesafe
approach that we’ve already seen with the dependency injection service.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_event_payload"/>11.1. Event payload</h2></div></div></div>

<p>The event object carries state from producer to consumer. The event
object is nothing more than an instance of a concrete Java class. (The
only restriction is that an event type may not contain type variables).
An event may be assigned qualifiers, which allows observers to
distinguish it from other events of the same type. The qualifiers
function like topic selectors, allowing an observer to narrow the set of
events it observes.</p>
<p>An event qualifier is just a normal qualifier, defined using
<code class="literal">@Qualifier</code>. Here’s an example:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Updated</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_event_observers"/>11.2. Event observers</h2></div></div></div>

<p>An <span class="emphasis"><em>observer method</em></span> is a method of a bean with a parameter annotated
<code class="literal">@Observes</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;onAnyDocumentEvent</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_plain">&nbsp;document</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<p>The annotated parameter is called the <span class="emphasis"><em>event parameter</em></span>. The type of the
event parameter is the observed <span class="emphasis"><em>event type</em></span>, in this case <code class="literal">Document</code>.
The event parameter may also specify qualifiers.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;afterDocumentUpdate</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Updated</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_plain">&nbsp;document</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<p>An observer method need not specify any event qualifiers—in this case it
is interested in <span class="emphasis"><em>only unqualified</em></span> events of a particular type. If it
does specify qualifiers, it’s only interested in events which have those
qualifiers.</p>
<p>The observer method may have additional parameters, which are injection
points:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;afterDocumentUpdate</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Updated</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_plain">&nbsp;document</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">User</span><!-- <br/> --><span class="java_plain">&nbsp;user</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_event_producers"/>11.3. Event producers</h2></div></div></div>

<p>Event producers fire events using an instance of the parameterized
<code class="literal">Event</code> interface. An instance of this interface is obtained by
injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Any</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Event</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;documentEvent</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>A producer raises events by calling the <code class="literal">fire()</code> method of the <code class="literal">Event</code>
interface, passing the event object:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">documentEvent</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">fire</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">document</span><!-- <br/> --><span class="java_separator">);</span></pre>

<p>This particular event will be delivered to every observer method that:</p>
<div class="itemizedlist"><ul><li>
has an event parameter to which the event object (the <code class="literal">Document</code>) is
assignable, and
</li><li>
specifies no qualifiers.
</li></ul></div>

<p>The container simply calls all the observer methods, passing the event
object as the value of the event parameter. If any observer method
throws an exception, the container stops calling observer methods, and
the exception is rethrown by the <code class="literal">fire()</code> method.</p>
<p>Qualifiers can be applied to an event in one of two ways:</p>
<div class="itemizedlist"><ul><li>
by annotating the <code class="literal">Event</code> injection point, or
</li><li>
by passing qualifiers to the <code class="literal">select()</code> of <code class="literal">Event</code>.
</li></ul></div>

<p>Specifying the qualifiers at the injection point is far simpler:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Updated</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Event</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;documentUpdatedEvent</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>Then, every event fired via this instance of <code class="literal">Event</code> has the event
qualifier <code class="literal">@Updated</code>. The event is delivered to every observer method
that:</p>
<div class="itemizedlist"><ul><li>
has an event parameter to which the event object is assignable, and
</li><li>
does not have any event qualifier <span class="emphasis"><em>except</em></span> for the event qualifiers
that match those specified at the <code class="literal">Event</code> injection point.
</li></ul></div>

<p>The downside of annotating the injection point is that we can’t specify
the qualifier dynamically. CDI lets us obtain a qualifier instance by
subclassing the helper class <code class="literal">AnnotationLiteral</code>. That way, we can pass
the qualifier to the <code class="literal">select()</code> method of <code class="literal">Event</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">documentEvent</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">select</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">AnnotationLiteral</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Updated</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_separator">(){}).</span><!-- <br/> --><span class="java_plain">fire</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">document</span><!-- <br/> --><span class="java_separator">);</span></pre>

<p>Events can have multiple event qualifiers, assembled using any
combination of annotations at the <code class="literal">Event</code> injection point and qualifier
instances passed to the <code class="literal">select()</code> method.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_conditional_observer_methods"/>11.4. Conditional observer methods</h2></div></div></div>

<p>By default, if there is no instance of an observer in the current
context, the container will instantiate the observer in order to deliver
an event to it. This behavior isn’t always desirable. We may want to
deliver events only to instances of the observer that already exist in
the current contexts.</p>
<p>A conditional observer is specified by adding <code class="literal">receive = IF_EXISTS</code> to
the <code class="literal">@Observes</code> annotation.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;refreshOnDocumentUpdate</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">receive&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;IF_EXISTS</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Updated</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_plain">&nbsp;d</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>A bean with scope <code class="literal">@Dependent</code> cannot be a conditional observer, since
it would never be called!</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_event_qualifiers_with_members"/>11.5. Event qualifiers with members</h2></div></div></div>

<p>An event qualifier type may have annotation members:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Qualifier</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;PARAMETER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;TYPE</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Role</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">RoleType</span><span class="java_plain">&nbsp;value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The member value is used to narrow the messages delivered to the
observer:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;adminLoggedIn</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Role</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">ADMIN</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">LoggedIn</span><!-- <br/> --><span class="java_plain">&nbsp;event</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<p>Event qualifier type members may be specified statically by the event
producer, via annotations at the event notifier injection point:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Role</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">ADMIN</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Event</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">LoggedIn</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;loggedInEvent</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>Alternatively, the value of the event qualifier type member may be
determined dynamically by the event producer. We start by writing an
abstract subclass of <code class="literal">AnnotationLiteral</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">abstract</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">RoleBinding</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Role</span><span class="java_operator">&gt;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Role</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>The event producer passes an instance of this class to <code class="literal">select()</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">documentEvent</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">select</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">RoleBinding</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;value</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;user</span><span class="java_separator">.</span><span class="java_plain">getRole</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}).</span><span class="java_plain">fire</span><span class="java_separator">(</span><span class="java_plain">document</span><span class="java_separator">);</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_multiple_event_qualifiers"/>11.6. Multiple event qualifiers</h2></div></div></div>

<p>Event qualifiers may be combined, for example:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Blog</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Event</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;blogEvent</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">document</span><span class="java_separator">.</span><span class="java_plain">isBlog</span><span class="java_separator">())</span><span class="java_plain">&nbsp;blogEvent</span><span class="java_separator">.</span><span class="java_plain">select</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Updated</span><span class="java_operator">&gt;</span><span class="java_separator">(){}).</span><span class="java_plain">fire</span><span class="java_separator">(</span><span class="java_plain">document</span><span class="java_separator">);</span></pre>

<p>An observer method is only notified if all the observed qualifiers are
specified when the event is fired. Assume the following observers in
this example:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;afterBlogUpdate</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Updated</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Blog</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_plain">&nbsp;document</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;afterDocumentUpdate</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Updated</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_plain">&nbsp;document</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;onAnyBlogEvent</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Blog</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_plain">&nbsp;document</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;onAnyDocumentEvent</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_plain">&nbsp;document</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}}}</span></pre>

<p>All of these observer methods will be notified.</p>
<p>However, if there were also an observer method:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;afterPersonalBlogUpdate</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Updated</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Personal</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Blog</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Document</span><!-- <br/> --><span class="java_plain">&nbsp;document</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<p>It would not be notified, as <code class="literal">@Personal</code> is not a qualifier of the event
being fired.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_transactional_observers"/>11.7. Transactional observers</h2></div></div></div>

<p>Transactional observers receive their event notifications during the
before or after completion phase of the transaction in which the event
was raised. For example, the following observer method needs to refresh
a query result set that is cached in the application context, but only
when transactions that update the <code class="literal">Category</code> tree succeed:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;refreshCategoryTree</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">during&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;AFTER_SUCCESS</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">CategoryUpdateEvent</span><!-- <br/> --><span class="java_plain">&nbsp;event</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<p>There are five kinds of transactional observers:</p>
<div class="itemizedlist"><ul><li>
<code class="literal">IN_PROGRESS</code> observers are called immediately (default)
</li><li>
<code class="literal">AFTER_SUCCESS</code> observers are called during the after completion phase
of the transaction, but only if the transaction completes successfully
</li><li>
<code class="literal">AFTER_FAILURE</code> observers are called during the after completion phase
of the transaction, but only if the transaction fails to complete
successfully
</li><li>
<code class="literal">AFTER_COMPLETION</code> observers are called during the after completion
phase of the transaction
</li><li>
<code class="literal">BEFORE_COMPLETION</code> observers are called during the before completion
phase of the transaction
</li></ul></div>

<p>Transactional observers are very important in a stateful object model
because state is often held for longer than a single atomic transaction.</p>
<p>Imagine that we have cached a JPA query result set in the application
scope:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">ejb</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Singleton</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">enterprise</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">.</span><span class="java_type">Produces</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ApplicationScoped</span><span class="java_plain">&nbsp;@</span><span class="java_type">Singleton</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Catalog</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PersistenceContext</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">Catalog</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getCatalog</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">products</span><span class="java_operator">==</span><span class="java_literal">null</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">(</span><span class="java_literal">&quot;select&nbsp;p&nbsp;from&nbsp;Product&nbsp;p&nbsp;where&nbsp;p.deleted&nbsp;=&nbsp;false&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;products</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>From time to time, a <code class="literal">Product</code> is created or deleted. When this occurs,
we need to refresh the <code class="literal">Product</code> catalog. But we should wait until
<span class="emphasis"><em>after</em></span> the transaction completes successfully before performing this
refresh!</p>
<p>The bean that creates and deletes `Product`s could raise events, for
example:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">event</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Event</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stateless</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ProductManager</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PersistenceContext</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">Any</span><span class="java_plain">&nbsp;</span><span class="java_type">Event</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;productEvent</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;delete</span><span class="java_separator">(</span><span class="java_type">Product</span><span class="java_plain">&nbsp;product</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">delete</span><span class="java_separator">(</span><span class="java_plain">product</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;productEvent</span><span class="java_separator">.</span><span class="java_plain">select</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Deleted</span><span class="java_operator">&gt;</span><span class="java_separator">(){}).</span><span class="java_plain">fire</span><span class="java_separator">(</span><span class="java_plain">product</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;persist</span><span class="java_separator">(</span><span class="java_type">Product</span><span class="java_plain">&nbsp;product</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">product</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;productEvent</span><span class="java_separator">.</span><span class="java_plain">select</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Created</span><span class="java_operator">&gt;</span><span class="java_separator">(){}).</span><span class="java_plain">fire</span><span class="java_separator">(</span><span class="java_plain">product</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>And now <code class="literal">Catalog</code> can observe the events after successful completion of
the transaction:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">ejb</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Singleton</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ApplicationScoped</span><span class="java_plain">&nbsp;@</span><span class="java_type">Singleton</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Catalog</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;addProduct</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_separator">(</span><span class="java_plain">during&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;AFTER_SUCCESS</span><span class="java_separator">)</span><span class="java_plain">&nbsp;@</span><span class="java_type">Created</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;product</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">product</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;removeProduct</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_separator">(</span><span class="java_plain">during&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;AFTER_SUCCESS</span><span class="java_separator">)</span><span class="java_plain">&nbsp;@</span><span class="java_type">Deleted</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;product</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products</span><span class="java_separator">.</span><span class="java_plain">remove</span><span class="java_separator">(</span><span class="java_plain">product</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_stereotypes"/>Chapter 12. Stereotypes</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_default_scope_for_a_stereotype">12.1. Default scope for a stereotype</a></span></dt><dt><span class="section"><a href="#_interceptor_bindings_for_stereotypes">12.2. Interceptor bindings for stereotypes</a></span></dt><dt><span class="section"><a href="#_name_defaulting_with_stereotypes">12.3. Name defaulting with stereotypes</a></span></dt><dt><span class="section"><a href="#_alternative_stereotypes">12.4. Alternative stereotypes</a></span></dt><dt><span class="section"><a href="#_stereotype_stacking">12.5. Stereotype stacking</a></span></dt><dt><span class="section"><a href="#_built_in_stereotypes">12.6. Built-in stereotypes</a></span></dt></dl></div>

<p>The CDI specification defines a stereotype as follows:</p>
<div class="blockquote"><blockquote class="blockquote">
  
<p>In many systems, use of architectural patterns produces a set of
recurring bean roles. A stereotype allows a framework developer to
identify such a role and declare some common metadata for beans with
that role in a central place.</p>
<p>A stereotype encapsulates any combination of:</p>
<div class="itemizedlist"><ul><li>
a default scope, and
</li><li>
a set of interceptor bindings.
</li></ul></div>

<p>A stereotype may also specify that:</p>
<div class="itemizedlist"><ul><li>
all beans with the stereotype have defaulted bean names, or that
</li><li>
all beans with the stereotype are alternatives.
</li></ul></div>

<p>A bean may declare zero, one or multiple stereotypes. Stereotype
annotations may be applied to a bean class or producer method or field.</p>
</blockquote></div>

<p>A stereotype is an annotation, annotated <code class="literal">@Stereotype</code>, that packages
several other annotations. For instance, the following stereotype
identifies action classes in some MVC framework:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Stereotype</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">TYPE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Action</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>We use the stereotype by applying the annotation to a bean.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Action</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>Of course, we need to apply some other annotations to our stereotype or
else it wouldn’t be adding much value.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_default_scope_for_a_stereotype"/>12.1. Default scope for a stereotype</h2></div></div></div>

<p>A stereotype may specify a default scope for beans annotated with the
stereotype. For example:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">RequestScoped</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stereotype</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">TYPE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Action</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>A particular action may still override this default if necessary:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Dependent</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Action</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">DependentScopedLoginAction</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>Naturally, overriding a single default isn’t much use. But remember,
stereotypes can define more than just the default scope.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_interceptor_bindings_for_stereotypes"/>12.2. Interceptor bindings for stereotypes</h2></div></div></div>

<p>A stereotype may specify a set of interceptor bindings to be inherited
by all beans with that stereotype.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">RequestScoped</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Transactional</span><span class="java_separator">(</span><span class="java_plain">requiresNew</span><span class="java_operator">=</span><span class="java_literal">true</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Secure</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stereotype</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">TYPE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Action</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>This helps us get technical concerns, like transactions and security,
even further away from the business code!</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_name_defaulting_with_stereotypes"/>12.3. Name defaulting with stereotypes</h2></div></div></div>

<p>We can specify that all beans with a certain stereotype have a defaulted
EL name when a name is not explicitly defined for that bean. All we need
to do is add an empty <code class="literal">@Named</code> annotation:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">RequestScoped</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Transactional</span><span class="java_separator">(</span><span class="java_plain">requiresNew</span><span class="java_operator">=</span><span class="java_literal">true</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Secure</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Named</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stereotype</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">TYPE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Action</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>Now, the <code class="literal">LoginAction</code> bean will have the defaulted name <code class="literal">loginAction</code>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_alternative_stereotypes"/>12.4. Alternative stereotypes</h2></div></div></div>

<p>A stereotype can indicate that all beans to which it is applied are
`@Alternative`s. An <span class="emphasis"><em>alternative stereotype</em></span> lets us classify beans by
deployment scenario.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Alternative</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stereotype</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">TYPE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Mock</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>We can apply an alternative stereotype to a whole set of beans, and
activate them all with one line of code in <code class="literal">beans.xml</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Mock</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MockLoginAction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">LoginAction</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">alternatives</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">stereotype</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mycompany.testing.Mock</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">stereotype</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">alternatives</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_stereotype_stacking"/>12.5. Stereotype stacking</h2></div></div></div>

<p>This may blow your mind a bit, but stereotypes may declare other
stereotypes, which we’ll call <span class="emphasis"><em>stereotype stacking</em></span>. You may want to do
this if you have two distinct stereotypes which are meaningful on their
own, but in other situation may be meaningful when combined.</p>
<p>Here’s an example that combines the <code class="literal">@Action</code> and <code class="literal">@Auditable</code>
stereotypes:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Auditable</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Action</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stereotype</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">TYPE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">AuditableAction</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_built_in_stereotypes"/>12.6. Built-in stereotypes</h2></div></div></div>

<p>CDI defines one standard stereotype, <code class="literal">@Model</code>, which is expected to be
used frequently in web applications:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Named</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">RequestScoped</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stereotype</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">TYPE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Model</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>Instead of using JSF managed beans, just annotate a bean <code class="literal">@Model</code>, and
use it directly in your JSF view!</p>
</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_specialization_inheritance_and_alternatives"/>Chapter 13. Specialization, inheritance and alternatives</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_using_alternative_stereotypes">13.1. Using alternative stereotypes</a></span></dt><dt><span class="section"><a href="#_a_minor_problem_with_alternatives">13.2. A minor problem with alternatives</a></span></dt><dt><span class="section"><a href="#_using_specialization">13.3. Using specialization</a></span></dt></dl></div>

<p>When you first start developing with CDI, you’ll likely be dealing only
with a single bean implementation for each bean type. In this case, it’s
easy to understand how beans get selected for injection. As the
complexity of your application grows, multiple occurrences of the same
bean type start appearing, either because you have multiple
implementations or two beans share a common (Java) inheritance. That’s
when you have to begin studying the specialization, inheritance and
alternative rules to work through unsatisfied or ambiguous dependencies
or to avoid certain beans from being called.</p>
<p>The CDI specification recognizes two distinct scenarios in which one
bean extends another:</p>
<div class="blockquote"><blockquote class="blockquote">
  
<div class="itemizedlist"><ul><li>
The second bean <span class="emphasis"><em>specializes</em></span> the first bean in certain deployment
scenarios. In these deployments, the second bean completely replaces the
first, fulfilling the same role in the system.
</li><li>
The second bean is simply reusing the Java implementation, and
otherwise bears no relation to the first bean. The first bean may not
even have been designed for use as a contextual object.
</li></ul></div>

</blockquote></div>

<p>The second case is the default assumed by CDI. It’s possible to have two
beans in the system with the same part bean type (interface or parent
class). As you’ve learned, you select between the two implementations
using qualifiers.</p>
<p>The first case is the exception, and also requires more care. In any
given deployment, only one bean can fulfill a given role at a time. That
means one bean needs to be enabled and the other disabled. There are a
two modifiers involved: <code class="literal">@Alternative</code> and <code class="literal">@Specializes</code>. We’ll start
by looking at alternatives and then show the guarantees that
specialization adds.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_alternative_stereotypes"/>13.1. Using alternative stereotypes</h2></div></div></div>

<p>CDI lets you <span class="emphasis"><em>override</em></span> the implementation of a bean type at deployment
time using an alternative. For example, the following bean provides a
default implementation of the <code class="literal">PaymentProcessor</code> interface:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">DefaultPaymentProcessor</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>But in our staging environment, we don’t really want to submit payments
to the external system, so we override that implementation of
<code class="literal">PaymentProcessor</code> with a different bean:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Alternative</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">StagingPaymentProcessor</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>or</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Alternative</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">StagingPaymentProcessor</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">DefaultPaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>We’ve already seen how we can enable this alternative by listing its
class in the <code class="literal">beans.xml</code> descriptor.</p>
<p>But suppose we have many alternatives in the staging environment. It
would be much more convenient to be able to enable them all at once. So
let’s make <code class="literal">@Staging</code> an <code class="literal">@Alternative</code> stereotype and annotate the
staging beans with this stereotype instead. You’ll see how this level of
indirection pays off. First, we create the stereotype:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Alternative</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Stereotype</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">TYPE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">Staging</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span></pre>

<p>Then we replace the <code class="literal">@Alternative</code> annotation on our bean with
<code class="literal">@Staging</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Staging</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">StagingPaymentProcessor</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">PaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Finally, we activate the <code class="literal">@Staging</code> stereotype in the <code class="literal">beans.xml</code>
descriptor:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">beans</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">alternatives</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">stereotype</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mycompany.myapp.Staging</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">stereotype</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">alternatives</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>Now, no matter how many staging beans we have, they will all be enabled
at once.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_a_minor_problem_with_alternatives"/>13.2. A minor problem with alternatives</h2></div></div></div>

<p>When we enable an alternative, does that mean the default implementation
is disabled? Well, not exactly. If the default implementation has a
qualifier, for instance <code class="literal">@LargeTransaction</code>, and the alternative does
not, you could still inject the default implementation.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">LargeTransaction</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaymentProcessor</span><!-- <br/> --><span class="java_plain">&nbsp;paymentProcessor</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>So we haven’t completely replaced the default implementation in this
deployment of the system. The only way one bean can completely override
a second bean at all injection points is if it implements all the bean
types and declares all the qualifiers of the second bean. However, if
the second bean declares a producer method or observer method, then even
this is not enough to ensure that the second bean is never called! We
need something extra.</p>
<p>CDI provides a special feature, called <span class="emphasis"><em>specialization</em></span>, that helps the
developer avoid these traps. Specialization is a way of informing the
system of your intent to completely replace and disable an
implementation of a bean.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_specialization"/>13.3. Using specialization</h2></div></div></div>

<p>When the goal is to replace one bean implementation with a second, to
help prevent developer error, the first bean may:</p>
<div class="itemizedlist"><ul><li>
directly extend the bean class of the second bean, or
</li><li>
directly override the producer method, in the case that the second
bean is a producer method, and then
</li></ul></div>

<p>explicitly declare that it <span class="emphasis"><em>specializes</em></span> the second bean:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Alternative</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Specializes</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MockCreditCardPaymentProcessor</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">CreditCardPaymentProcessor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>When an enabled bean specializes another bean, the other bean is never
instantiated or called by the container. Even if the other bean defines
a producer or observer method, the method will never be called.</p>
<p>So why does specialization work, and what does it have to do with
inheritance?</p>
<p>Since we’re informing the container that our alternative bean is meant
to stand in as a replacement for the default implementation, the
alternative implementation automatically inherits all qualifiers of the
default implementation. Thus, in our example,
<code class="literal">MockCreditCardPaymentProcessor</code> inherits the qualifiers <code class="literal">@Default</code> and
<code class="literal">@CreditCard</code>.</p>
<p>Furthermore, if the default implementation declares a bean EL name using
<code class="literal">@Named</code>, the name is inherited by the specializing alternative bean.</p>
</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_java_ee_component_environment_resources"/>Chapter 14. Java EE component environment resources</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_defining_a_resource">14.1. Defining a resource</a></span></dt><dt><span class="section"><a href="#_typesafe_resource_injection">14.2. Typesafe resource injection</a></span></dt></dl></div>

<p>Java EE 5 already introduced some limited support for dependency
injection, in the form of component environment injection. A component
environment resource is a Java EE component, for example a JDBC
datasource, JMS queue or topic, JPA persistence context, remote EJB or
web service.</p>
<p>Naturally, there is now a slight mismatch with the new style of
dependency injection in CDI. Most notably, component environment
injection relies on string-based names to qualify ambiguous types, and
there is no real consistency as to the nature of the names (sometimes a
JNDI name, sometimes a persistence unit name, sometimes an EJB link,
sometimes a non-portable "mapped name"). Producer fields turned out to
be an elegant adaptor to reduce all this complexity to a common model
and get component environment resources to participate in the CDI system
just like any other kind of bean.</p>
<p>Fields have a duality in that they can both be the target of Java EE
component environment injection and be declared as a CDI producer field.
Therefore, they can define a mapping from a string-based name in the
component environment, to a combination of type and qualifiers used in
the world of typesafe injection. We call a producer field that
represents a reference to an object in the Java EE component environment
a <span class="emphasis"><em>resource</em></span>.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_defining_a_resource"/>14.1. Defining a resource</h2></div></div></div>

<p>The CDI specification uses the term <span class="emphasis"><em>resource</em></span> to refer, generically, to
any of the following kinds of object which might be available in the
Java EE component environment:</p>
<div class="itemizedlist"><ul><li>
JDBC `Datasource`s, JMS `Queue`s, `Topic`s and `ConnectionFactory`s,
JavaMail `Session`s and other transactional resources including JCA
connectors,
</li><li>
JPA `EntityManager`s and `EntityManagerFactory`s,
</li><li>
remote EJBs, and
</li><li>
web services.
</li></ul></div>

<p>We declare a resource by annotating a producer field with a component
environment injection annotation: <code class="literal">@Resource</code>, <code class="literal">@EJB</code>,
<code class="literal">@PersistenceContext</code>, <code class="literal">@PersistenceUnit</code> or <code class="literal">@WebServiceRef</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">WebServiceRef</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">lookup</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;java:app/service/Catalog&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_type">Catalog</span><span class="java_plain">&nbsp;catalog</span><span class="java_separator">;</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Resource</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">lookup</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;java:global/env/jdbc/CustomerDatasource&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">CustomerDatabase</span><span class="java_plain">&nbsp;</span><span class="java_type">Datasource</span><span class="java_plain">&nbsp;customerDatabase</span><span class="java_separator">;</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">PersistenceContext</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">unitName</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;CustomerDatabase&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">CustomerDatabase</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;customerDatabasePersistenceContext</span><span class="java_separator">;</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">PersistenceUnit</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">unitName</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;CustomerDatabase&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">CustomerDatabase</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManagerFactory</span><span class="java_plain">&nbsp;customerDatabasePersistenceUnit</span><span class="java_separator">;</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_plain">&nbsp;@EJB</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">ejbLink</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;../their.jar#PaymentService&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_type">PaymentService</span><span class="java_plain">&nbsp;paymentService</span><span class="java_separator">;</span></pre>

<p>The field may be static (but not final).</p>
<p>A resource declaration really contains two pieces of information:</p>
<div class="itemizedlist"><ul><li>
the JNDI name, EJB link, persistence unit name, or other metadata
needed to obtain a reference to the resource from the component
environment, and
</li><li>
the type and qualifiers that we will use to inject the reference into
our beans.
</li></ul></div>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>It might feel strange to be declaring resources in Java code. Isn’t this
stuff that might be deployment-specific? Certainly, and that’s why it
makes sense to declare your resources in a class annotated
<code class="literal">@Alternative</code>.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_typesafe_resource_injection"/>14.2. Typesafe resource injection</h2></div></div></div>

<p>These resources can now be injected in the usual way.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Catalog</span><!-- <br/> --><span class="java_plain">&nbsp;catalog</span><!-- <br/> --><span class="java_separator">;</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">CustomerDatabase</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Datasource</span><!-- <br/> --><span class="java_plain">&nbsp;customerDatabase</span><!-- <br/> --><span class="java_separator">;</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">CustomerDatabase</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;customerDatabaseEntityManager</span><!-- <br/> --><span class="java_separator">;</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">CustomerDatabase</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">EntityManagerFactory</span><!-- <br/> --><span class="java_plain">&nbsp;customerDatabaseEntityManagerFactory</span><!-- <br/> --><span class="java_separator">;</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaymentService</span><!-- <br/> --><span class="java_plain">&nbsp;paymentService</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>The bean type and qualifiers of the resource are determined by the
producer field declaration.</p>
<p>It might seem like a pain to have to write these extra producer field
declarations, just to gain an additional level of indirection. You could
just as well use component environment injection directly, right? But
remember that you’re going to be using resources like the
<code class="literal">EntityManager</code> in several different beans. Isn’t it nicer and more
typesafe to write</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">CustomerDatabase</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">EntityManager</span></pre>

<p>instead of</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">PersistenceContext</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">unitName</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;CustomerDatabase&quot;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">EntityManager</span></pre>

<p>all over the place?</p>
</div>
</div>
</div>
<div class="part" lang="en-US"><div class="titlepage"><div><div><h1 class="title"><a id="_cdi_and_the_java_ee_ecosystem"/>Part IV. CDI and the Java EE ecosystem</h1></div></div></div>

<div class="partintro" lang="en-US"><div/>
<p>The third theme of CDI is <span class="emphasis"><em>integration</em></span>. We’ve already seen how CDI
helps integrate EJB and JSF, allowing EJBs to be bound directly to JSF
pages. That’s just the beginning. The CDI services are integrated into
the very core of the Java EE platform. Even EJB session beans can take
advantage of the dependency injection, event bus, and contextual
lifecycle management that CDI provides.</p>
<p>CDI is also designed to work in concert with technologies outside of the
platform by providing integration points into the Java EE platform via
an SPI. This SPI positions CDI as the foundation for a new ecosystem of
<span class="emphasis"><em>portable</em></span> extensions and integration with existing frameworks and
technologies. The CDI services will be able to reach a diverse
collection of technologies, such as business process management (BPM)
engines, existing web frameworks and de facto standard component models.
Of course, The Java EE platform will never be able to standardize all
the interesting technologies that are used in the world of Java
application development, but CDI makes it easier to use the technologies
which are not yet part of the platform seamlessly within the Java EE
environment.</p>
<p>We’re about to see how to take full advantage of the Java EE platform in
an application that uses CDI. We’ll also briefly meet a set of SPIs that
are provided to support portable extensions to CDI. You might not ever
need to use these SPIs directly, but don’t take them for granted. You
will likely be using them indirectly, every time you use a third-party
extension, such as <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://deltaspike.apache.org/">DeltaSpike</a>.</p>
<div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#_java_ee_integration">15. Java EE integration</a></span></dt><dd><dl><dt><span class="section"><a href="#_built_in_beans">15.1. Built-in beans</a></span></dt><dt><span class="section"><a href="#_injecting_java_ee_resources_into_a_bean">15.2. Injecting Java EE resources into a bean</a></span></dt><dt><span class="section"><a href="#_calling_a_bean_from_a_servlet">15.3. Calling a bean from a servlet</a></span></dt><dt><span class="section"><a href="#_calling_a_bean_from_a_message_driven_bean">15.4. Calling a bean from a message-driven bean</a></span></dt><dt><span class="section"><a href="#_jms_endpoints">15.5. JMS endpoints</a></span></dt><dt><span class="section"><a href="#packaging-and-deployment">15.6. Packaging and deployment</a></span></dt><dd><dl><dt><span class="section"><a href="#_explicit_bean_archive">15.6.1. Explicit bean archive</a></span></dt><dt><span class="section"><a href="#_implicit_bean_archive">15.6.2. Implicit bean archive</a></span></dt><dt><span class="section"><a href="#_what_archive_is_not_a_bean_archive">15.6.3. What archive is not a bean archive</a></span></dt><dt><span class="section"><a href="#_embeddable_ejb_container">15.6.4. Embeddable EJB container</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_portable_extensions">16. Portable extensions</a></span></dt><dd><dl><dt><span class="section"><a href="#_creating_an_literal_extension_literal">16.1. Creating an <code class="literal">Extension</code></a></span></dt><dt><span class="section"><a href="#_container_lifecycle_events">16.2. Container lifecycle events</a></span></dt><dt><span class="section"><a href="#_the_literal_beanmanager_literal_object">16.3. The <code class="literal">BeanManager</code> object</a></span></dt><dt><span class="section"><a href="#_the_literal_cdi_literal_class">16.4. The <code class="literal">CDI</code> class</a></span></dt><dt><span class="section"><a href="#_the_literal_injectiontarget_literal_interface">16.5. The <code class="literal">InjectionTarget</code> interface</a></span></dt><dt><span class="section"><a href="#_the_literal_bean_literal_interface">16.6. The <code class="literal">Bean</code> interface</a></span></dt><dt><span class="section"><a href="#_registering_a_literal_bean_literal">16.7. Registering a <code class="literal">Bean</code></a></span></dt><dt><span class="section"><a href="#_wrapping_an_literal_annotatedtype_literal">16.8. Wrapping an <code class="literal">AnnotatedType</code></a></span></dt><dt><span class="section"><a href="#_overriding_attributes_of_a_bean_by_wrapping_literal_beanattributes_literal">16.9. Overriding attributes of a bean by wrapping <code class="literal">BeanAttributes</code></a></span></dt><dt><span class="section"><a href="#_wrapping_an_literal_injectiontarget_literal">16.10. Wrapping an <code class="literal">InjectionTarget</code></a></span></dt><dt><span class="section"><a href="#_overriding_literal_injectionpoint_literal">16.11. Overriding <code class="literal">InjectionPoint</code></a></span></dt><dt><span class="section"><a href="#_manipulating_interceptors_decorators_and_alternatives_enabled_for_an_application">16.12. Manipulating interceptors, decorators and alternatives enabled for an application</a></span></dt><dt><span class="section"><a href="#_the_literal_context_literal_and_literal_alterablecontext_literal_interfaces">16.13. The <code class="literal">Context</code> and <code class="literal">AlterableContext</code> interfaces</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_next_steps">17. Next steps</a></span></dt></dl></div></div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_java_ee_integration"/>Chapter 15. Java EE integration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_built_in_beans">15.1. Built-in beans</a></span></dt><dt><span class="section"><a href="#_injecting_java_ee_resources_into_a_bean">15.2. Injecting Java EE resources into a bean</a></span></dt><dt><span class="section"><a href="#_calling_a_bean_from_a_servlet">15.3. Calling a bean from a servlet</a></span></dt><dt><span class="section"><a href="#_calling_a_bean_from_a_message_driven_bean">15.4. Calling a bean from a message-driven bean</a></span></dt><dt><span class="section"><a href="#_jms_endpoints">15.5. JMS endpoints</a></span></dt><dt><span class="section"><a href="#packaging-and-deployment">15.6. Packaging and deployment</a></span></dt><dd><dl><dt><span class="section"><a href="#_explicit_bean_archive">15.6.1. Explicit bean archive</a></span></dt><dt><span class="section"><a href="#_implicit_bean_archive">15.6.2. Implicit bean archive</a></span></dt><dt><span class="section"><a href="#_what_archive_is_not_a_bean_archive">15.6.3. What archive is not a bean archive</a></span></dt><dt><span class="section"><a href="#_embeddable_ejb_container">15.6.4. Embeddable EJB container</a></span></dt></dl></dd></dl></div>

<p>CDI is fully integrated into the Java EE environment. Beans have access
to Java EE resources and JPA persistence contexts. They may be used in
Unified EL expressions in JSF and JSP pages. They may even be injected
into other platform components, such as servlets and message-driven
Beans, which are not beans themselves.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_built_in_beans"/>15.1. Built-in beans</h2></div></div></div>

<p>In the Java EE environment, the container provides the following
built-in beans, all with the qualifier <code class="literal">@Default</code>:</p>
<div class="itemizedlist"><ul><li>
the current JTA <code class="literal">UserTransaction</code>,
</li><li>
a <code class="literal">Principal</code> representing the current caller identity,
</li><li>
the default <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://jcp.org/en/jsr/detail?id=303">Bean Validation</a>
<code class="literal">ValidationFactory</code>,
</li><li>
a <code class="literal">Validator</code> for the default <code class="literal">ValidationFactory</code>,
</li><li>
<code class="literal">HttpServletRequest</code>, <code class="literal">HttpSession</code> and <code class="literal">ServletContext</code>
</li></ul></div>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The <code class="literal">FacesContext</code> is not injectable. You can get at it by calling
<code class="literal">FacesContext.getCurrentInstance()</code>. Alternatively you may define the
following producer method:</p>
<pre xmlns="" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Produces</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">FacesContextProducer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">RequestScoped</span><span class="java_plain">&nbsp;</span><span class="java_type">FacesContext</span><span class="java_plain">&nbsp;getFacesContext</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">FacesContext</span><span class="java_separator">.</span><span class="java_plain">getCurrentInstance</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_injecting_java_ee_resources_into_a_bean"/>15.2. Injecting Java EE resources into a bean</h2></div></div></div>

<p>All managed beans may take advantage of Java EE component environment
injection using <code class="literal">@Resource</code>, <code class="literal">@EJB</code>, <code class="literal">@PersistenceContext</code>,
<code class="literal">@PersistenceUnit</code> and <code class="literal">@WebServiceRef</code>. We’ve already seen a couple of
examples of this, though we didn’t pay much attention at the time:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Transactional</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Interceptor</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">TransactionInterceptor</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Resource</span><span class="java_plain">&nbsp;</span><span class="java_type">UserTransaction</span><span class="java_plain">&nbsp;transaction</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AroundInvoke</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;manageTransaction</span><span class="java_separator">(</span><span class="java_type">InvocationContext</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">SessionScoped</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">Credentials</span><span class="java_plain">&nbsp;credentials</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PersistenceContext</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;userDatabase</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The Java EE <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code> callbacks are also
supported for all managed beans. The <code class="literal">@PostConstruct</code> method is called
after <span class="emphasis"><em>all</em></span> injection has been performed.</p>
<p>Of course, we advise that component environment injection be used to
define CDI resources, and that typesafe injection be used in application
code.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_calling_a_bean_from_a_servlet"/>15.3. Calling a bean from a servlet</h2></div></div></div>

<p>It’s easy to use a bean from a servlet in Java EE. Simply inject the
bean using field or initializer method injection.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">LoginServlet</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">HttpServlet</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">Credentials</span><span class="java_plain">&nbsp;credentials</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">Login</span><span class="java_plain">&nbsp;login</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;service</span><span class="java_separator">(</span><span class="java_type">HttpServletRequest</span><span class="java_plain">&nbsp;request</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">HttpServletResponse</span><span class="java_plain">&nbsp;response</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">ServletException</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">IOException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;credentials</span><span class="java_separator">.</span><span class="java_plain">setUsername</span><span class="java_separator">(</span><span class="java_plain">request</span><span class="java_separator">.</span><span class="java_plain">getParameter</span><span class="java_separator">(</span><span class="java_literal">&quot;username&quot;</span><span class="java_separator">))</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;credentials</span><span class="java_separator">.</span><span class="java_plain">setPassword</span><span class="java_separator">(</span><span class="java_plain">request</span><span class="java_separator">.</span><span class="java_plain">getParameter</span><span class="java_separator">(</span><span class="java_literal">&quot;password&quot;</span><span class="java_separator">))</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;login</span><span class="java_separator">.</span><span class="java_plain">login</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;login</span><span class="java_separator">.</span><span class="java_plain">isLoggedIn</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response</span><span class="java_separator">.</span><span class="java_plain">sendRedirect</span><span class="java_separator">(</span><span class="java_literal">&quot;/home.jsp&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response</span><span class="java_separator">.</span><span class="java_plain">sendRedirect</span><span class="java_separator">(</span><span class="java_literal">&quot;/loginError.jsp&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Since instances of servlets are shared across all incoming threads, the
bean client proxy takes care of routing method invocations from the
servlet to the correct instances of <code class="literal">Credentials</code> and <code class="literal">Login</code> for the
current request and HTTP session.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_calling_a_bean_from_a_message_driven_bean"/>15.4. Calling a bean from a message-driven bean</h2></div></div></div>

<p>CDI injection applies to all EJBs, even when they aren’t CDI beans. In
particular, you can use CDI injection in message-driven beans, which are
by nature not contextual objects.</p>
<p>You can even use interceptor bindings for message-driven Beans.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Transactional</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">MessageDriven</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ProcessOrder</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">MessageListener</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">Inventory</span><span class="java_plain">&nbsp;inventory</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PersistenceContext</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;onMessage</span><span class="java_separator">(</span><span class="java_type">Message</span><span class="java_plain">&nbsp;message</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Please note that there is no session or conversation context available
when a message is delivered to a message-driven bean. Only
<code class="literal">@RequestScoped</code> and <code class="literal">@ApplicationScoped</code> beans are available.</p>
<p>But how about beans which <span class="emphasis"><em>send</em></span> JMS messages?</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_jms_endpoints"/>15.5. JMS endpoints</h2></div></div></div>

<p>Sending messages using JMS can be quite complex, because of the number
of different objects you need to deal with. For queues we have <code class="literal">Queue</code>,
<code class="literal">QueueConnectionFactory</code>, <code class="literal">QueueConnection</code>, <code class="literal">QueueSession</code> and
<code class="literal">QueueSender</code>. For topics we have <code class="literal">Topic</code>, <code class="literal">TopicConnectionFactory</code>,
<code class="literal">TopicConnection</code>, <code class="literal">TopicSession</code> and <code class="literal">TopicPublisher</code>. Each of these
objects has its own lifecycle and threading model that we need to worry
about.</p>
<p>You can use producer fields and methods to prepare all of these
resources for injection into a bean:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">jms</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">ConnectionFactory</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">jms</span><span class="java_separator">.</span><span class="java_type">Queue</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">OrderResources</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Resource</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;jms/ConnectionFactory&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">ConnectionFactory</span><span class="java_plain">&nbsp;connectionFactory</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Resource</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;jms/OrderQueue&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Queue</span><span class="java_plain">&nbsp;orderQueue</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">Order</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Connection</span><span class="java_plain">&nbsp;createOrderConnection</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">JMSException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;connectionFactory</span><span class="java_separator">.</span><span class="java_plain">createConnection</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;closeOrderConnection</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Disposes</span><span class="java_plain">&nbsp;@</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_type">Connection</span><span class="java_plain">&nbsp;connection</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">JMSException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">Order</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Session</span><span class="java_plain">&nbsp;createOrderSession</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_type">Connection</span><span class="java_plain">&nbsp;connection</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">JMSException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;connection</span><span class="java_separator">.</span><span class="java_plain">createSession</span><span class="java_separator">(</span><span class="java_literal">true</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Session</span><span class="java_separator">.</span><span class="java_plain">AUTO_ACKNOWLEDGE</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;closeOrderSession</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Disposes</span><span class="java_plain">&nbsp;@</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_type">Session</span><span class="java_plain">&nbsp;session</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">JMSException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Produces</span><span class="java_plain">&nbsp;@</span><span class="java_type">Order</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">MessageProducer</span><span class="java_plain">&nbsp;createOrderMessageProducer</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_type">Session</span><span class="java_plain">&nbsp;session</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">JMSException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">createProducer</span><span class="java_separator">(</span><span class="java_plain">orderQueue</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;closeOrderMessageProducer</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Disposes</span><span class="java_plain">&nbsp;@</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_type">MessageProducer</span><span class="java_plain">&nbsp;producer</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">JMSException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;producer</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>In this example, we can just inject the prepared <code class="literal">MessageProducer</code>,
<code class="literal">Connection</code> or <code class="literal">QueueSession</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Order</span><!-- <br/> --><span class="java_plain">&nbsp;order</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_type">MessageProducer</span><span class="java_plain">&nbsp;producer</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;@</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_type">Session</span><span class="java_plain">&nbsp;orderSession</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;sendMessage</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">MapMessage</span><span class="java_plain">&nbsp;msg&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;orderSession</span><span class="java_separator">.</span><span class="java_plain">createMapMessage</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;msg</span><span class="java_separator">.</span><span class="java_plain">setLong</span><span class="java_separator">(</span><span class="java_literal">&quot;orderId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;order</span><span class="java_separator">.</span><span class="java_plain">getId</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;producer</span><span class="java_separator">.</span><span class="java_plain">send</span><span class="java_separator">(</span><span class="java_plain">msg</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The lifecycle of the injected JMS objects is completely controlled by
the container.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="packaging-and-deployment"/>15.6. Packaging and deployment</h2></div></div></div>

<p>CDI doesn’t define any special deployment archive. You can package CDI
beans in JARs, EJB JARs or WARs—any deployment location in the
application classpath. However, the archive must be a "bean archive".</p>
<p>Unlike CDI 1.0, the CDI 1.1 specification recognizes two types of bean
archives. The type determines the way the container discovers CDI beans
in the archive.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>CDI 1.1 makes use of a new XSD file for beans.xml descriptor:
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd">http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd</a></p>
</div>

<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_explicit_bean_archive"/>15.6.1. Explicit bean archive</h3></div></div></div>

<p>An explicit bean archive is an archive which contains a <code class="literal">beans.xml</code>
file:</p>
<div class="itemizedlist"><ul><li>
with a version number of 1.1 (or later), with the bean-discovery-mode
of <code class="literal">all</code>, or,
</li><li>
like in CDI 1.0 – with no version number, or, that is an empty file.
</li></ul></div>

<p>It behaves just like a CDI 1.0 bean archive – i.e. Weld discovers each
Java class, interface or enum in such an archive.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The <code class="literal">beans.xml</code> file must be located at:</p>
<div class="itemizedlist"><ul><li>
<code class="literal">META-INF/beans.xml</code> (for jar archives), or,
</li><li>
<code class="literal">WEB-INF/beans.xml</code> or <code class="literal">WEB-INF/classes/META-INF/beans.xml</code> (for WAR
archives).
</li></ul></div>

<p>You should never place a <code class="literal">beans.xml</code> file in both of the WEB-INF and the
WEB-INF/classes/META-INF directories. Otherwise your application would
not be portable.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_implicit_bean_archive"/>15.6.2. Implicit bean archive</h3></div></div></div>

<p>An implicit bean archive is an archive which contains one or more bean
classes with a <span class="emphasis"><em>bean defining annotation</em></span>, or one or more session beans.
It can also contain a <code class="literal">beans.xml</code> file with a version number of 1.1 (or
later), with the bean-discovery-mode of <code class="literal">annotated</code>. Weld only discovers
Java classes with a bean defining annotation within an implicit bean
archive.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Any scope type is a bean defining annotation. If you place a scope type
on a bean class, then it has a bean defining annotation. See
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/cdi/spec/1.1/cdi-spec.html#bean_defining_annotations">2.5.
Bean defining annotations</a> to learn more.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_what_archive_is_not_a_bean_archive"/>15.6.3. What archive is not a bean archive</h3></div></div></div>

<p>Although quite obvious, let’s sum it up:</p>
<div class="itemizedlist"><ul><li>
an archive which contains neither a <code class="literal">beans.xml</code> file nor any bean
class with a <span class="emphasis"><em>bean defining annotation</em></span>,
</li><li>
an archive which contains a <code class="literal">beans.xml</code> file with the
bean-discovery-mode of <code class="literal">none</code>.
</li></ul></div>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>For compatibility with CDI 1.0, each Java EE product (WildFly,
GlassFish, etc.) must contain an option to cause an archive to be
ignored by the container when no <code class="literal">beans.xml</code> is present. Consult
specific Java EE product documentation to learn more about such option.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_embeddable_ejb_container"/>15.6.4. Embeddable EJB container</h3></div></div></div>

<p>In an embeddable EJB container, beans may be deployed in any location in
which EJBs may be deployed.</p>
</div>
</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_portable_extensions"/>Chapter 16. Portable extensions</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_creating_an_literal_extension_literal">16.1. Creating an <code class="literal">Extension</code></a></span></dt><dt><span class="section"><a href="#_container_lifecycle_events">16.2. Container lifecycle events</a></span></dt><dt><span class="section"><a href="#_the_literal_beanmanager_literal_object">16.3. The <code class="literal">BeanManager</code> object</a></span></dt><dt><span class="section"><a href="#_the_literal_cdi_literal_class">16.4. The <code class="literal">CDI</code> class</a></span></dt><dt><span class="section"><a href="#_the_literal_injectiontarget_literal_interface">16.5. The <code class="literal">InjectionTarget</code> interface</a></span></dt><dt><span class="section"><a href="#_the_literal_bean_literal_interface">16.6. The <code class="literal">Bean</code> interface</a></span></dt><dt><span class="section"><a href="#_registering_a_literal_bean_literal">16.7. Registering a <code class="literal">Bean</code></a></span></dt><dt><span class="section"><a href="#_wrapping_an_literal_annotatedtype_literal">16.8. Wrapping an <code class="literal">AnnotatedType</code></a></span></dt><dt><span class="section"><a href="#_overriding_attributes_of_a_bean_by_wrapping_literal_beanattributes_literal">16.9. Overriding attributes of a bean by wrapping <code class="literal">BeanAttributes</code></a></span></dt><dt><span class="section"><a href="#_wrapping_an_literal_injectiontarget_literal">16.10. Wrapping an <code class="literal">InjectionTarget</code></a></span></dt><dt><span class="section"><a href="#_overriding_literal_injectionpoint_literal">16.11. Overriding <code class="literal">InjectionPoint</code></a></span></dt><dt><span class="section"><a href="#_manipulating_interceptors_decorators_and_alternatives_enabled_for_an_application">16.12. Manipulating interceptors, decorators and alternatives enabled for an application</a></span></dt><dt><span class="section"><a href="#_the_literal_context_literal_and_literal_alterablecontext_literal_interfaces">16.13. The <code class="literal">Context</code> and <code class="literal">AlterableContext</code> interfaces</a></span></dt></dl></div>

<p>CDI is intended to be a foundation for frameworks, extensions and
integration with other technologies. Therefore, CDI exposes a set of
SPIs for the use of developers of portable extensions to CDI. For
example, the following kinds of extensions were envisaged by the
designers of CDI:</p>
<div class="itemizedlist"><ul><li>
integration with Business Process Management engines,
</li><li>
integration with third-party frameworks such as Spring, Seam, GWT or
Wicket, and
</li><li>
new technology based upon the CDI programming model.
</li></ul></div>

<p>More formally, according to the spec:</p>
<div class="blockquote"><blockquote class="blockquote">
  
<p>A portable extension may integrate with the container by:</p>
<div class="itemizedlist"><ul><li>
Providing its own beans, interceptors and decorators to the container
</li><li>
Injecting dependencies into its own objects using the dependency
injection service
</li><li>
Providing a context implementation for a custom scope
</li><li>
Augmenting or overriding the annotation-based metadata with metadata
from some other source
</li></ul></div>

</blockquote></div>

<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_creating_an_literal_extension_literal"/>16.1. Creating an <code class="literal">Extension</code></h2></div></div></div>

<p>The first step in creating a portable extension is to write a class that
implements <code class="literal">Extension</code>. This marker interface does not define any
methods, but it’s needed to satisfy the requirements of Java SE’s
service provider architecture.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">spi</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Extension</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MyExtension</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Extension</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>

<p>Next, we need to register our extension as a service provider by
creating a file named
<code class="literal">META-INF/services/javax.enterprise.inject.spi.Extension</code>, which
contains the name of our extension class:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mydomain</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">extension</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">MyExtension</span></pre>

<p>An extension is not a bean, exactly, since it is instantiated by the
container during the initialization process, before any beans or
contexts exist. However, it can be injected into other beans once the
initialization process is complete.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span>
<!--  --><br/><span class="java_type">MyBean</span><span class="java_separator">(</span><span class="java_type">MyExtension</span><span class="java_plain">&nbsp;myExtension</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;myExtension</span><span class="java_separator">.</span><span class="java_plain">doSomething</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>And, like beans, extensions can have observer methods. Usually, the
observer methods observe <span class="emphasis"><em>container lifecycle events</em></span>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_container_lifecycle_events"/>16.2. Container lifecycle events</h2></div></div></div>

<p>During the initialization process, the container fires a series of
events, including:</p>
<div class="itemizedlist"><ul><li>
<code class="literal">BeforeBeanDiscovery</code>
</li><li>
<code class="literal">ProcessAnnotatedType</code> and <code class="literal">ProcessSyntheticAnnotatedType</code>
</li><li>
<code class="literal">AfterTypeDiscovery</code>
</li><li>
<code class="literal">ProcessInjectionTarget</code> and <code class="literal">ProcessProducer</code>
</li><li>
<code class="literal">ProcessInjectionPoint</code>
</li><li>
<code class="literal">ProcessBeanAttributes</code>
</li><li>
<code class="literal">ProcessBean</code>, <code class="literal">ProcessManagedBean</code>, <code class="literal">ProcessSessionBean</code>,
<code class="literal">ProcessProducerMethod</code> and <code class="literal">ProcessProducerField</code>
</li><li>
<code class="literal">ProcessObserverMethod</code>
</li><li>
<code class="literal">AfterBeanDiscovery</code>
</li><li>
<code class="literal">AfterDeploymentValidation</code>
</li></ul></div>

<p>Extensions may observe these events:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">spi</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Extension</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MyExtension</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Extension</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;beforeBeanDiscovery</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_plain">&nbsp;</span><span class="java_type">BeforeBeanDiscovery</span><span class="java_plain">&nbsp;bbd</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Logger</span><span class="java_separator">.</span><span class="java_plain">global</span><span class="java_separator">.</span><span class="java_plain">debug</span><span class="java_separator">(</span><span class="java_literal">&quot;beginning&nbsp;the&nbsp;scanning&nbsp;process&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;processAnnotatedType</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_plain">&nbsp;</span><span class="java_type">ProcessAnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;pat</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Logger</span><span class="java_separator">.</span><span class="java_plain">global</span><span class="java_separator">.</span><span class="java_plain">debug</span><span class="java_separator">(</span><span class="java_literal">&quot;scanning&nbsp;type:&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;pat</span><span class="java_separator">.</span><span class="java_plain">getAnnotatedType</span><span class="java_separator">().</span><span class="java_plain">getJavaClass</span><span class="java_separator">().</span><span class="java_plain">getName</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;afterBeanDiscovery</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_plain">&nbsp;</span><span class="java_type">AfterBeanDiscovery</span><span class="java_plain">&nbsp;abd</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Logger</span><span class="java_separator">.</span><span class="java_plain">global</span><span class="java_separator">.</span><span class="java_plain">debug</span><span class="java_separator">(</span><span class="java_literal">&quot;finished&nbsp;the&nbsp;scanning&nbsp;process&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>In fact, the extension can do a lot more than just observe. The
extension is permitted to modify the container’s metamodel and more.
Here’s a very simple example:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">spi</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Extension</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MyExtension</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Extension</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;processAnnotatedType</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_plain">&nbsp;@</span><span class="java_type">WithAnnotations</span><span class="java_separator">({</span><span class="java_type">Ignore</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">})</span><span class="java_plain">&nbsp;</span><span class="java_type">ProcessAnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;pat</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;tell&nbsp;the&nbsp;container&nbsp;to&nbsp;ignore&nbsp;the&nbsp;type&nbsp;if&nbsp;it&nbsp;is&nbsp;annotated&nbsp;@Ignore&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;pat</span><span class="java_separator">.</span><span class="java_plain">getAnnotatedType</span><span class="java_separator">().</span><span class="java_plain">isAnnotationPresent</span><span class="java_separator">(</span><span class="java_type">Ignore</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;pat</span><span class="java_separator">.</span><span class="java_plain">veto</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The <code class="literal">@WithAnnotations</code> annotation causes the container to deliver the
ProcessAnnotatedType events only for the types which contain the
specified annotation.</p>
</div>

<p>The observer method may inject a <code class="literal">BeanManager</code></p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;processAnnotatedType</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ProcessAnnotatedType</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;pat</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BeanManager</span><!-- <br/> --><span class="java_plain">&nbsp;beanManager</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">}</span></pre>

<p>An extension observer method is not allowed to inject any other object.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_literal_beanmanager_literal_object"/>16.3. The <code class="literal">BeanManager</code> object</h2></div></div></div>

<p>The nerve center for extending CDI is the <code class="literal">BeanManager</code> object. The
<code class="literal">BeanManager</code> interface lets us obtain beans, interceptors, decorators,
observers and contexts programmatically.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BeanManager</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;getReference</span><span class="java_separator">(</span><span class="java_type">Bean</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;bean</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Type</span><span class="java_plain">&nbsp;beanType</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CreationalContext</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;getInjectableReference</span><span class="java_separator">(</span><span class="java_type">InjectionPoint</span><span class="java_plain">&nbsp;ij</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CreationalContext</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">CreationalContext</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;createCreationalContext</span><span class="java_separator">(</span><span class="java_type">Contextual</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;contextual</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Bean</span><span class="java_operator">&lt;?&gt;&gt;</span><span class="java_plain">&nbsp;getBeans</span><span class="java_separator">(</span><span class="java_type">Type</span><span class="java_plain">&nbsp;beanType</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_separator">...</span><span class="java_plain">&nbsp;qualifiers</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Bean</span><span class="java_operator">&lt;?&gt;&gt;</span><span class="java_plain">&nbsp;getBeans</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Bean</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;getPassivationCapableBean</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">Bean</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;resolve</span><span class="java_separator">(</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Bean</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;X</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;beans</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;validate</span><span class="java_separator">(</span><span class="java_type">InjectionPoint</span><span class="java_plain">&nbsp;injectionPoint</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;fireEvent</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;event</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_separator">...</span><span class="java_plain">&nbsp;qualifiers</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ObserverMethod</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">super</span><span class="java_plain">&nbsp;T</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;resolveObserverMethods</span><span class="java_separator">(</span><span class="java_plain">T&nbsp;event</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_separator">...</span><span class="java_plain">&nbsp;qualifiers</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Decorator</span><span class="java_operator">&lt;?&gt;&gt;</span><span class="java_plain">&nbsp;resolveDecorators</span><span class="java_separator">(</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Type</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;types</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_separator">...</span><span class="java_plain">&nbsp;qualifiers</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Interceptor</span><span class="java_operator">&lt;?&gt;&gt;</span><span class="java_plain">&nbsp;resolveInterceptors</span><span class="java_separator">(</span><span class="java_type">InterceptionType</span><span class="java_plain">&nbsp;type</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_separator">...</span><span class="java_plain">&nbsp;interceptorBindings</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isScope</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotationType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isNormalScope</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotationType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isPassivatingScope</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotationType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isQualifier</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotationType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isInterceptorBinding</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotationType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isStereotype</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotationType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getInterceptorBindingDefinition</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bindingType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getStereotypeDefinition</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;stereotype</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;areQualifiersEquivalent</span><span class="java_separator">(</span><span class="java_type">Annotation</span><span class="java_plain">&nbsp;qualifier1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_plain">&nbsp;qualifier2</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;areInterceptorBindingsEquivalent</span><span class="java_separator">(</span><span class="java_type">Annotation</span><span class="java_plain">&nbsp;interceptorBinding1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_plain">&nbsp;interceptorBinding2</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getQualifierHashCode</span><span class="java_separator">(</span><span class="java_type">Annotation</span><span class="java_plain">&nbsp;qualifier</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getInterceptorBindingHashCode</span><span class="java_separator">(</span><span class="java_type">Annotation</span><span class="java_plain">&nbsp;interceptorBinding</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Context</span><span class="java_plain">&nbsp;getContext</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;scopeType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">ELResolver</span><span class="java_plain">&nbsp;getELResolver</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">ExpressionFactory</span><span class="java_plain">&nbsp;wrapExpressionFactory</span><span class="java_separator">(</span><span class="java_type">ExpressionFactory</span><span class="java_plain">&nbsp;expressionFactory</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;createAnnotatedType</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;type</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">InjectionTarget</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;createInjectionTarget</span><span class="java_separator">(</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;type</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">InjectionTargetFactory</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getInjectionTargetFactory</span><span class="java_separator">(</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotatedType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">ProducerFactory</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getProducerFactory</span><span class="java_separator">(</span><span class="java_type">AnnotatedField</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">super</span><span class="java_plain">&nbsp;X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;field</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Bean</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;declaringBean</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">ProducerFactory</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getProducerFactory</span><span class="java_separator">(</span><span class="java_type">AnnotatedMethod</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">super</span><span class="java_plain">&nbsp;X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;method</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Bean</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;declaringBean</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">BeanAttributes</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;createBeanAttributes</span><span class="java_separator">(</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;type</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BeanAttributes</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;createBeanAttributes</span><span class="java_separator">(</span><span class="java_type">AnnotatedMember</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;type</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">Bean</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;createBean</span><span class="java_separator">(</span><span class="java_type">BeanAttributes</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;attributes</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;beanClass</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_separator">,</span><span class="java_plain">&nbsp;X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">Bean</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;createBean</span><span class="java_separator">(</span><span class="java_type">BeanAttributes</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;attributes</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;beanClass</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ProducerFactory</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;producerFactory</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">InjectionPoint</span><span class="java_plain">&nbsp;createInjectionPoint</span><span class="java_separator">(</span><span class="java_type">AnnotatedField</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;field</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">InjectionPoint</span><span class="java_plain">&nbsp;createInjectionPoint</span><span class="java_separator">(</span><span class="java_type">AnnotatedParameter</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;parameter</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Extension</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;T&nbsp;getExtension</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;extensionClass</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Any bean or other Java EE component which supports injection can obtain
an instance of <code class="literal">BeanManager</code> via injection:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BeanManager</span><!-- <br/> --><span class="java_plain">&nbsp;beanManager</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>Alternatively, a <code class="literal">BeanManager</code> reference may be obtained from CDI via a
static method call.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">CDI</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">current</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">getBeanManager</span><!-- <br/> --><span class="java_separator">()</span></pre>

<p>Java EE components may obtain an instance of <code class="literal">BeanManager</code> from JNDI by
looking up the name <code class="literal">java:comp/BeanManager</code>. Any operation of
<code class="literal">BeanManager</code> may be called at any time during the execution of the
application.</p>
<p>Let’s study some of the interfaces exposed by the <code class="literal">BeanManager</code>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_literal_cdi_literal_class"/>16.4. The <code class="literal">CDI</code> class</h2></div></div></div>

<p>Application components which cannot obtain a <code class="literal">BeanManager</code> reference via
injection nor JNDI lookup can get the reference from the
<code class="literal">javax.enterprise.inject.spi.CDI</code> class via a static method call:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">BeanManager</span><!-- <br/> --><span class="java_plain">&nbsp;manager&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;CDI</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">current</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">getBeanManager</span><!-- <br/> --><span class="java_separator">();</span></pre>

<p>The <code class="literal">CDI</code> class can be used directly to programmatically lookup CDI
beans as described in <a href="#_obtaining_a_contextual_instance_by_programmatic_lookup" title="4.10. Obtaining a contextual instance by programmatic lookup">Section 4.10, “Obtaining a contextual instance by programmatic lookup”</a></p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">CDI</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">select</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">Foo</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">get</span><!-- <br/> --><span class="java_separator">()</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_literal_injectiontarget_literal_interface"/>16.5. The <code class="literal">InjectionTarget</code> interface</h2></div></div></div>

<p>The first thing that a framework developer is going to look for in the
portable extension SPI is a way to inject CDI beans into objects which
are not under the control of CDI. The <code class="literal">InjectionTarget</code> interface makes
this very easy.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>We recommend that frameworks let CDI take over the job of actually
instantiating the framework-controlled objects. That way, the
framework-controlled objects can take advantage of constructor
injection. However, if the framework requires use of a constructor with
a special signature, the framework will need to instantiate the object
itself, and so only method and field injection will be supported.</p>
</div>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">spi</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">CDI</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">get&nbsp;the&nbsp;</span><span class="java_type">BeanManager</span>
<!--  --><br/><span class="java_type">BeanManager</span><span class="java_plain">&nbsp;beanManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;CDI</span><span class="java_separator">.</span><span class="java_plain">current</span><span class="java_separator">().</span><span class="java_plain">getBeanManager</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">CDI&nbsp;uses&nbsp;an&nbsp;</span><span class="java_type">AnnotatedType</span><span class="java_plain">&nbsp;object&nbsp;to&nbsp;read&nbsp;the&nbsp;annotations&nbsp;of&nbsp;a&nbsp;</span><span class="java_keyword">class</span>
<!--  --><br/><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_type">SomeFrameworkComponent</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;type&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;beanManager</span><span class="java_separator">.</span><span class="java_plain">createAnnotatedType</span><span class="java_separator">(</span><span class="java_type">SomeFrameworkComponent</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">The</span><span class="java_plain">&nbsp;extension&nbsp;uses&nbsp;an&nbsp;</span><span class="java_type">InjectionTarget</span><span class="java_plain">&nbsp;to&nbsp;delegate&nbsp;instantiation</span><span class="java_separator">,</span><span class="java_plain">&nbsp;dependency&nbsp;injection</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">and&nbsp;lifecycle&nbsp;callbacks&nbsp;to&nbsp;the&nbsp;CDI&nbsp;container</span>
<!--  --><br/><span class="java_type">InjectionTarget</span><span class="java_operator">&lt;</span><span class="java_type">SomeFrameworkComponent</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;it&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;beanManager</span><span class="java_separator">.</span><span class="java_plain">createInjectionTarget</span><span class="java_separator">(</span><span class="java_plain">type</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">each&nbsp;instance&nbsp;needs&nbsp;its&nbsp;own&nbsp;CDI&nbsp;</span><span class="java_type">CreationalContext</span>
<!--  --><br/><span class="java_type">CreationalContext</span><span class="java_plain">&nbsp;ctx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;beanManager</span><span class="java_separator">.</span><span class="java_plain">createCreationalContext</span><span class="java_separator">(</span><span class="java_literal">null</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">instantiate&nbsp;the&nbsp;framework&nbsp;component&nbsp;and&nbsp;inject&nbsp;its&nbsp;dependencies</span>
<!--  --><br/><span class="java_type">SomeFrameworkComponent</span><span class="java_plain">&nbsp;instance&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">produce</span><span class="java_separator">(</span><span class="java_plain">ctx</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">call&nbsp;the&nbsp;constructor</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">call&nbsp;initializer&nbsp;methods&nbsp;and&nbsp;perform&nbsp;field&nbsp;injection</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">postConstruct</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">call&nbsp;the&nbsp;@</span><span class="java_type">PostConstruct</span><span class="java_plain">&nbsp;method</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">destroy&nbsp;the&nbsp;framework&nbsp;component&nbsp;instance&nbsp;and&nbsp;clean&nbsp;up&nbsp;dependent&nbsp;objects</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">preDestroy</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">call&nbsp;the&nbsp;@</span><span class="java_type">PreDestroy</span><span class="java_plain">&nbsp;method</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">dispose</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">it&nbsp;is&nbsp;now&nbsp;safe&nbsp;to&nbsp;discard&nbsp;the&nbsp;instance</span>
<!--  --><br/><span class="java_plain">ctx</span><span class="java_separator">.</span><span class="java_plain">release</span><span class="java_separator">();</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">clean&nbsp;up&nbsp;dependent&nbsp;objects</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_literal_bean_literal_interface"/>16.6. The <code class="literal">Bean</code> interface</h2></div></div></div>

<p>Instances of the interface <code class="literal">Bean</code> represent beans. There is an instance
of <code class="literal">Bean</code> registered with the <code class="literal">BeanManager</code> object for every bean in the
application. There are even <code class="literal">Bean</code> objects representing interceptors,
decorators and producer methods.</p>
<p>The <code class="literal">BeanAttributes</code> interface exposes all the interesting things we
discussed in <a href="#_the_anatomy_of_a_bean" title="2.1. The anatomy of a bean">Section 2.1, “The anatomy of a bean”</a>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BeanAttributes</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Type</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getTypes</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getQualifiers</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getScope</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;getStereotypes</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isAlternative</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The <code class="literal">Bean</code> interface extends the <code class="literal">BeanAttributes</code> interface and defines
everything the container needs to manage instances of a certain bean.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Bean</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Contextual</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BeanAttributes</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;getBeanClass</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">InjectionPoint</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getInjectionPoints</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isNullable</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>There’s an easy way to find out what beans exist in the application:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Set</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Bean</span><!-- <br/> --><span class="java_operator">&lt;?&gt;&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;allBeans&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;beanManager</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getBeans</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">Obect</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">AnnotationLiteral</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Any</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{});</span></pre>

<p>The <code class="literal">Bean</code> interface makes it possible for a portable extension to
provide support for new kinds of beans, beyond those defined by the CDI
specification. For example, we could use the <code class="literal">Bean</code> interface to allow
objects managed by another framework to be injected into beans.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_registering_a_literal_bean_literal"/>16.7. Registering a <code class="literal">Bean</code></h2></div></div></div>

<p>The most common kind of CDI portable extension registers a bean (or
beans) with the container.</p>
<p>In this example, we make a framework class, <code class="literal">SecurityManager</code> available
for injection. To make things a bit more interesting, we’re going to
delegate back to the container’s <code class="literal">InjectionTarget</code> to perform
instantiation and injection upon the <code class="literal">SecurityManager</code> instance.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">spi</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Extension</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">enterprise</span><span class="java_separator">.</span><span class="java_plain">event</span><span class="java_separator">.</span><span class="java_type">Observes</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Annotation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">reflect</span><span class="java_separator">.</span><span class="java_type">Type</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">enterprise</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">.</span><span class="java_plain">spi</span><span class="java_separator">.</span><span class="java_type">InjectionPoint</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SecurityManagerExtension</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Extension</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;afterBeanDiscovery</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_plain">&nbsp;</span><span class="java_type">AfterBeanDiscovery</span><span class="java_plain">&nbsp;abd</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">BeanManager</span><span class="java_plain">&nbsp;bm</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">use&nbsp;</span><span class="java_keyword">this</span><span class="java_plain">&nbsp;to&nbsp;read&nbsp;annotations&nbsp;of&nbsp;the&nbsp;</span><span class="java_keyword">class</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_type">SecurityManager</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;at&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;bm</span><span class="java_separator">.</span><span class="java_plain">createAnnotatedType</span><span class="java_separator">(</span><span class="java_type">SecurityManager</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">use&nbsp;</span><span class="java_keyword">this</span><span class="java_plain">&nbsp;to&nbsp;instantiate&nbsp;the&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;and&nbsp;inject&nbsp;dependencies</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">InjectionTarget</span><span class="java_operator">&lt;</span><span class="java_type">SecurityManager</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;it&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;bm</span><span class="java_separator">.</span><span class="java_plain">createInjectionTarget</span><span class="java_separator">(</span><span class="java_plain">at</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abd</span><span class="java_separator">.</span><span class="java_plain">addBean</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Bean</span><span class="java_operator">&lt;</span><span class="java_type">SecurityManager</span><span class="java_operator">&gt;</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;getBeanClass</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">SecurityManager</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">InjectionPoint</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getInjectionPoints</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">getInjectionPoints</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;securityManager&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getQualifiers</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;qualifiers&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qualifiers</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Default</span><span class="java_operator">&gt;</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qualifiers</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Any</span><span class="java_operator">&gt;</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;qualifiers</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getScope</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">ApplicationScoped</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;getStereotypes</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">Collections</span><span class="java_separator">.</span><span class="java_plain">emptySet</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Type</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getTypes</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Type</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;types&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">Type</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;types</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_type">SecurityManager</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;types</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;types</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isAlternative</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isNullable</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">SecurityManager</span><span class="java_plain">&nbsp;create</span><span class="java_separator">(</span><span class="java_type">CreationalContext</span><span class="java_operator">&lt;</span><span class="java_type">SecurityManager</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">SecurityManager</span><span class="java_plain">&nbsp;instance&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">produce</span><span class="java_separator">(</span><span class="java_plain">ctx</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">postConstruct</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;instance</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;destroy</span><span class="java_separator">(</span><span class="java_type">SecurityManager</span><span class="java_plain">&nbsp;instance</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CreationalContext</span><span class="java_operator">&lt;</span><span class="java_type">SecurityManager</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">preDestroy</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">dispose</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx</span><span class="java_separator">.</span><span class="java_plain">release</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>But a portable extension can also mess with beans that are discovered
automatically by the container.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_wrapping_an_literal_annotatedtype_literal"/>16.8. Wrapping an <code class="literal">AnnotatedType</code></h2></div></div></div>

<p>One of the most interesting things that an extension class can do is
process the annotations of a bean class <span class="emphasis"><em>before</em></span> the container builds
its metamodel.</p>
<p>Let’s start with an example of an extension that provides support for
the use of <code class="literal">@Named</code> at the package level. The package-level name is used
to qualify the EL names of all beans defined in that package. The
portable extension uses the <code class="literal">ProcessAnnotatedType</code> event to wrap the
<code class="literal">AnnotatedType</code> object and override the <code class="literal">value()</code> of the <code class="literal">@Named</code>
annotation.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;java</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">lang</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">reflect</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Type</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">enterprise</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">.</span><span class="java_plain">spi</span><span class="java_separator">.</span><span class="java_type">Extension</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Annotation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">QualifiedNameExtension</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Extension</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;processAnnotatedType</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_plain">&nbsp;</span><span class="java_type">ProcessAnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;pat</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;wrap&nbsp;this&nbsp;to&nbsp;override&nbsp;the&nbsp;annotations&nbsp;of&nbsp;the&nbsp;class&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;at&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;pat</span><span class="java_separator">.</span><span class="java_plain">getAnnotatedType</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Only&nbsp;wrap&nbsp;AnnotatedTypes&nbsp;for&nbsp;classes&nbsp;with&nbsp;@Named&nbsp;packages&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Package</span><span class="java_plain">&nbsp;pkg&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getJavaClass</span><span class="java_separator">().</span><span class="java_plain">getPackage</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_operator">!</span><span class="java_plain">pkg</span><span class="java_separator">.</span><span class="java_plain">isAnnotationPresent</span><span class="java_separator">(</span><span class="java_type">Named</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;wrapped&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NamedLiteral</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Named</span><span class="java_operator">&gt;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Named</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;value</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Package</span><span class="java_plain">&nbsp;pkg&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getJavaClass</span><span class="java_separator">().</span><span class="java_plain">getPackage</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;unqualifiedName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">at</span><span class="java_separator">.</span><span class="java_plain">isAnnotationPresent</span><span class="java_separator">(</span><span class="java_type">Named</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">))</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unqualifiedName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getAnnotation</span><span class="java_separator">(</span><span class="java_type">Named</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">unqualifiedName</span><span class="java_separator">.</span><span class="java_plain">isEmpty</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unqualifiedName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Introspector</span><span class="java_separator">.</span><span class="java_plain">decapitalize</span><span class="java_separator">(</span><span class="java_plain">at</span><span class="java_separator">.</span><span class="java_plain">getJavaClass</span><span class="java_separator">().</span><span class="java_plain">getSimpleName</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;qualifiedName</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;pkg</span><span class="java_separator">.</span><span class="java_plain">isAnnotationPresent</span><span class="java_separator">(</span><span class="java_type">Named</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qualifiedName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;pkg</span><span class="java_separator">.</span><span class="java_plain">getAnnotation</span><span class="java_separator">(</span><span class="java_type">Named</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">value</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">'.'</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;unqualifiedName</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qualifiedName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;unqualifiedName</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;qualifiedName</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">NamedLiteral</span><span class="java_plain">&nbsp;namedLiteral&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">NamedLiteral</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AnnotatedConstructor</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;getConstructors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getConstructors</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AnnotatedField</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">super</span><span class="java_plain">&nbsp;X</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;getFields</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getFields</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getJavaClass</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getJavaClass</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AnnotatedMethod</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">super</span><span class="java_plain">&nbsp;X</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;getMethods</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getMethods</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;T&nbsp;getAnnotation</span><span class="java_separator">(</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annType</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Named</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">annType</span><span class="java_separator">))</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">T</span><span class="java_separator">)</span><span class="java_plain">&nbsp;namedLiteral</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getAnnotation</span><span class="java_separator">(</span><span class="java_plain">annType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getAnnotations</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;original&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getAnnotations</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotations&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;hasNamed&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Annotation</span><span class="java_plain">&nbsp;annotation&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;original</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_plain">annotationType</span><span class="java_separator">().</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_type">Named</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">))</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotations</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">getAnnotation</span><span class="java_separator">(</span><span class="java_type">Named</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hasNamed&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotations</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">annotation</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_operator">!</span><span class="java_plain">hasNamed</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Package</span><span class="java_plain">&nbsp;pkg&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getJavaClass</span><span class="java_separator">().</span><span class="java_plain">getPackage</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">pkg</span><span class="java_separator">.</span><span class="java_plain">isAnnotationPresent</span><span class="java_separator">(</span><span class="java_type">Named</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">))</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotations</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">getAnnotation</span><span class="java_separator">(</span><span class="java_type">Named</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;annotations</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Type</span><span class="java_plain">&nbsp;getBaseType</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getBaseType</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Type</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getTypeClosure</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getTypeClosure</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isAnnotationPresent</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annType</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Named</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">annType</span><span class="java_separator">))</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">isAnnotationPresent</span><span class="java_separator">(</span><span class="java_plain">annType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pat</span><span class="java_separator">.</span><span class="java_plain">setAnnotatedType</span><span class="java_separator">(</span><span class="java_plain">wrapped</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Here’s a second example, which adds the <code class="literal">@Alternative</code> annotation to any
class which implements a certain <code class="literal">Service</code> interface.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">spi</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Extension</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Annotation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ServiceAlternativeExtension</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Extension</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Service</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;processAnnotatedType</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_plain">&nbsp;</span><span class="java_type">ProcessAnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;pat</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;type&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;pat</span><span class="java_separator">.</span><span class="java_plain">getAnnotatedType</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;if&nbsp;the&nbsp;class&nbsp;implements&nbsp;Service,&nbsp;make&nbsp;it&nbsp;an&nbsp;@Alternative&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;wrapped&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AlternativeLiteral</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">AnnotationLiteral</span><span class="java_operator">&lt;</span><span class="java_type">Alternative</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Alternative</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">AlternativeLiteral</span><span class="java_plain">&nbsp;alternativeLiteral&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AlternativeLiteral</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">X&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;X&nbsp;getAnnotation</span><span class="java_separator">(</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annType</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">X</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">annType</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_type">Alternative</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;&nbsp;alternativeLiteral&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;type</span><span class="java_separator">.</span><span class="java_plain">getAnnotation</span><span class="java_separator">(</span><span class="java_plain">annType</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getAnnotations</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotations&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_separator">(</span><span class="java_plain">type</span><span class="java_separator">.</span><span class="java_plain">getAnnotations</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotations</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">alternativeLiteral</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;annotations</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isAnnotationPresent</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotationType</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;annotationType</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_type">Alternative</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;type</span><span class="java_separator">.</span><span class="java_plain">isAnnotationPresent</span><span class="java_separator">(</span><span class="java_plain">annotationType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;remaining&nbsp;methods&nbsp;of&nbsp;AnnotatedType&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pat</span><span class="java_separator">.</span><span class="java_plain">setAnnotatedType</span><span class="java_separator">(</span><span class="java_plain">wrapped</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The <code class="literal">AnnotatedType</code> is not the only thing that can be wrapped by an
extension.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_overriding_attributes_of_a_bean_by_wrapping_literal_beanattributes_literal"/>16.9. Overriding attributes of a bean by wrapping <code class="literal">BeanAttributes</code></h2></div></div></div>

<p>Wrapping an <code class="literal">AnnotatedType</code> is a low-level approach to overriding CDI
metadata by adding, removing or replacing annotations. Since version
1.1, CDI provides a higher-level facility for overriding attributes of
beans discovered by the CDI container.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BeanAttributes</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Type</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getTypes</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getQualifiers</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getScope</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;getStereotypes</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isAlternative</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The <code class="literal">BeanAttributes</code> interface exposes attributes of a bean. The
container fires a <code class="literal">ProcessBeanAttributes</code> event for each enabled bean,
interceptor and decorator before this object is registered. Similarly to
the <code class="literal">ProcessAnnotatedType</code>, this event allows an extension to modify
attributes of a bean or to veto the bean entirely.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ProcessBeanAttributes</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotated</span><span class="java_plain">&nbsp;getAnnotated</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BeanAttributes</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getBeanAttributes</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setBeanAttributes</span><span class="java_separator">(</span><span class="java_type">BeanAttributes</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;beanAttributes</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;addDefinitionError</span><span class="java_separator">(</span><span class="java_type">Throwable</span><span class="java_plain">&nbsp;t</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;veto</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The <code class="literal">BeanManager</code> provides two utility methods for creating the
<code class="literal">BeanAttributes</code> object from scratch:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BeanAttributes</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;createBeanAttributes</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">AnnotatedType</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;type</span><!-- <br/> --><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BeanAttributes</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;createBeanAttributes</span><span class="java_separator">(</span><span class="java_type">AnnotatedMember</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;type</span><span class="java_separator">);</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_wrapping_an_literal_injectiontarget_literal"/>16.10. Wrapping an <code class="literal">InjectionTarget</code></h2></div></div></div>

<p>The <code class="literal">InjectionTarget</code> interface exposes operations for producing and
disposing an instance of a component, injecting its dependencies and
invoking its lifecycle callbacks. A portable extension may wrap the
<code class="literal">InjectionTarget</code> for any Java EE component that supports injection,
allowing it to intercept any of these operations when they are invoked
by the container.</p>
<p>Here’s a CDI portable extension that reads values from properties files
and configures fields of Java EE components, including servlets, EJBs,
managed beans, interceptors and more. In this example, properties for a
class such as <code class="literal">org.mydomain.blog.Blogger</code> go in a resource named
<code class="literal">org/mydomain/blog/Blogger.properties</code>, and the name of a property must
match the name of the field to be configured. So <code class="literal">Blogger.properties</code>
could contain:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">firstName</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_type">Gavin</span>
<!--  --><br/><span class="java_plain">lastName</span><span class="java_operator">=</span><span class="java_type">King</span></pre>

<p>The portable extension works by wrapping the containers
<code class="literal">InjectionTarget</code> and setting field values from the <code class="literal">inject()</code> method.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">event</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Observes</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">enterprise</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">.</span><span class="java_plain">spi</span><span class="java_separator">.</span><span class="java_type">Extension</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">enterprise</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">.</span><span class="java_plain">spi</span><span class="java_separator">.</span><span class="java_type">InjectionPoint</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ConfigExtension</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Extension</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;processInjectionTarget</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_plain">&nbsp;</span><span class="java_type">ProcessInjectionTarget</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;pit</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;wrap&nbsp;this&nbsp;to&nbsp;intercept&nbsp;the&nbsp;component&nbsp;lifecycle&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">InjectionTarget</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;it&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;pit</span><span class="java_separator">.</span><span class="java_plain">getInjectionTarget</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">Field</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;configuredValues&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">Field</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;use&nbsp;this&nbsp;to&nbsp;read&nbsp;annotations&nbsp;of&nbsp;the&nbsp;class&nbsp;and&nbsp;its&nbsp;members&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;at&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;pit</span><span class="java_separator">.</span><span class="java_plain">getAnnotatedType</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;read&nbsp;the&nbsp;properties&nbsp;file&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;propsFileName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getJavaClass</span><span class="java_separator">().</span><span class="java_plain">getSimpleName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;.properties&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">InputStream</span><span class="java_plain">&nbsp;stream&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getJavaClass</span><span class="java_separator">().</span><span class="java_plain">getResourceAsStream</span><span class="java_separator">(</span><span class="java_plain">propsFileName</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">stream</span><span class="java_operator">!=</span><span class="java_literal">null</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Properties</span><span class="java_plain">&nbsp;props&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Properties</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;props</span><span class="java_separator">.</span><span class="java_plain">load</span><span class="java_separator">(</span><span class="java_plain">stream</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_separator">.</span><span class="java_type">Entry</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;property&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;props</span><span class="java_separator">.</span><span class="java_plain">entrySet</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fieldName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;property</span><span class="java_separator">.</span><span class="java_plain">getKey</span><span class="java_separator">().</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;property</span><span class="java_separator">.</span><span class="java_plain">getValue</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Field</span><span class="java_plain">&nbsp;field&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;at</span><span class="java_separator">.</span><span class="java_plain">getJavaClass</span><span class="java_separator">().</span><span class="java_plain">getDeclaredField</span><span class="java_separator">(</span><span class="java_plain">fieldName</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field</span><span class="java_separator">.</span><span class="java_plain">setAccessible</span><span class="java_separator">(</span><span class="java_literal">true</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;field</span><span class="java_separator">.</span><span class="java_plain">getType</span><span class="java_separator">().</span><span class="java_plain">isAssignableFrom</span><span class="java_separator">(</span><span class="java_plain">&nbsp;value</span><span class="java_separator">.</span><span class="java_plain">getClass</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;configuredValues</span><span class="java_separator">.</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">field</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;TODO:&nbsp;do&nbsp;type&nbsp;conversion&nbsp;automatically&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pit</span><span class="java_separator">.</span><span class="java_plain">addDefinitionError</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">InjectionException</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;field&nbsp;is&nbsp;not&nbsp;of&nbsp;type&nbsp;String:&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;field&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">NoSuchFieldException</span><span class="java_plain">&nbsp;nsfe</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pit</span><span class="java_separator">.</span><span class="java_plain">addDefinitionError</span><span class="java_separator">(</span><span class="java_plain">nsfe</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">finally</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stream</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">IOException</span><span class="java_plain">&nbsp;ioe</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pit</span><span class="java_separator">.</span><span class="java_plain">addDefinitionError</span><span class="java_separator">(</span><span class="java_plain">ioe</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">InjectionTarget</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;wrapped&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">InjectionTarget</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;inject</span><span class="java_separator">(</span><span class="java_plain">X&nbsp;instance</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CreationalContext</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;set&nbsp;the&nbsp;values&nbsp;onto&nbsp;the&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;component&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_separator">.</span><span class="java_type">Entry</span><span class="java_operator">&lt;</span><span class="java_type">Field</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;configuredValue</span><span class="java_operator">:</span><span class="java_plain">&nbsp;configuredValues</span><span class="java_separator">.</span><span class="java_plain">entrySet</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;configuredValue</span><span class="java_separator">.</span><span class="java_plain">getKey</span><span class="java_separator">().</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">,</span><span class="java_plain">&nbsp;configuredValue</span><span class="java_separator">.</span><span class="java_plain">getValue</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">InjectionException</span><span class="java_separator">(</span><span class="java_plain">e</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;postConstruct</span><span class="java_separator">(</span><span class="java_plain">X&nbsp;instance</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">postConstruct</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;preDestroy</span><span class="java_separator">(</span><span class="java_plain">X&nbsp;instance</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">dispose</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;dispose</span><span class="java_separator">(</span><span class="java_plain">X&nbsp;instance</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">dispose</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">InjectionPoint</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getInjectionPoints</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">getInjectionPoints</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;X&nbsp;produce</span><span class="java_separator">(</span><span class="java_type">CreationalContext</span><span class="java_operator">&lt;</span><span class="java_plain">X</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">produce</span><span class="java_separator">(</span><span class="java_plain">ctx</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pit</span><span class="java_separator">.</span><span class="java_plain">setInjectionTarget</span><span class="java_separator">(</span><span class="java_plain">wrapped</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_overriding_literal_injectionpoint_literal"/>16.11. Overriding <code class="literal">InjectionPoint</code></h2></div></div></div>

<p>CDI provides a way to override the metadata of an <code class="literal">InjectionPoint</code>. This
works similarly to how metadata of a bean may be overridden using
<code class="literal">BeanAttributes</code>.</p>
<p>For every injection point of each component supporting injection Weld
fires an event of type
<code class="literal">javax.enterprise.inject.spi.ProcessInjectionPoint</code></p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ProcessInjectionPoint</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">InjectionPoint</span><span class="java_plain">&nbsp;getInjectionPoint</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setInjectionPoint</span><span class="java_separator">(</span><span class="java_type">InjectionPoint</span><span class="java_plain">&nbsp;injectionPoint</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;addDefinitionError</span><span class="java_separator">(</span><span class="java_type">Throwable</span><span class="java_plain">&nbsp;t</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>An extension may either completely override the injection point metadata
or alter it by wrapping the <code class="literal">InjectionPoint</code> object obtained from
<code class="literal">ProcessInjectionPoint.getInjectionPoint()</code></p>
<p>There’s a lot more to the portable extension SPI than what we’ve
discussed here. Check out the CDI spec or Javadoc for more information.
For now, we’ll just mention one more extension point.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_manipulating_interceptors_decorators_and_alternatives_enabled_for_an_application"/>16.12. Manipulating interceptors, decorators and alternatives enabled for an application</h2></div></div></div>

<p>An event of type <code class="literal">javax.enterprise.inject.spi.AfterTypeDiscovery</code> is
fired when the container has fully completed the type discovery process
and before it begins the bean discovery process.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">AfterTypeDiscovery</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;&gt;</span><span class="java_plain">&nbsp;getAlternatives</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;&gt;</span><span class="java_plain">&nbsp;getInterceptors</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;&gt;</span><span class="java_plain">&nbsp;getDecorators</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;addAnnotatedType</span><span class="java_separator">(</span><span class="java_type">AnnotatedType</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;type</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>This event exposes a list of enabled alternatives, interceptors and
decorators. Extensions may manipulate these collections directly to add,
remove or change the order of the enabled records.</p>
<p>In addition, an <code class="literal">AnnotatedType</code> can be added to the types which will be
scanned during bean discovery, with an identifier, which allows multiple
annotated types, based on the same underlying type, to be defined.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_literal_context_literal_and_literal_alterablecontext_literal_interfaces"/>16.13. The <code class="literal">Context</code> and <code class="literal">AlterableContext</code> interfaces</h2></div></div></div>

<p>The <code class="literal">Context</code> and <code class="literal">AlterableContext</code> interface support addition of new
scopes to CDI, or extension of the built-in scopes to new environments.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Context</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getScope</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;T&nbsp;get</span><span class="java_separator">(</span><span class="java_type">Contextual</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;contextual</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CreationalContext</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;creationalContext</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;T&nbsp;get</span><span class="java_separator">(</span><span class="java_type">Contextual</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;contextual</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isActive</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>For example, we might implement <code class="literal">Context</code> to add a business process
scope to CDI, or to add support for the conversation scope to an
application that uses Wicket.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">enterprise</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">context</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">spi</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Context</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">AlterableContext</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Context</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;destroy</span><span class="java_separator">(</span><span class="java_type">Contextual</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;contextual</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p><code class="literal">AlterableContext</code> was introduced in CDI 1.1. The <code class="literal">destroy</code> method
allows an application to remove instances of contextual objects from a
context.</p>
<p>For more information on implementing a custom context see this
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://in.relation.to/Bloggers/CreatingACustomScope">blog post</a>.</p>
</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_next_steps"/>Chapter 17. Next steps</h2></div></div></div>

<p>A lot of additional information on CDI can be found online. Regardless,
the CDI specification remains the authority for information on CDI. The
spec is less than 100 pages and is quite readable (don’t worry, it’s not
like your Blu-ray player manual). Of course, it covers many details
we’ve skipped over here. The spec is available on the at the JCP website
(<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://jcp.org/en/jsr/detail?id=299">CDI 1.0</a>)
(<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://jcp.org/en/jsr/detail?id=346">CDI 1.1</a>).</p>
<p>The CDI reference implementation, Weld, is being developed by the
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://github.com/weld/core/graphs/contributors">Weld team</a>. The team
and the CDI spec lead blog at <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://in.relation.to">in.relation.to</a>.
This guide was originally based on a series of blog entries published
there while the specification was being developed. It’s probably the
best source of information about the future of CDI and Weld.</p>
<p>We encourage you to follow the
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://lists.jboss.org/mailman/listinfo/weld-dev">weld-dev</a> mailing list
and to get involved in <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://weld.cdi-spec.org/community/">development</a>.
If you are reading this guide, you likely have something to offer.</p>
</div>
</div>
<div class="part" lang="en-US"><div class="titlepage"><div><div><h1 class="title"><a id="_weld_reference_guide"/>Part V. Weld Reference Guide</h1></div></div></div>

<div class="partintro" lang="en-US"><div/>
<p>Weld is the reference implementation of CDI, and is used by WildFly,
GlassFish and WebLogic to provide CDI services for Java Enterprise
Edition (Java EE) applications. Weld also goes beyond the environments
and APIs defined by the CDI specification by providing support for a
number of other environments (such as a servlet container such as
Tomcat, or Java SE).</p>
<p>You might also want to check out
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://deltaspike.apache.org/">DeltaSpike</a> project which provides
portable extensions to CDI.</p>
<p>If you want to get started quickly using Weld (and, in turn, CDI) with
WildFly, GlassFish or Tomcat and experiment with one of the examples,
take a look at <a href="#_getting_started_with_weld" title="Chapter 6. Getting started with Weld">Chapter 6, <i xmlns:xlink="http://www.w3.org/1999/xlink">Getting started with Weld</i></a>. Otherwise read on for a
exhaustive discussion of using Weld in all the environments and application
servers it supports and the Weld extensions.</p>
<div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#_application_servers_and_environments_supported_by_weld">18. Application servers and environments supported by Weld</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_weld_with_wildfly">18.1. Using Weld with WildFly</a></span></dt><dt><span class="section"><a href="#_glassfish">18.2. GlassFish</a></span></dt><dt><span class="section"><a href="#_servlet_containers_such_as_tomcat_or_jetty">18.3. Servlet containers (such as Tomcat or Jetty)</a></span></dt><dd><dl><dt><span class="section"><a href="#_tomcat">18.3.1. Tomcat</a></span></dt><dt><span class="section"><a href="#_jetty">18.3.2. Jetty</a></span></dt><dt><span class="section"><a href="#_bean_archive_isolation">18.3.3. Bean Archive Isolation</a></span></dt><dt><span class="section"><a href="#_implicit_bean_archive_support">18.3.4. Implicit Bean Archive Support</a></span></dt></dl></dd><dt><span class="section"><a href="#_java_se">18.4. Java SE</a></span></dt><dd><dl><dt><span class="section"><a href="#_cdi_se_module">18.4.1. CDI SE Module</a></span></dt><dt><span class="section"><a href="#_bootstrapping_cdi_se">18.4.2. Bootstrapping CDI SE</a></span></dt><dt><span class="section"><a href="#_thread_context">18.4.3. Thread Context</a></span></dt><dt><span class="section"><a href="#_setting_the_classpath">18.4.4. Setting the Classpath</a></span></dt><dt><span class="section"><a href="#_bean_archive_isolation_2">18.4.5. Bean Archive Isolation</a></span></dt><dt><span class="section"><a href="#_implicit_bean_archive_support_2">18.4.6. Implicit Bean Archive Support</a></span></dt></dl></dd><dt><span class="section"><a href="#_osgi">18.5. OSGi</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_context_management">19. Context Management</a></span></dt><dd><dl><dt><span class="section"><a href="#_managing_the_built_in_contexts">19.1. Managing the built in contexts</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_configuration">20. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#_excluding_classes_from_scanning_and_deployment">20.1. Excluding classes from scanning and deployment</a></span></dt><dt><span class="section"><a href="#_concurrent_deployment_configuration">20.2. Concurrent deployment configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#_thread_pool_configuration">20.2.1. Thread pool configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#_non_portable_mode_during_application_initialization">20.3. Non-portable mode during application initialization</a></span></dt><dt><span class="section"><a href="#_mapping_cdi_contexts_to_http_requests">20.4. Mapping CDI contexts to HTTP requests</a></span></dt><dt><span class="section"><a href="#_bounding_the_cache_size_for_resolved_injection_points">20.5. Bounding the cache size for resolved injection points</a></span></dt></dl></dd><dt><span class="appendix"><a href="#_integrating_weld_into_other_environments">A. Integrating Weld into other environments</a></span></dt><dd><dl><dt><span class="section"><a href="#_the_weld_spi">A.1. The Weld SPI</a></span></dt><dd><dl><dt><span class="section"><a href="#_deployment_structure">A.1.1. Deployment structure</a></span></dt><dt><span class="section"><a href="#_ejb_descriptors">A.1.2. EJB descriptors</a></span></dt><dt><span class="section"><a href="#_ee_resource_injection_and_resolution_services">A.1.3. EE resource injection and resolution services</a></span></dt><dt><span class="section"><a href="#_ejb_services">A.1.4. EJB services</a></span></dt><dt><span class="section"><a href="#_jpa_services">A.1.5. JPA services</a></span></dt><dt><span class="section"><a href="#_transaction_services">A.1.6. Transaction Services</a></span></dt><dt><span class="section"><a href="#_resource_services">A.1.7. Resource Services</a></span></dt><dt><span class="section"><a href="#_web_service_injection_services">A.1.8. Web Service Injection Services</a></span></dt><dt><span class="section"><a href="#_injection_services">A.1.9. Injection Services</a></span></dt><dt><span class="section"><a href="#_security_services">A.1.10. Security Services</a></span></dt><dt><span class="section"><a href="#_the_bean_store">A.1.11. The bean store</a></span></dt><dt><span class="section"><a href="#_the_application_context">A.1.12. The application context</a></span></dt><dt><span class="section"><a href="#_initialization_and_shutdown">A.1.13. Initialization and shutdown</a></span></dt><dt><span class="section"><a href="#_resource_loading">A.1.14. Resource loading</a></span></dt><dt><span class="section"><a href="#_annotationdiscovery">A.1.15. AnnotationDiscovery</a></span></dt><dt><span class="section"><a href="#_classfileservices">A.1.16. ClassFileServices</a></span></dt></dl></dd><dt><span class="section"><a href="#_the_contract_with_the_container">A.2. The contract with the container</a></span></dt><dd><dl><dt><span class="section"><a href="#_classloader_isolation">A.2.1. Classloader isolation</a></span></dt><dt><span class="section"><a href="#_servlet">A.2.2. Servlet</a></span></dt><dt><span class="section"><a href="#_cdi_conversation_filter_2">A.2.3. CDI Conversation Filter</a></span></dt><dt><span class="section"><a href="#_jsf">A.2.4. JSF</a></span></dt><dt><span class="section"><a href="#_jsp">A.2.5. JSP</a></span></dt><dt><span class="section"><a href="#_session_bean_interceptor">A.2.6. Session Bean Interceptor</a></span></dt><dt><span class="section"><a href="#_the_literal_weld_core_jar_literal">A.2.7. The <code class="literal">weld-core.jar</code></a></span></dt><dt><span class="section"><a href="#_binding_the_manager_in_jndi">A.2.8. Binding the manager in JNDI</a></span></dt><dt><span class="section"><a href="#__literal_cdiprovider_literal">A.2.9. <code class="literal">CDIProvider</code></a></span></dt><dt><span class="section"><a href="#_performing_cdi_injection_on_java_ee_component_classes">A.2.10. Performing CDI injection on Java EE component classes</a></span></dt></dl></dd><dt><span class="section"><a href="#_migration_notes">A.3. Migration notes</a></span></dt><dd><dl><dt><span class="section"><a href="#_migration_from_weld_1_x_to_2_0">A.3.1. Migration from Weld 1.x to 2.0</a></span></dt><dt><span class="section"><a href="#_migration_from_weld_2_0_to_2_1">A.3.2. Migration from Weld 2.0 to 2.1</a></span></dt><dt><span class="section"><a href="#_migration_from_weld_2_1_to_2_2">A.3.3. Migration from Weld 2.1 to 2.2</a></span></dt></dl></dd></dl></dd></dl></div></div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_application_servers_and_environments_supported_by_weld"/>Chapter 18. Application servers and environments supported by Weld</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_using_weld_with_wildfly">18.1. Using Weld with WildFly</a></span></dt><dt><span class="section"><a href="#_glassfish">18.2. GlassFish</a></span></dt><dt><span class="section"><a href="#_servlet_containers_such_as_tomcat_or_jetty">18.3. Servlet containers (such as Tomcat or Jetty)</a></span></dt><dd><dl><dt><span class="section"><a href="#_tomcat">18.3.1. Tomcat</a></span></dt><dt><span class="section"><a href="#_jetty">18.3.2. Jetty</a></span></dt><dt><span class="section"><a href="#_bean_archive_isolation">18.3.3. Bean Archive Isolation</a></span></dt><dt><span class="section"><a href="#_implicit_bean_archive_support">18.3.4. Implicit Bean Archive Support</a></span></dt></dl></dd><dt><span class="section"><a href="#_java_se">18.4. Java SE</a></span></dt><dd><dl><dt><span class="section"><a href="#_cdi_se_module">18.4.1. CDI SE Module</a></span></dt><dt><span class="section"><a href="#_bootstrapping_cdi_se">18.4.2. Bootstrapping CDI SE</a></span></dt><dt><span class="section"><a href="#_thread_context">18.4.3. Thread Context</a></span></dt><dt><span class="section"><a href="#_setting_the_classpath">18.4.4. Setting the Classpath</a></span></dt><dt><span class="section"><a href="#_bean_archive_isolation_2">18.4.5. Bean Archive Isolation</a></span></dt><dt><span class="section"><a href="#_implicit_bean_archive_support_2">18.4.6. Implicit Bean Archive Support</a></span></dt></dl></dd><dt><span class="section"><a href="#_osgi">18.5. OSGi</a></span></dt></dl></div>

<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_weld_with_wildfly"/>18.1. Using Weld with WildFly</h2></div></div></div>

<p>If you are using WildFly 8.0 or better, no additional configuration is
required to use Weld (or CDI for that matter).</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_glassfish"/>18.2. GlassFish</h2></div></div></div>

<p>Weld is also built into GlassFish from V3 onwards. Since GlassFish V3 is
the Java EE 6 reference implementation, it must support all features of
CDI. What better way for GlassFish to support these features than to use
Weld, the CDI reference implementation? Just package up your CDI
application and deploy.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_servlet_containers_such_as_tomcat_or_jetty"/>18.3. Servlet containers (such as Tomcat or Jetty)</h2></div></div></div>

<p>While CDI does not require support for servlet environments, Weld can be
used in a servlet container, such as Tomcat or Jetty.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>There is a major limitation to using a servlet container. Weld doesn’t
support deploying session beans, injection using <code class="literal">@EJB</code>
or`@PersistenceContext`, or using transactional events in servlet
containers. For enterprise features such as these, you should really be
looking at a Java EE application server.</p>
</div>

<p>Weld can be used as a library in an web application that is deployed to
a Servlet container. You should place <code class="literal">weld-servlet.jar</code> within the
<code class="literal">WEB-INF/lib</code> directory relative to the web root. <code class="literal">weld-servlet.jar</code> is
an "uber-jar", meaning it bundles all the bits of Weld and CDI required
for running in a Servlet container, for your convenience. Alternatively,
you can use its component jars. A list of transitive dependencies can be
found in the <code class="literal">META-INF/DEPENDENCIES.txt</code> file inside the
<code class="literal">weld-servlet.jar</code> artifact.</p>
<p>You also need to explicitly specify the servlet listener (used to boot
Weld, and control its interaction with requests) in WEB-INF/web.xml in
the web root:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.weld.environment.servlet.Listener</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">listener-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">listener</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>Actually, you don’t have to register this listener in Servlet 3.x
compliant containers which support
<code class="literal">javax.servlet.ServletContainerInitializer</code> service properly (e.g.
Tomcat 7.0.50). In this case
<code class="literal">org.jboss.weld.environment.servlet.EnhancedListener</code> will do all the
necessary work automatically, and what is more important - injection
into Listeners will work on some containers as well (see <a href="#_tomcat" title="18.3.1. Tomcat">Section 18.3.1, “Tomcat”</a> and <a href="#_jetty" title="18.3.2. Jetty">Section 18.3.2, “Jetty”</a> for
more info).</p>
<p>The downside of <code class="literal">javax.servlet.ServletContainerInitializer</code> approach is
that the Weld listener will be added to the end of the ordered list of
discovered listeners. In practice the request and session context will
not be active during <code class="literal">ServletRequestListener</code> and <code class="literal">HttpSessionListener</code>
notifications. Fortunately, it’s possible to combine the
<code class="literal">EnhancedListener</code> and the old <code class="literal">Listener</code> to fix this problem - simply
add the old <code class="literal">Listener</code> to the <code class="literal">web.xml</code> as mentioned above. Note that it
must be defined before the listeners using request and session context.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>There is quite a special use-case where one more special component must
be involved. If you want the session context to be active during
<code class="literal">HttpSessionListener.sessionDestroyed()</code> invocation when the session
times out or when all the sessions are destroyed because the deployment
is being removed then <code class="literal">org.jboss.weld.servlet.WeldTerminalListener</code> must
be specified as the last one in your <code class="literal">web.xml</code>. This listener activates
the session context before other listeners are invoked (note that the
listeners are notified in reverse order when a session is being
destroyed).</p>
</div>

<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_tomcat"/>18.3.1. Tomcat</h3></div></div></div>

<p>Since version 2.2.0.Final only Tomcat 7 and 8 are supported.</p>
<p>Tomcat has a read-only JNDI, so Weld can’t automatically bind the
BeanManager extension SPI. To bind the BeanManager into JNDI, you should
populate <code class="literal">META-INF/context.xml</code> in the web root with the following
contents:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Context</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;BeanManager&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">auth</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Container&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.enterprise.inject.spi.BeanManager&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">factory</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.weld.resources.ManagerObjectFactory&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">Context</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>and make it available to your deployment by adding this to the bottom
of <code class="literal">web.xml</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource-env-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource-env-ref-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">BeanManager</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">resource-env-ref-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource-env-ref-type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;javax.enterprise.inject.spi.BeanManager</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">resource-env-ref-type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">resource-env-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>Tomcat only allows you to bind entries to <code class="literal">java:comp/env</code>, so the
BeanManager will be available at <code class="literal">java:comp/env/BeanManager</code></p>
<p>Weld also supports Servlet and Filter injection in Tomcat containers.
Listener injection should also work on Tomcat 7.0.50 and newer versions.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_jetty"/>18.3.2. Jetty</h3></div></div></div>

<p>Since version 2.0.2.Final only Jetty 7, 8 and 9 are supported.</p>
<p>To bind the BeanManager into JNDI, you should either populate
<code class="literal">WEB-INF/jetty-env.xml</code> with the following contents:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_plain">!</span><span class="xml_attribute_name">DOCTYPE</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">Configure</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">PUBLIC</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_value">&quot;-//Mort&nbsp;Bay&nbsp;Consulting//DTD&nbsp;Configure//EN&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_value">&quot;http://www.eclipse.org/jetty/configure.dtd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Configure</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;webAppCtx&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.eclipse.jetty.webapp.WebAppContext&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">New</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;BeanManager&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.eclipse.jetty.plus.jndi.Resource&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Arg</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Ref</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;webAppCtx&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">Arg</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Arg</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">BeanManager</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">Arg</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Arg</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">New</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.naming.Reference&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Arg</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">javax.enterprise.inject.spi.BeanManager</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">Arg</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Arg</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.weld.resources.ManagerObjectFactory</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">Arg</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Arg</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">New</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">Arg</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">New</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">Configure</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>Or you can configure a special Servlet listener to bind the BeanManager
automatically:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.weld.environment.servlet.BeanManagerResourceBindingListener</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">listener-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">listener</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>Just like in Tomcat, you need to make the BeanManager available to your
deployment by adding this to the bottom of <code class="literal">web.xml</code>:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource-env-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource-env-ref-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">BeanManager</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">resource-env-ref-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource-env-ref-type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;javax.enterprise.inject.spi.BeanManager</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">resource-env-ref-type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">resource-env-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>Jetty only allows you to bind entries to <code class="literal">java:comp/env</code>, so the
BeanManager will be available at <code class="literal">java:comp/env/BeanManager</code>.</p>
<p>Since Jetty 8 the class <code class="literal">org.eclipse.jetty.servlet.ServletContextHandler.Decorator</code> is not visible from the web application.
Therefore, one more step is required - we have to tell Jetty not to hide this system class.</p>
<p>Simply place the following <code class="literal">jetty-context.xml</code> file in the WEB-INF dir:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_plain">!</span><span class="xml_attribute_name">DOCTYPE</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">Configure</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">PUBLIC</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_value">&quot;-//Jetty//Configure//EN&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_value">&quot;http://www.eclipse.org/jetty/configure.dtd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Configure</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.eclipse.jetty.webapp.WebAppContext&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Set</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;serverClasses&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Array</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;java.lang.String&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">Item</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">-org.eclipse.jetty.servlet.ServletContextHandler.Decorator</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">Item</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">Array</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">Set</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">Configure</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>See also <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.eclipse.org/jetty/documentation/current/jetty-classloading.html#setting-server-classes">Jetty Classloading documentation</a>.</p>
<p>Weld also supports Servlet and Filter injection in Jetty containers.
Listener injection should also work on Jetty 9.1.1 and newer versions.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_bean_archive_isolation"/>18.3.3. Bean Archive Isolation</h3></div></div></div>

<p>By default, bean archive isolation is enabled. It means that alternatives, interceptors and decorators can be selected/enabled for a bean archive by using a beans.xml descriptor.</p>
<p>This behaviour can be changed by setting the servlet initialization parameter <code class="literal">org.jboss.weld.environment.servlet.archive.isolation</code> to false.
In this case, Weld will use a "flat" deployment structure - all bean classes share the same bean archive and all beans.xml descriptors are automatically merged into one. Thus alternatives, interceptors and decorators selected/enabled for a bean archive will be enabled for the whole application.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Bean archive isolation is supported (and enabled by default) from version 2.2.5.Final. Previous versions only operated with the "flat" deployment structure.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_implicit_bean_archive_support"/>18.3.4. Implicit Bean Archive Support</h3></div></div></div>

<p>CDI 1.1 introduced the bean discovery mode of <code class="literal">annotated</code> used for implicit bean archives (see also <a href="#packaging-and-deployment" title="15.6. Packaging and deployment">Section 15.6, “Packaging and deployment”</a>).
This mode may bring additional overhead during container bootstrap. Therefore, Weld Servlet supports the use of <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://github.com/wildfly/jandex">Jandex</a> bytecode scanning library to speed up the scanning process. Simply put the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://search.maven.org/#search|gav|1|g%3A%22org.jboss%22%20AND%20a%3A%22jandex%22">jandex.jar</a> on the classpath.
If Jandex is not found on the classpath Weld will use the Java Reflection as a fallback.</p>
<p>In general, an implicit bean archive does not have to contain a beans.xml descriptor. However, such a bean archive is not supported by Weld Servlet, i.e. it’s excluded from discovery.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The bean discovery mode of <code class="literal">annotated</code> is supported from version 2.2.5.Final. Previous versions processed implicit bean archives in the same way as explicit bean archives.</p>
</div>

</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_java_se"/>18.4. Java SE</h2></div></div></div>

<p>In addition to improved integration of the Enterprise Java stack, the
"Contexts and Dependency Injection for the Java EE platform"
specification also defines a state of the art typesafe, stateful
dependency injection framework, which can prove useful in a wide range
of application types. To help developers take advantage of this, Weld
provides a simple means for being executed in the Java Standard Edition
(SE) environment independently of any Java EE APIs.</p>
<p>When executing in the SE environment the following features of Weld are
available:</p>
<div class="itemizedlist"><ul><li>
Managed beans with <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code> lifecycle
callbacks
</li><li>
Dependency injection with qualifiers and alternatives
</li><li>
<code class="literal">@Application</code>, <code class="literal">@Dependent</code> and <code class="literal">@Singleton</code> scopes
</li><li>
Interceptors and decorators
</li><li>
Stereotypes
</li><li>
Events
</li><li>
Portable extension support
</li></ul></div>

<p>EJB beans are not supported.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_cdi_se_module"/>18.4.1. CDI SE Module</h3></div></div></div>

<p>Weld provides an extension which will boot a CDI bean manager in Java
SE, automatically registering all simple beans found on the classpath.
The command line parameters can be injected using either of the
following:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Parameters</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">List</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">String</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;params</span><!-- <br/> --><span class="java_separator">;</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Parameters</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">String</span><!-- <br/> --><span class="java_separator">[]</span><!-- <br/> --><span class="java_plain">&nbsp;paramsArray</span><!-- <br/> --><span class="java_separator">;</span></pre>

<p>The second form is useful for compatibility with existing classes.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The command line parameters do not become available for injection until
the <code class="literal">ContainerInitialized</code> event is fired. If you need access to the
parameters during initialization you can do so via the
<code class="literal">public static String[] getParameters()</code> method in <code class="literal">StartMain</code>.</p>
</div>

<p>Here’s an example of a simple CDI SE application:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;javax</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">inject</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Singleton</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Singleton</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">HelloWorld</span>
<!--  --><br/><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;printHello</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Observes</span><span class="java_plain">&nbsp;</span><span class="java_type">ContainerInitialized</span><span class="java_plain">&nbsp;event</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">Parameters</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_literal">&quot;Hello&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_bootstrapping_cdi_se"/>18.4.2. Bootstrapping CDI SE</h3></div></div></div>

<p>CDI SE applications can be bootstrapped in the following ways.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_the_literal_containerinitialized_literal_event"/>18.4.2.1. The <code class="literal">ContainerInitialized</code> Event</h4></div></div></div>

<p>Thanks to the power of CDI’s typesafe event model, application
developers need not write any bootstrapping code. The Weld SE module
comes with a built-in main method which will bootstrap CDI for you and
then fire a <code class="literal">ContainerInitialized</code> event. The entry point for your
application code would therefore be a simple bean which observes the
<code class="literal">ContainerInitialized</code> event, as in the previous example.</p>
<p>In this case your application can be started by calling the provided
main method like so:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">java&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">jboss</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">weld</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">environment</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">se</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">StartMain</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">args</span><!-- <br/> --><span class="java_operator">&gt;</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_programmatic_bootstrap_api"/>18.4.2.2. Programmatic Bootstrap API</h4></div></div></div>

<p>For added flexibility, CDI SE also comes with a bootstrap API which can
be called from within your application in order to initialize CDI and
obtain references to your application’s beans and events. The API
consists of two classes: <code class="literal">Weld</code> and <code class="literal">WeldContainer</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Weld</span>
<!--  --><br/><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**&nbsp;Boots&nbsp;Weld&nbsp;and&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;WeldContainer&nbsp;instance,&nbsp;through&nbsp;which</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;beans&nbsp;and&nbsp;events&nbsp;can&nbsp;be&nbsp;accesed.&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">WeldContainer</span><span class="java_plain">&nbsp;initialize</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**&nbsp;Convenience&nbsp;method&nbsp;for&nbsp;shutting&nbsp;down&nbsp;the&nbsp;container.&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;shutdown</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">WeldContainer</span>
<!--  --><br/><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**&nbsp;Provides&nbsp;access&nbsp;to&nbsp;all&nbsp;beans&nbsp;within&nbsp;the&nbsp;application.&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Instance</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;instance</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**&nbsp;Provides&nbsp;access&nbsp;to&nbsp;all&nbsp;events&nbsp;within&nbsp;the&nbsp;application.&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Event</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;event</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**&nbsp;Provides&nbsp;direct&nbsp;access&nbsp;to&nbsp;the&nbsp;BeanManager.&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BeanManager</span><span class="java_plain">&nbsp;getBeanManager</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Here’s an example application main method which uses this API to
initialize a bean of type <code class="literal">MyApplicationBean</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">jboss</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">weld</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">environment</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">se</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Weld</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;main</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;args</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">Weld</span><span class="java_plain">&nbsp;weld&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Weld</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">WeldContainer</span><span class="java_plain">&nbsp;container&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;weld</span><span class="java_separator">.</span><span class="java_plain">initialize</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;container</span><span class="java_separator">.</span><span class="java_plain">instance</span><span class="java_separator">().</span><span class="java_plain">select</span><span class="java_separator">(</span><span class="java_type">MyApplicationBean</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;weld</span><span class="java_separator">.</span><span class="java_plain">shutdown</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Alternatively the application could be started by firing a custom event
which would then be observed by another simple bean. The following
example fires <code class="literal">MyEvent</code> on startup.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">jboss</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">weld</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">environment</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">se</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Weld</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;main</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;args</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">Weld</span><span class="java_plain">&nbsp;weld&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Weld</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">WeldContainer</span><span class="java_plain">&nbsp;container&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;weld</span><span class="java_separator">.</span><span class="java_plain">initialize</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;container</span><span class="java_separator">.</span><span class="java_plain">event</span><span class="java_separator">().</span><span class="java_plain">select</span><span class="java_separator">(</span><span class="java_type">MyEvent</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">fire</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">MyEvent</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;weld</span><span class="java_separator">.</span><span class="java_plain">shutdown</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_thread_context"/>18.4.3. Thread Context</h3></div></div></div>

<p>In contrast to Java EE applications, Java SE applications place no
restrictions on developers regarding the creation and usage of threads.
Therefore Weld SE provides a custom scope annotation, <code class="literal">@ThreadScoped</code>,
and corresponding context implementation which can be used to bind bean
instances to the current thread. It is intended to be used in scenarios
where you might otherwise use <code class="literal">ThreadLocal</code>, and does in fact use
<code class="literal">ThreadLocal</code> under the hood.</p>
<p>To use the <code class="literal">@ThreadScoped</code> annotation you need to enable the
<code class="literal">RunnableDecorator</code> which <span class="emphasis"><em>listens</em></span> for all executions of
<code class="literal">Runnable.run()</code> and decorates them by setting up the thread context
beforehand, bound to the current thread, and destroying the context
afterwards.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">decorators</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.weld.environment.se.threading.RunnableDecorator</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">decorator</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>It is not necessary to use <code class="literal">@ThreadScoped</code> in all multithreaded
applications. The thread context is not intended as a replacement for
defining your own application-specific contexts. It is generally only
useful in situations where you would otherwise have used <code class="literal">ThreadLocal</code>
directly, which are typically rare.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_setting_the_classpath"/>18.4.4. Setting the Classpath</h3></div></div></div>

<p>Weld SE comes packaged as a <span class="emphasis"><em>shaded</em></span> jar which includes the CDI API,
Weld Core and all dependent classes bundled into a single jar. Therefore
the only Weld jar you need on the classpath, in addition to your
application’s classes and dependent jars, is the Weld SE jar. If you are
working with a pure Java SE application you launch using <code class="literal">java</code>, this
may be simpler for you.</p>
<p>If you prefer to work with individual dependencies, then you can use the
<code class="literal">weld-core</code> jar which just contains the Weld SE classes. Of course in
this mode you will need to assemble the classpath yourself.</p>
<p>If you work with a dependency management solution such as Maven you can
declare a dependency such as:</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.weld.se</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">weld-se</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_bean_archive_isolation_2"/>18.4.5. Bean Archive Isolation</h3></div></div></div>

<p>By default, bean archive isolation is enabled. It means that alternatives, interceptors and decorators can be selected/enabled for a bean archive by using a beans.xml descriptor.</p>
<p>This behaviour can be changed by providing a system property <code class="literal">org.jboss.weld.se.archive.isolation</code> with value of <code class="literal">false</code>. In this case, Weld will use a "flat" deployment structure - all bean classes share the same bean archive and all beans.xml descriptors are automatically merged into one. Thus alternatives, interceptors and decorators selected/enabled for a bean archive will be enabled for the whole application.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Bean archive isolation is supported (and enabled by default) from version 2.2.0.Final. Previous versions only operated with the "flat" deployment structure.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_implicit_bean_archive_support_2"/>18.4.6. Implicit Bean Archive Support</h3></div></div></div>

<p>CDI 1.1 introduced the bean discovery mode of <code class="literal">annotated</code> used for implicit bean archives (see also <a href="#packaging-and-deployment" title="15.6. Packaging and deployment">Section 15.6, “Packaging and deployment”</a>). This mode may bring additional overhead during container bootstrap.
Therefore, Weld Servlet supports the use of <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://github.com/wildfly/jandex">Jandex</a> bytecode scanning library to speed up the scanning process. Simply put the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://search.maven.org/#search|gav|1|g%3A%22org.jboss%22%20AND%20a%3A%22jandex%22">jandex.jar</a> on the classpath.
If Jandex is not found on the classpath Weld will use the Java Reflection as a fallback.</p>
<p>In general, an implicit bean archive does not have to contain a beans.xml descriptor. However, such a bean archive is not supported by Weld SE, i.e. it’s excluded from discovery.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The bean discovery mode of <code class="literal">annotated</code> is supported from version 2.2.0.Final. Previous versions processed implicit bean archives in the same way as explicit bean archives.</p>
</div>

</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_osgi"/>18.5. OSGi</h2></div></div></div>

<p>Weld supports OSGi environment through Pax CDI. For more information on
using Weld in OSGi environment check
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://ops4j1.jira.com/wiki/display/PAXCDI/Pax+CDI">Pax CDI
documentation</a> . In addition, Weld comes with a sample application
called Paint which demonstrates how to use CDI with OSGi. Check
<code class="literal">examples/osgi/README.md</code> for more information.</p>
</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_context_management"/>Chapter 19. Context Management</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_managing_the_built_in_contexts">19.1. Managing the built in contexts</a></span></dt></dl></div>

<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_managing_the_built_in_contexts"/>19.1. Managing the built in contexts</h2></div></div></div>

<p>Weld allows you to easily manage the built in contexts by injecting them
and calling lifecycle methods. Weld defines two types of context,
<span class="emphasis"><em>managed</em></span> and <span class="emphasis"><em>unmanaged</em></span>. Managed contexts can be activated (allowing
bean instances to be retrieved from the context), invalidated
(scheduling bean instances for destruction) and deactivated (stopping
bean instances from being retrieved, and if the context has been
invalidated, causing the bean instances to be destroyed). Unmanaged
contexts are always active; some may offer the ability to destroy
instances.</p>
<p>Managed contexts can either be <span class="emphasis"><em>bound</em></span> or <span class="emphasis"><em>unbound</em></span>. An unbound context
is scoped to the thread in which it is activated (instances placed in
the context in one thread are not visible in other threads), and is
destroyed upon invalidation and deactivation. Bound contexts are
attached to some external data store (such as the HTTP Session or a
manually propagated map) by <span class="emphasis"><em>associating</em></span> the data store with the
context before calling activate, and dissociating the data store after
calling activate.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2>
<p>Weld automatically controls context lifecycle in many scenarios such as
HTTP requests, EJB remote invocations, and MDB invocations. Many of the
extensions for CDI offer context lifecycle for other environments, it’s
worth checking to see if there is a suitable extension before deciding
to manage the context yourself.</p>
</div>

<p>Weld provides a number of built in contexts, which are shown in <a href="#_available_contexts_in_weld" title="Table 19.1. Available Contexts in Weld">Table 19.1, “Available Contexts in Weld”</a>.</p>
<div class="table"><a id="_available_contexts_in_weld"/><p class="title"><b>Table 19.1. Available Contexts in Weld</b></p><div class="table-contents">

  
  <table summary="Available Contexts in Weld" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="left" valign="top">Scope</th><th align="left" valign="top">Qualifiers</th><th align="left" valign="top">Context</th><th align="left" valign="top">Notes</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">@Dependent</code></p></td><td align="left" valign="top"><p><code class="literal">@Default</code></p></td><td align="left" valign="top"><p><code class="literal">DependentContext</code></p></td><td align="left" valign="top"><p>The dependent context is
unbound and unmanaged</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">@RequestScoped</code></p></td><td align="left" valign="top"><p><code class="literal">@Unbound</code></p></td><td align="left" valign="top"><p><code class="literal">RequestContext</code></p></td><td align="left" valign="top"><p>An unbound request
context, useful for testing</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">@RequestScoped</code></p></td><td align="left" valign="top"><p><code class="literal">@Bound</code></p></td><td align="left" valign="top"><p><code class="literal">RequestContext</code></p></td><td align="left" valign="top"><p>A request context bound
to a manually propagated map, useful for testing or non-Servlet
environments</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">@Default</code></p></td><td align="left" valign="top"><p><code class="literal">BoundRequestContext</code></p></td><td align="left" valign="top"><p><code class="literal">@RequestScoped</code></p></td><td align="left" valign="top"><p><code class="literal">@Http</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">RequestContext</code></p></td><td align="left" valign="top"><p>A request context bound to
a Servlet request, used for any Servlet based request context</p></td><td align="left" valign="top"><p><code class="literal">@Default</code></p></td><td align="left" valign="top"><p><code class="literal">HttpRequestContext</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">@RequestScoped</code></p></td><td align="left" valign="top"><p><code class="literal">@Ejb</code></p></td><td align="left" valign="top"><p><code class="literal">RequestContext</code></p></td><td align="left" valign="top"><p>A request context bound to
a an interceptor’s invocation context, used for EJB invocations outside
of Servlet requests</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">@Default</code></p></td><td align="left" valign="top"><p><code class="literal">EjbRequestContext</code></p></td><td align="left" valign="top"><p><code class="literal">@ConversationScoped</code></p></td><td align="left" valign="top"><p><code class="literal">@Bound</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ConversationContext</code></p></td><td align="left" valign="top"><p>A conversation
context bound to two manually propagated maps (one which represents the
request and one which represents the session), useful for testing or
non-Servlet environments</p></td><td align="left" valign="top"><p><code class="literal">@Default</code></p></td><td align="left" valign="top"><p><code class="literal">BoundConversationContext</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">@ConversationScoped</code></p></td><td align="left" valign="top"><p><code class="literal">@Http</code></p></td><td align="left" valign="top"><p><code class="literal">ConversationContext</code></p></td><td align="left" valign="top"><p>A conversation
context bound to a Servlet request, used for any Servlet based
conversation context</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">@Default</code></p></td><td align="left" valign="top"><p><code class="literal">HttpConversationContext</code></p></td><td align="left" valign="top"><p><code class="literal">@SessionScoped</code></p></td><td align="left" valign="top"><p><code class="literal">@Bound</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">SessionContext</code></p></td><td align="left" valign="top"><p>A session context bound
to a manually propagated map, useful for testing or non-Servlet
environments</p></td><td align="left" valign="top"><p><code class="literal">@Default</code></p></td><td align="left" valign="top"><p><code class="literal">BoundSessionContext</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">@SessionScoped</code></p></td><td align="left" valign="top"><p><code class="literal">@Http</code></p></td><td align="left" valign="top"><p><code class="literal">SessionContext</code></p></td><td align="left" valign="top"><p>A session context bound to
a Servlet request, used for any Servlet based session context</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">@Default</code></p></td><td align="left" valign="top"><p><code class="literal">HttpSessionContext</code></p></td><td align="left" valign="top"><p><code class="literal">@ApplicationScoped</code></p></td><td align="left" valign="top"><p><code class="literal">@Default</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ApplicationContext</code></p></td><td align="left" valign="top"><p>An application
context backed by an application scoped singleton, it is unmanaged and
unbound but does offer an option to destroy all entries</p></td><td align="left" valign="top"><p><code class="literal">@SingletonScoped</code></p></td><td align="left" valign="top"><p><code class="literal">@Default</code></p></td></tr></tbody></table>
</div></div><br class="table-break"/>

<p>Unmanaged contexts offer little of interest in a discussion about
managing context lifecycles, so from here on in we will concentrate on
the managed contexts (unmanaged contexts of course play a vital role in
the functioning of your application and Weld!). As you can see from the
table above, the managed contexts offer a number of different
implementations for the same scope; in general, each flavor of context
for a scope has the same API. We’ll walk through a number of common
lifecycle management scenarios below; armed with this knowledge, and the
Javadoc, you should be able to work with any of the context
implementations Weld offers.</p>
<p>We’ll start simple with the <code class="literal">BoundRequestContext</code>, which you might use
to provide the request scope outside of a Servlet request or EJB
Invocation.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_comment">/*&nbsp;Inject&nbsp;the&nbsp;BoundRequestContext.&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Alternatively,&nbsp;you&nbsp;could&nbsp;look&nbsp;this&nbsp;up&nbsp;from&nbsp;the&nbsp;BeanManager&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Inject</span><span class="java_plain">&nbsp;</span><span class="java_type">BoundRequestContext</span><span class="java_plain">&nbsp;requestContext</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Start&nbsp;the&nbsp;request,&nbsp;providing&nbsp;a&nbsp;data&nbsp;store&nbsp;which&nbsp;will&nbsp;last&nbsp;the&nbsp;lifetime&nbsp;of&nbsp;the&nbsp;request&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;startRequest</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;requestDataStore</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Associate</span><span class="java_plain">&nbsp;the&nbsp;store&nbsp;with&nbsp;the&nbsp;context&nbsp;and&nbsp;activate&nbsp;the&nbsp;context</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestContext</span><span class="java_separator">.</span><span class="java_plain">associate</span><span class="java_separator">(</span><span class="java_plain">requestDataStore</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestContext</span><span class="java_separator">.</span><span class="java_plain">activate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;End&nbsp;the&nbsp;request,&nbsp;providing&nbsp;the&nbsp;same&nbsp;data&nbsp;store&nbsp;as&nbsp;was&nbsp;used&nbsp;to&nbsp;start&nbsp;the&nbsp;request&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;endRequest</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;requestDataStore</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Invalidate&nbsp;the&nbsp;request&nbsp;(all&nbsp;bean&nbsp;instances&nbsp;will&nbsp;be&nbsp;scheduled&nbsp;for&nbsp;destruction)&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestContext</span><span class="java_separator">.</span><span class="java_plain">invalidate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Deactivate&nbsp;the&nbsp;request,&nbsp;causing&nbsp;all&nbsp;bean&nbsp;instances&nbsp;to&nbsp;be&nbsp;destroyed&nbsp;(as&nbsp;the&nbsp;context&nbsp;is&nbsp;invalid)&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestContext</span><span class="java_separator">.</span><span class="java_plain">deactivate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">finally</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Ensure&nbsp;that&nbsp;whatever&nbsp;happens&nbsp;we&nbsp;dissociate&nbsp;to&nbsp;prevent&nbsp;any&nbsp;memory&nbsp;leaks&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestContext</span><span class="java_separator">.</span><span class="java_plain">dissociate</span><span class="java_separator">(</span><span class="java_plain">requestDataStore</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre>

<p>The bound session context works in much the same way, excepting that
invalidating and deactivating the session context causes the any
conversations in the session to be destroyed as well. The HTTP session
context and HTTP request context also work similarly, and might be of
use if you find yourself creating threads from an HTTP request). The
HTTP session context additionally offers a method which can immediately
destroy the context.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Weld’s session contexts are "lazy" and don’t require a session to
actually exist until a bean instance must be written.</p>
</div>

<p>The conversation context offers a few more options, which we will walk
through here.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><!-- <br/> --><span class="java_type">Inject</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BoundConversationContext</span><!-- <br/> --><span class="java_plain">&nbsp;conversationContext</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Start&nbsp;a&nbsp;transient&nbsp;conversation&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Provide&nbsp;a&nbsp;data&nbsp;store&nbsp;which&nbsp;will&nbsp;last&nbsp;the&nbsp;lifetime&nbsp;of&nbsp;the&nbsp;request&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;and&nbsp;one&nbsp;that&nbsp;will&nbsp;last&nbsp;the&nbsp;lifetime&nbsp;of&nbsp;the&nbsp;session&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;startTransientConversation</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;requestDataStore</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;sessionDataStore</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resumeOrStartConversation</span><span class="java_separator">(</span><span class="java_plain">requestDataStore</span><span class="java_separator">,</span><span class="java_plain">&nbsp;sessionDataStore</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Start&nbsp;a&nbsp;transient&nbsp;conversation&nbsp;(if&nbsp;cid&nbsp;is&nbsp;null)&nbsp;or&nbsp;resume&nbsp;a&nbsp;non-transient&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;conversation.&nbsp;Provide&nbsp;a&nbsp;data&nbsp;store&nbsp;which&nbsp;will&nbsp;last&nbsp;the&nbsp;lifetime&nbsp;of&nbsp;the&nbsp;request&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;and&nbsp;one&nbsp;that&nbsp;will&nbsp;last&nbsp;the&nbsp;lifetime&nbsp;of&nbsp;the&nbsp;session&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;resumeOrStartConversation</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;requestDataStore</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;sessionDataStore</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;cid</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Associate&nbsp;the&nbsp;stores&nbsp;with&nbsp;the&nbsp;context&nbsp;and&nbsp;activate&nbsp;the&nbsp;context&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_type">BoundRequest</span><span class="java_plain">&nbsp;just&nbsp;wraps&nbsp;the&nbsp;two&nbsp;datastores&nbsp;</span><span class="java_operator">*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conversationContext</span><span class="java_separator">.</span><span class="java_plain">associate</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">MutableBoundRequest</span><span class="java_separator">(</span><span class="java_plain">requestDataStore</span><span class="java_separator">,</span><span class="java_plain">&nbsp;sessionDataStore</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Pass</span><span class="java_plain">&nbsp;the&nbsp;cid&nbsp;in</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conversationContext</span><span class="java_separator">.</span><span class="java_plain">activate</span><span class="java_separator">(</span><span class="java_plain">cid</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;End&nbsp;the&nbsp;conversations,&nbsp;providing&nbsp;the&nbsp;same&nbsp;data&nbsp;store&nbsp;as&nbsp;was&nbsp;used&nbsp;to&nbsp;start&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;the&nbsp;request.&nbsp;Any&nbsp;transient&nbsp;conversations&nbsp;will&nbsp;be&nbsp;destroyed,&nbsp;any&nbsp;newly-promoted&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;conversations&nbsp;will&nbsp;be&nbsp;placed&nbsp;into&nbsp;the&nbsp;session&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;endOrPassivateConversation</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;requestDataStore</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;sessionDataStore</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Invalidate&nbsp;the&nbsp;conversation&nbsp;(all&nbsp;transient&nbsp;conversations&nbsp;will&nbsp;be&nbsp;scheduled&nbsp;for&nbsp;destruction)&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conversationContext</span><span class="java_separator">.</span><span class="java_plain">invalidate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Deactivate&nbsp;the&nbsp;conversation,&nbsp;causing&nbsp;all&nbsp;transient&nbsp;conversations&nbsp;to&nbsp;be&nbsp;destroyed&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conversationContext</span><span class="java_separator">.</span><span class="java_plain">deactivate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">finally</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*&nbsp;Ensure&nbsp;that&nbsp;whatever&nbsp;happens&nbsp;we&nbsp;dissociate&nbsp;to&nbsp;prevent&nbsp;memory&nbsp;leaks*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conversationContext</span><span class="java_separator">.</span><span class="java_plain">dissociate</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">MutableBoundRequest</span><span class="java_separator">(</span><span class="java_plain">requestDataStore</span><span class="java_separator">,</span><span class="java_plain">&nbsp;sessionDataStore</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre>

<p>The conversation context also offers a number of properties which
control the behavior of conversation expiration (after this period of
inactivity the conversation will be ended and destroyed by the
container), and the duration of lock timeouts (the conversation context
ensures that a single thread is accessing any bean instances by locking
access, if a lock can’t be obtained after a certain time Weld will error
rather than continue to wait for the lock). Additionally, you can alter
the name of the parameter used to transfer the conversation id (by
default, <code class="literal">cid</code>).</p>
<p>Weld also introduces the notion of a <code class="literal">ManagedConversation</code>, which
extends the <code class="literal">Conversation</code> interface with the ability to lock, unlock
and touch (update the last used timestamp) a conversation. Finally, all
non-transient conversations in a session can be obtained from the
conversation context, as can the current conversation.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Weld’s conversations are not assigned ids until they become
non-transient.</p>
</div>

</div>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_configuration"/>Chapter 20. Configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_excluding_classes_from_scanning_and_deployment">20.1. Excluding classes from scanning and deployment</a></span></dt><dt><span class="section"><a href="#_concurrent_deployment_configuration">20.2. Concurrent deployment configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#_thread_pool_configuration">20.2.1. Thread pool configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#_non_portable_mode_during_application_initialization">20.3. Non-portable mode during application initialization</a></span></dt><dt><span class="section"><a href="#_mapping_cdi_contexts_to_http_requests">20.4. Mapping CDI contexts to HTTP requests</a></span></dt><dt><span class="section"><a href="#_bounding_the_cache_size_for_resolved_injection_points">20.5. Bounding the cache size for resolved injection points</a></span></dt></dl></div>

<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_excluding_classes_from_scanning_and_deployment"/>20.1. Excluding classes from scanning and deployment</h2></div></div></div>

<p>CDI 1.1 allows you to exclude classes in your archive from being
scanned, having container lifecycle events fired, and being deployed as
beans. See also
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/cdi/spec/1.1/cdi-spec.html#bean_discovery">12.4.
Bean discovery</a>.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Weld still supports the original non-portable way of excluding classes
from discovery. The formal specification can be found in the xsd,
located at <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://jboss.org/schema/weld/beans_1_1.xsd">http://jboss.org/schema/weld/beans_1_1.xsd</a>. Unlike Weld, the
CDI specification does not support regular expression patterns and <code class="literal">!</code>
character to invert the activation condition.</p>
</div>

<p>All the configuration is done in the <code class="literal">beans.xml</code> file. For more
information see <a href="#">???</a>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">beans</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scan</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Don't&nbsp;deploy&nbsp;the&nbsp;classes&nbsp;for&nbsp;the&nbsp;swing&nbsp;app!&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">exclude</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.acme.swing.**&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Don't&nbsp;include&nbsp;GWT&nbsp;support&nbsp;if&nbsp;GWT&nbsp;is&nbsp;not&nbsp;installed&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">exclude</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.acme.gwt.**&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">if-class-not-available</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.google.GWT&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">exclude</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exclude&nbsp;types&nbsp;from&nbsp;com.acme.verbose&nbsp;package&nbsp;if&nbsp;the&nbsp;system&nbsp;property&nbsp;verbosity&nbsp;is&nbsp;set&nbsp;to&nbsp;low</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.e.</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;java&nbsp;...&nbsp;-Dverbosity=low</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">exclude</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.acme.verbose.*&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">if-system-property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;verbosity&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;low&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">exclude</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Don't&nbsp;include&nbsp;JSF&nbsp;support&nbsp;if&nbsp;Wicket&nbsp;classes&nbsp;are&nbsp;present,&nbsp;and&nbsp;the&nbsp;viewlayer&nbsp;system</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;property&nbsp;is&nbsp;set</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">exclude</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.acme.jsf.**&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">if-class-available</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.apache.wicket.Wicket&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">if-system-property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;viewlayer&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">exclude</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scan</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

<p>In this example we show the most common use cases for exercising fine
control over which classes Weld scans. The first filter excludes all
types whose package name starts with <code class="literal">com.acme.swing</code>, and in most cases
this will be sufficient for your needs.</p>
<p>However, sometimes it’s useful to be able to activate the filter
depending on the environment used. In this case, Weld allows you to
activate (or deactivate) a filter based on either system properties or
whether a class is available. The second filter shows the use case of
disabling scanning of certain classes depending on the capabilities of
the environment you deploy to - in this case we are excluding GWT
support (all types whose package name starts with <code class="literal">com.acme.gwt</code>) if GWT
is not installed.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>If you specify just a system property name, Weld will activate the
filter if that system property has been set (with any value). If you
also specify the system property value, then Weld will only activate the
filter if the system property’s value matches exactly.</p>
</div>

<p>The third filter shows how to exclude all types from a specific package
(note the <code class="literal">name</code> attribute has suffix ".*").</p>
<p>The fourth filter shows more a advanced configurations, where we use
multiple activation conditions to decide whether to activate the filter.</p>
<p>You can combine as many activation conditions as you like (<span class="emphasis"><em>all</em></span> must be
true for the filter to be activated). If you want to a filter that is
active if <span class="emphasis"><em>any</em></span> of the activation conditions are true, then you need
multiple identical filters, each with different activation conditions.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_concurrent_deployment_configuration"/>20.2. Concurrent deployment configuration</h2></div></div></div>

<p>Weld by default supports concurrent loading and deploying of beans.
However, in certain deployment scenarios the default setup may not be
appropriate. Bootstrap configuration may be altered using the
<code class="literal">org.jboss.weld.bootstrap.properties</code> file located on the classpath
(e.g. <code class="literal">WEB-INF/classes/org.jboss.weld.bootstrap.properties</code> in a web
archive).</p>
<div class="table"><a id="d4e3089"/><p class="title"><b>Table 20.1. Concurrent deployment configuration options</b></p><div class="table-contents">

  
  <table summary="Concurrent deployment configuration options" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="left" valign="top">Configuration option</th><th align="left" valign="top">Default value</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">concurrentDeployment</code></p></td><td align="left" valign="top"><p>true</p></td><td align="left" valign="top"><p>If set to false, <code class="literal">ConcurrentDeployer</code> and
<code class="literal">ConcurrentValidator</code> will not be used.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">preloaderThreadPoolSize</code></p></td><td align="left" valign="top"><p><code class="literal">Math.max(1, Runtime.getRuntime().availableProcessors() - 1)</code></p></td><td align="left" valign="top"><p>Weld is
capable of resolving observer methods for container lifecycle events in
advance while bean deployer threads are blocked waiting for I/O
operations (such as classloading). This process is called preloading and
leads to better CPU utilization and faster application startup time.
This configuration option specifies the number of threads used for
preloading. If set to 0, preloading is disabled.</p></td></tr></tbody></table>
</div></div><br class="table-break"/>

<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_thread_pool_configuration"/>20.2.1. Thread pool configuration</h3></div></div></div>

<p>For certain types of tasks Weld uses its own thread pool. The thread
pool is represented by the <code class="literal">ExecutorServices</code> service. It is possible to
alter the thread pool configuration in the
<code class="literal">WEB-INF/classes/org.jboss.weld.executor.properties</code> file.</p>
<div class="table"><a id="d4e3125"/><p class="title"><b>Table 20.2. Executor configuration options</b></p><div class="table-contents">

  
  <table summary="Executor configuration options" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="left" valign="top">Configuration option</th><th align="left" valign="top">Default value</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">threadPoolType</code></p></td><td align="left" valign="top"><p><code class="literal">FIXED</code></p></td><td align="left" valign="top"><p>The type of the thread pool. Possible values
are: <code class="literal">FIXED</code>, <code class="literal">FIXED_TIMEOUT</code>, <code class="literal">NONE</code>, <code class="literal">SINGLE_THREAD</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">threadPoolSize</code></p></td><td align="left" valign="top"><p><code class="literal">Runtime.getRuntime().availableProcessors()</code></p></td><td align="left" valign="top"><p>The
number of threads to be used for bean loading and deployment.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">threadPoolKeepAliveTime</code></p></td><td align="left" valign="top"><p>60 seconds</p></td><td align="left" valign="top"><p>Passed to the constructor of the
ThreadPoolExecutor class, maximum time that excess idle threads will
wait for new tasks before terminating.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">threadPoolDebug</code></p></td><td align="left" valign="top"><p>false</p></td><td align="left" valign="top"><p>If set to true, debug timing information is
printed to the standard output.</p></td></tr></tbody></table>
</div></div><br class="table-break"/>

</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_non_portable_mode_during_application_initialization"/>20.3. Non-portable mode during application initialization</h2></div></div></div>

<p>By default the application initialization is performed in the portable
mode which denotes specification-compliant behaviour. However it’s also
possible to enable the non-portable mode, in which some definition
errors and deployment problems do not cause application initialization
to abort. Currently the non-portable mode allows extension developers to
call all the <code class="literal">BeanManager</code>'s methods before the
<code class="literal">AfterDeploymentValidation</code> event is fired.</p>
<p>Set the system property <code class="literal">org.jboss.weld.nonPortableMode</code> to <code class="literal">true</code> in
order to enable the non-portable mode during initialization.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The main purpose of the non-portable mode is to support some legacy
extensions. It’s highly recommended to use the portable mode whenever
possible - non-portable mode may lead to unexpected behaviour during
initialization process.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_mapping_cdi_contexts_to_http_requests"/>20.4. Mapping CDI contexts to HTTP requests</h2></div></div></div>

<p>By default, CDI contexts are activated at the beginning of an HTTP
request processing and deactivated once the processing finishes. This
may represent an unnecessary overhead in certain situations, for example
static resource serving.</p>
<p>Weld allows CDI context support to be mapped to a certain subset of
requests only. A regular expression may be used for filtering HTTP
requests that should have CDI contexts active during their processing.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">web-app</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;3.1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://xmlns.jcp.org/xml/ns/javaee/&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://xmlns.jcp.org/xml/ns/javaee&nbsp;http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">context-param</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.weld.context.mapping</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">param-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param-value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">.*\.html</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">param-value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">context-param</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">web-app</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_bounding_the_cache_size_for_resolved_injection_points"/>20.5. Bounding the cache size for resolved injection points</h2></div></div></div>

<p>Weld caches already resolved injection points in order to resolve them
faster in the future. There exists a separate type safe resolver for
beans, decorators, disposers, interceptors and observers. Each of them
stores resolved injection points in its cache, which maximum size is
bounded by a default value (common to all of them). You can alter this
cache upper bound by setting the system property
<code class="literal">org.jboss.weld.resolution.cacheSize</code> to a specific number.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">System</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">setProperty</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;org.jboss.weld.resolution.cacheSize&quot;</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;1000&quot;</span><!-- <br/> --><span class="java_separator">);</span></pre>

</div>
</div>
<div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_integrating_weld_into_other_environments"/>Appendix A. Integrating Weld into other environments</h2></div></div></div>

<p>If you want to use Weld in another environment, you will need to provide
certain information to Weld via the integration SPI. In this Appendix we
will briefly discuss the steps needed.</p>
<p>If you are upgrading existing Weld integration to work with Weld 2, see
this
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://community.jboss.org/wiki/WeldIntegratorGuide-ChangesForWeld20">migration
document</a>.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>If you just want to use managed beans, and not take advantage of
enterprise services (EE resource injection, CDI injection into EE
component classes, transactional events, support for CDI services in
EJBs) and non-flat deployments, then the generic servlet support
provided by the "Weld: Servlets" extension will be sufficient, and will
work in any container supporting the Servlet API.</p>
</div>

<p>All SPIs and APIs described have extensive JavaDoc, which spell out the
detailed contract between the container and Weld.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_weld_spi"/>A.1. The Weld SPI</h2></div></div></div>

<p>The Weld SPI is located in the <code class="literal">weld-spi</code> module, and packaged as
<code class="literal">weld-spi.jar</code>. Some SPIs are optional, and should only be implemented
if you need to override the default behavior; others are required.</p>
<p>All interfaces in the SPI support the decorator pattern and provide a
<code class="literal">Forwarding</code> class located in the <code class="literal">helpers</code> sub package. Additional,
commonly used, utility classes, and standard implementations are also
located in the <code class="literal">helpers</code> sub package.</p>
<p>Weld supports multiple environments. An environment is defined by an
implementation of the <code class="literal">Environment</code> interface. A number of standard
environments are built in, and described by the <code class="literal">Environments</code>
enumeration. Different environments require different services to be
present (for example a Servlet container doesn’t require transaction,
EJB or JPA services). By default an EE environment is assumed, but you
can adjust the environment by calling <code class="literal">bootstrap.setEnvironment()</code>.</p>
<p>Weld uses services to communicate with its environment. A service is a
java class that implements the <code class="literal">org.jboss.weld.bootstrap.api.Service</code>
interface and is explicitly registered. A service may be BDA-specific or
may be shared across the entire application.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Service</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;cleanup</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Certain services are only used at bootstrap and need to be cleaned up
afterwards in order not to consume memory. A service that implements the
specialized <code class="literal">org.jboss.weld.bootstrap.api.BootstrapService</code> interface
receives a <code class="literal">cleanupAfterBoot()</code> method invocation once Weld
initialization is finished but before the deployment is put into
service.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BootstrapService</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Service</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;cleanupAfterBoot</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>Weld uses a generic-typed service registry to allow services to be
registered. All services implement the <code class="literal">Service</code> interface. The service
registry allows services to be added and retrieved.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_deployment_structure"/>A.1.1. Deployment structure</h3></div></div></div>

<p>An application is often comprised of a number of modules. For example, a
Java EE deployment may contain a number of EJB modules (containing
business logic) and war modules (containing the user interface). A
container may enforce certain <span class="emphasis"><em>accessibility</em></span> rules which limit the
visibility of classes between modules. CDI allows these same rules to
apply to bean and observer method resolution. As the accessibility rules
vary between containers, Weld requires the container to <span class="emphasis"><em>describe</em></span> the
deployment structure, via the <code class="literal">Deployment</code> SPI.</p>
<p>The CDI specification discusses <span class="emphasis"><em>Bean Archives</em></span> (BAs)—archives which are
marked as containing beans which should be deployed to the CDI
container, and made available for injection and resolution. Weld reuses
this description and uses <span class="emphasis"><em>Bean Deployment Archives (BDA)</em></span> in its
deployment structure SPI.</p>
<p>Each deployment exposes the containing BDAs that form a graph. A node in
the graph represents a BDA. Directed edges between nodes designate
visibility. Visibility is not transitive (i.e. a bean from BDA A can
only see beans in BDAs with which A is directly connected by a properly
oriented edge).</p>
<p>To describe the deployment structure to Weld, the container should
provide an implementation of <code class="literal">Deployment</code>.
<code class="literal">Deployment.getBeanDeploymentArchives()</code> allows Weld to discover the
modules which make up the application. The CDI specification also allows
beans to be specified programmatically as part of the bean deployment.
These beans may, or may not, be in an existing BDA. For this reason,
Weld will call <code class="literal">Deployment.loadBeanDeploymentArchive(Class clazz)</code> for
each programmatically described bean.</p>
<p>As programmatically described beans may result in additional BDAs being
added to the graph, Weld will discover the BDA structure every time an
unknown BDA is returned by <code class="literal">Deployment.loadBeanDeploymentArchive</code>.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>In a strict container, each BDA might have to explicitly specify which
other BDAs it can access. However many containers will allow an easy
mechanism to make BDAs bi-directionally accessible (such as a library
directory). In this case, it is allowable (and reasonable) to describe
all such archives as a single, <span class="emphasis"><em>virtual</em></span> <code class="literal">BeanDeploymentArchive</code>.</p>
<p>A container, might, for example, use a flat accessibility structure for
the application. In this case, a single <code class="literal">BeanDeploymentArchive</code> would be
attached to the <code class="literal">Deployment</code>.</p>
</div>

<p><code class="literal">BeanDeploymentArchive</code> provides three methods which allow it’s contents
to be discovered by Weld—<code class="literal">BeanDeploymentArchive.getBeanClasses()</code> must
return all the classes in the BDA, <code class="literal">BeanDeploymentArchive.getBeansXml()</code>
must return a data structure representing the <code class="literal">beans.xml</code> deployment
descriptor for the archive, and <code class="literal">BeanDeploymentArchive.getEjbs()</code> must
provide an EJB descriptor for every EJB in the BDA, or an empty list if
it is not an EJB archive.</p>
<p>To aid container integrator, Weld provides a built-in <code class="literal">beans.xml</code>
parser. To parse a <code class="literal">beans.xml</code> into the data-structure required by
<code class="literal">BeanDeploymentArchive</code>, the container should call
<code class="literal">Bootstrap.parse(URL)</code>. Weld can also parse multiple <code class="literal">beans.xml</code> files,
merging them to become a single data-structure. This can be achieved by
calling <code class="literal">Bootstrap.parse(Iterable&lt;URL&gt;)</code>.</p>
<p>When multiple <code class="literal">beans.xml</code> files are merged, Weld keeps duplicate enabled
entries (interceptors, decorators or alternatives). This may cause
validation problems when multiple physical archives which define an
overlapping enabled entries are merged. A version of the
<code class="literal">Bootstrap.parse()</code> method that provides control over whether duplicate
enabled entries are remove or not is provided:
<code class="literal">Bootstrap.parse(Iterable&lt;URL&gt; urls, boolean removeDuplicates)</code>.</p>
<p>BDA X may also reference another BDA Y whose beans can be resolved by,
and injected into, any bean in BDA X. These are the accessible BDAs, and
every BDA that is directly accessible by BDA X should be returned. A BDA
will also have BDAs which are accessible transitively, and the
transitive closure of the sub-graph of BDA X describes all the beans
resolvable by BDA X.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>In practice, you can regard the deployment structure represented by
<code class="literal">Deployment</code>, and the virtual BDA graph as a mirror of the classloader
structure for a deployment. If a class can from BDA X can be loaded by
another in BDA Y, it is accessible, and therefore BDA Y’s accessible
BDAs should include BDA X.</p>
</div>

<p>To specify the directly accessible BDAs, the container should provide an
implementation of <code class="literal">BeanDeploymentArchive.getBeanDeploymentArchives()</code>.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Weld allows the container to describe a circular graph, and will convert
a graph to a tree as part of the deployment process.</p>
</div>

<p>Certain services are provided for the whole deployment, whilst some are
provided per-BDA. BDA services are provided using
<code class="literal">BeanDeploymentArchive.getServices()</code> and only apply to the BDA on which
they are provided.</p>
<p>The contract for <code class="literal">Deployment</code> requires the container to specify the
portable extensions (see chapter 12 of the CDI specification) which
should be loaded by the application. To aid the container integrator,
Weld provides the method <code class="literal">Bootstrap.loadExtensions(ClassLoader)</code> which
will load the extensions for the specified classloader.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_ejb_descriptors"/>A.1.2. EJB descriptors</h3></div></div></div>

<p>Weld delegates EJB 3 bean discovery to the container so that it doesn’t
duplicate the work done by the EJB container, and respects any
vendor-extensions to the EJB definition.</p>
<p>The <code class="literal">EjbDescriptor</code> should return the relevant metadata as defined in
the EJB specification. Each business interface of a session bean should
be described using a <code class="literal">BusinessInterfaceDescriptor</code>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_ee_resource_injection_and_resolution_services"/>A.1.3. EE resource injection and resolution services</h3></div></div></div>

<p>All the EE resource services are per-BDA services, and may be provided
using one of two methods. Which method to use is at the discretion of
the integrator.</p>
<p>The integrator may choose to provide all EE resource injection services
themselves, using another library or framework. In this case the
integrator should use the <code class="literal">EE</code> environment, and implement the <a href="#_injection_services" title="A.1.9. Injection Services">Section A.1.9, “Injection Services”</a> SPI.</p>
<p>Alternatively, the integrator may choose to use CDI to provide EE
resource injection. In this case, the <code class="literal">EE_INJECT</code> environment should be
used, and the integrator should implement the <a href="#_ejb_services" title="A.1.4. EJB services">Section A.1.4, “EJB services”</a>, <a href="#_resource_services" title="A.1.7. Resource Services">Section A.1.7, “Resource Services”</a>
and <a href="#_jpa_services" title="A.1.5. JPA services">Section A.1.5, “JPA services”</a>.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2>
<p>CDI only provides annotation-based EE resource injection; if you wish to
provide deployment descriptor (e.g. <code class="literal">ejb-jar.xml</code>) injection, you must
use <a href="#_injection_services" title="A.1.9. Injection Services">Section A.1.9, “Injection Services”</a>.</p>
</div>

<p>If the container performs EE resource injection, the injected resources
must be serializable. If EE resource injection is provided by Weld, the
resolved resource must be serializable.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2>
<p>If you use a non-EE environment then you may implement any of the EE
service SPIs, and Weld will provide the associated functionality. There
is no need to implement those services you don’t need!</p>
</div>

<p>Weld registers resource injection points with <code class="literal">EjbInjectionServices</code>,
<code class="literal">JpaInjectionServices</code>, <code class="literal">ResourceInjectionServices</code> and
<code class="literal">JaxwsInjectionServices</code> implementations upfront (at bootstrap). This
allows validation of resource injection points to be performed at boot
time rather than runtime. For each resource injection point Weld obtains
a <code class="literal">ResourceReferenceFactory</code> which it then uses at runtime for creating
resource references.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ResourceReferenceFactory</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceReference</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;createResource</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>A <code class="literal">ResourceReference</code> provides access to the resource reference to be
injected. Furthermore, <code class="literal">ResourceReference</code> allows resource to be release
once the bean that received resource injection is destroyed.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ResourceReference</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;getInstance</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;release</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_ejb_services"/>A.1.4. EJB services</h3></div></div></div>

<p>EJB services are split between two interfaces which are both per-BDA.</p>
<p><code class="literal">EjbServices</code> is used to resolve local EJBs used to back session beans,
and must always be provided in an EE environment.
<code class="literal">EjbServices.resolveEjb(EjbDescriptor ejbDescriptor)</code> returns a
wrapper—<code class="literal">SessionObjectReference</code>—around the EJB reference. This wrapper
allows Weld to request a reference that implements the given business
interface, and, in the case of SFSBs, both request the removal of the
EJB from the container and query whether the EJB has been previously
removed.</p>
<p><code class="literal">EjbInjectionServices.registerEjbInjectionPoint(InjectionPoint injectionPoint)</code>
registers an <code class="literal">@EJB</code> injection point (on a managed bean) and returns a
<code class="literal">ResourceReferenceFactory</code> as explained above. This service is not
required if the implementation of &lt;&lt;_injection_services&gt; takes care of <code class="literal">@EJB</code> injection.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p><code class="literal">EJBInjectionServices.resolveEjb(InjectionPoint ij)</code>, which allows
<code class="literal">@EJB</code> injection point to be resolved without prior registration was
deprecated in Weld 2 and should no longer be used. An injection point
should be registered properly using
<code class="literal">EjbInjectionServices.registerEjbInjectionPoint(InjectionPoint injectionPoint)</code>
instead.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_jpa_services"/>A.1.5. JPA services</h3></div></div></div>

<p>Just as EJB resolution is delegated to the container, resolution of
<code class="literal">@PersistenceContext</code> for injection into managed beans (with the
<code class="literal">InjectionPoint</code> provided), is delegated to the container.</p>
<p>To allow JPA integration, the <code class="literal">JpaServices</code> interface should be
implemented. This service is not required if the implementation of <a href="#_injection_services" title="A.1.9. Injection Services">Section A.1.9, “Injection Services”</a>
takes care of <code class="literal">@PersistenceContext</code> injection.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The following methods were deprecated in Weld 2:</p>
<p>*
<code class="literal">JpaInjectionServices.resolvePersistenceContext(InjectionPoint injectionPoint)</code>
*
<code class="literal">JpaInjectionServices.resolvePersistenceUnit(InjectionPoint injectionPoint)</code></p>
<p>An injection point should instead be registered properly using the
following methods:</p>
<p>*
<code class="literal">JpaInjectionServices.registerPersistenceContextInjectionPoint(InjectionPoint injectionPoint)</code>
*
<code class="literal">JpaInjectionServices.registerPersistenceUnitInjectionPoint(InjectionPoint injectionPoint)</code></p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_transaction_services"/>A.1.6. Transaction Services</h3></div></div></div>

<p>Weld delegates JTA activities to the container. The SPI provides a
couple hooks to easily achieve this with the <code class="literal">TransactionServices</code>
interface.</p>
<p>Any <code class="literal">javax.transaction.Synchronization</code> implementation may be passed to
the <code class="literal">registerSynchronization()</code> method and the SPI implementation should
immediately register the synchronization with the JTA transaction
manager used for the EJBs.</p>
<p>To make it easier to determine whether or not a transaction is currently
active for the requesting thread, the <code class="literal">isTransactionActive()</code> method can
be used. The SPI implementation should query the same JTA transaction
manager used for the EJBs.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_resource_services"/>A.1.7. Resource Services</h3></div></div></div>

<p>The resolution of <code class="literal">@Resource</code> (for injection into managed beans) is
delegated to the container. You must provide an implementation of
<code class="literal">ResourceInjectionServices</code> which provides these operations. This
service is not required if the implementation of <a href="#_injection_services" title="A.1.9. Injection Services">Section A.1.9, “Injection Services”</a> takes care of
<code class="literal">@Resource</code> injection.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>The following methods were deprecated in Weld 2:</p>
<p>*
<code class="literal">ResourceInjectionServices.resolveResource(InjectionPoint injectionPoint)</code>
*
<code class="literal">ResourceInjectionServices.resolveResource(String jndiName, String mappedName)</code></p>
<p>An injection point should instead be registered properly using the
following methods:</p>
<p>*
<code class="literal">ResourceInjectionServices.registerResourceInjectionPoint(InjectionPoint injectionPoint)</code>
*
<code class="literal">ResourceInjectionServices.registerResourceInjectionPoint(String jndiName, String mappedName)</code></p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_web_service_injection_services"/>A.1.8. Web Service Injection Services</h3></div></div></div>

<p>The resolution of <code class="literal">@WebServiceRef</code> (for injection into managed beans) is
delegated to the container. An integrator must provide an implementation
of <code class="literal">JaxwsInjectionServices</code>. This service is not required if the
implementation of <a href="#_injection_services" title="A.1.9. Injection Services">Section A.1.9, “Injection Services”</a> takes care of <code class="literal">@WebServiceRef</code> injection.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_injection_services"/>A.1.9. Injection Services</h3></div></div></div>

<p>An integrator may wish to use <code class="literal">InjectionServices</code> to provide additional
field or method injection over-and-above that provided by Weld. An
integration into a Java EE environment may use <code class="literal">InjectionServices</code> to
provide EE resource injection for managed beans.</p>
<p><code class="literal">InjectionServices</code> provides a very simple contract, the
<code class="literal">InjectionServices.aroundInject(InjectionContext ic);</code> interceptor will
be called for every instance that CDI injects, whether it is a
contextual instance, or a non-contextual instance injected by
<code class="literal">InjectionTarget.inject()</code>.</p>
<p>The <code class="literal">InjectionContext</code> can be used to discover additional information
about the injection being performed, including the <code class="literal">target</code> being
injected. <code class="literal">ic.proceed()</code> should be called to perform CDI-style
injection, and call initializer methods.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_resource_injection_point_validation"/>A.1.9.1. Resource injection point validation</h4></div></div></div>

<p>For each</p>
<div class="itemizedlist"><ul><li>
@Resource injection point
</li><li>
@PersistenceContext injection point
</li><li>
@PersistenceUnit injection point
</li><li>
@EJB injection point
</li><li>
@WebServiceRef injection point
</li></ul></div>

<p>Weld calls the <code class="literal">InjectionServices.registerInjectionTarget()</code> method.
That allows the integrator to validate resource injection points before
the application is deployed.</p>
</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_security_services"/>A.1.10. Security Services</h3></div></div></div>

<p>In order to obtain the <code class="literal">Principal</code> representing the current caller
identity, the container should provide an implementation of
<code class="literal">SecurityServices</code>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_the_bean_store"/>A.1.11. The bean store</h3></div></div></div>

<p>Weld uses a map like structure to store bean instances -
<code class="literal">org.jboss.weld.context.beanstore.BeanStore</code>. You may find
<code class="literal">org.jboss.weld.context.beanstore.ConcurrentHashMapBeanStore</code> useful.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BeanStore</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">ContextualInstance</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;get</span><span class="java_separator">(</span><span class="java_type">BeanIdentifier</span><span class="java_plain">&nbsp;id</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;clear</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Iterator</span><span class="java_operator">&lt;</span><span class="java_type">BeanIdentifier</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;iterator</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;contains</span><span class="java_separator">(</span><span class="java_type">BeanIdentifier</span><span class="java_plain">&nbsp;id</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;put</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ContextualInstance</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;contextualInstance</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_type">ContextualInstance</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;remove</span><span class="java_separator">(</span><span class="java_type">BeanIdentifier</span><span class="java_plain">&nbsp;id</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_the_application_context"/>A.1.12. The application context</h3></div></div></div>

<p>Weld expects the Application Server or other container to provide the
storage for each application’s context. The
<code class="literal">org.jboss.weld.context.beanstore.BeanStore</code> should be implemented to
provide an application scoped storage.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_initialization_and_shutdown"/>A.1.13. Initialization and shutdown</h3></div></div></div>

<p>The <code class="literal">org.jboss.weld.bootstrap.api.Bootstrap</code> interface defines the
initialization for Weld, bean deployment and bean validation. To boot
Weld, you must create an instance of
<code class="literal">org.jboss.weld.bootstrap.WeldBeansBootstrap</code> (which implements
<code class="literal">Bootstrap</code>), tell it about the services in use, and then request the
container start.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Bootstrap</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Bootstrap</span><span class="java_plain">&nbsp;startContainer</span><span class="java_separator">(</span><span class="java_type">Environment</span><span class="java_plain">&nbsp;environment</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Deployment</span><span class="java_plain">&nbsp;deployment</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Bootstrap</span><span class="java_plain">&nbsp;startInitialization</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Bootstrap</span><span class="java_plain">&nbsp;deployBeans</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Bootstrap</span><span class="java_plain">&nbsp;validateBeans</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Bootstrap</span><span class="java_plain">&nbsp;endInitialization</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;shutdown</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">WeldManager</span><span class="java_plain">&nbsp;getManager</span><span class="java_separator">(</span><span class="java_type">BeanDeploymentArchive</span><span class="java_plain">&nbsp;beanDeploymentArchive</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BeansXml</span><span class="java_plain">&nbsp;parse</span><span class="java_separator">(</span><span class="java_plain">URL&nbsp;url</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BeansXml</span><span class="java_plain">&nbsp;parse</span><span class="java_separator">(</span><span class="java_type">Iterable</span><span class="java_operator">&lt;</span><span class="java_plain">URL</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;urls</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BeansXml</span><span class="java_plain">&nbsp;parse</span><span class="java_separator">(</span><span class="java_type">Iterable</span><span class="java_operator">&lt;</span><span class="java_plain">URL</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;urls</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;removeDuplicates</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Iterable</span><span class="java_operator">&lt;</span><span class="java_type">Metadata</span><span class="java_operator">&lt;</span><span class="java_type">Extension</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;loadExtensions</span><span class="java_separator">(</span><span class="java_type">ClassLoader</span><span class="java_plain">&nbsp;classLoader</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<p>The bootstrap is split into phases, container initialization, bean
deployment, bean validation and shutdown. Initialization will create a
manager, and add the built-in contexts, and examine the deployment
structure. Bean deployment will deploy any beans (defined using
annotations, programmatically, or built in). Bean validation will
validate all beans.</p>
<p>To initialize the container, you call <code class="literal">Bootstrap.startInitialization()</code>.
Before calling <code class="literal">startInitialization()</code>, you must register any services
required by the environment. You can do this by calling, for example,
<code class="literal">bootstrap.getManager().getServices().add(JpaServices.class, new
            MyJpaServices())</code>. You must also provide the application
context bean store.</p>
<p>Having called <code class="literal">startInitialization()</code>, the <code class="literal">Manager</code> for each BDA can be
obtained by calling <code class="literal">Bootstrap.getManager(BeanDeploymentArchive bda)</code>.</p>
<p>To deploy the discovered beans, call <code class="literal">Bootstrap.deployBeans()</code>.</p>
<p>To validate the deployed beans, call <code class="literal">Bootstrap.validateBeans()</code>.</p>
<p>To place the container into a state where it can service requests, call
<code class="literal">Bootstrap.endInitialization()</code></p>
<p>To shutdown the container you call <code class="literal">Bootstrap.shutdown()</code>. This allows
the container to perform any cleanup operations needed.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_resource_loading"/>A.1.14. Resource loading</h3></div></div></div>

<p>Weld needs to load classes and resources from the classpath at various
times. By default, they are loaded from the Thread Context ClassLoader
if available, if not the same classloader that was used to load Weld,
however this may not be correct for some environments. If this is case,
you can implement <code class="literal">org.jboss.weld.resources.spi.ResourceLoader</code>.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">jboss</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">weld</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">bootstrap</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">api</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Service</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceLoader</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Service</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;classForName</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;URL&nbsp;getResource</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Collection</span><span class="java_operator">&lt;</span><span class="java_plain">URL</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getResources</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_annotationdiscovery"/>A.1.15. AnnotationDiscovery</h3></div></div></div>

<p>The optional <code class="literal">AnnotationDiscovery</code> service has been deprecated and is
not used by Weld since Weld 2.2. Integrators are encouraged to implement
<code class="literal">ClassFileServices</code> instead.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_classfileservices"/>A.1.16. ClassFileServices</h3></div></div></div>

<p>Integrators with bytecode-scanning capabilities may implement an
optional <code class="literal">ClassFileServices</code> service.</p>
<p>Bytecode-scanning is used by some application servers to speed up
deployment. Compared to loading a class using <code class="literal">ClassLoader</code>,
bytecode-scanning allows to obtain only a subset of the Java class file
metadata (e.g. annotations, class hierarchy, etc.) which is usually
loaded much faster. This allows the container to scan all classes
initially by a bytecode scanner and then use this limited information to
decide which classes need to be fully loaded using <code class="literal">ClassLoader</code>.
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://github.com/wildfly/jandex">Jandex</a> is an example of a
bytecode-scanning utility.</p>
<p><code class="literal">ClassFileServices</code> may be used by an integrator to provide container’s
bytecode-scanning capabilities to Weld. If present, Weld will try to use
the service to avoid loading of classes that do not need to be loaded.
These are classes that:</p>
<div class="itemizedlist"><ul><li>
are not <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/cdi/spec/1.1/cdi-spec.html#what_classes_are_beans">CDI managed beans</a> and
</li><li>
are not assignable to any ProcessAnnotatedType observer
</li></ul></div>

<p>This usually yields improved bootstrap performance especially in large
deployments with a lot of classes in explicit bean archives.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ClassFileServices</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BootstrapService</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ClassFileInfo</span><span class="java_plain">&nbsp;getClassFileInfo</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;className</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>

<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ClassFileInfo</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getClassName</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getSuperclassName</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isAnnotationDeclared</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotationType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;containsAnnotation</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;annotationType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getModifiers</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;hasCdiConstructor</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isAssignableFrom</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;javaClass</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isAssignableTo</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;javaClass</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isVetoed</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isTopLevelClass</span><span class="java_separator">();</span></pre>

<p>See the JavaDoc for more details.</p>
</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_the_contract_with_the_container"/>A.2. The contract with the container</h2></div></div></div>

<p>There are a number of requirements that Weld places on the container for
correct functioning that fall outside implementation of APIs.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_classloader_isolation"/>A.2.1. Classloader isolation</h3></div></div></div>

<p>If you are integrating Weld into an environment that supports deployment
of multiple applications, you must enable, automatically, or through
user configuration, classloader isolation for each CDI application.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_servlet"/>A.2.2. Servlet</h3></div></div></div>

<p>If you are integrating Weld into a Servlet environment you must register
<code class="literal">org.jboss.weld.servlet.WeldInitialListener</code> and
<code class="literal">org.jboss.weld.servlet.WeldTerminalListener</code> as Servlet listeners,
either automatically, or through user configuration, for each CDI
application which uses Servlet.</p>
<p>You must ensure that <code class="literal">WeldListener</code> is called before any other
application-defined listener is called and that <code class="literal">WeldTerminalListener</code>
is called only after all application-defined listeners have been called.</p>
<p>You must ensure that <code class="literal">WeldListener.contextInitialized()</code> is called after
beans are deployed is complete (<code class="literal">Bootstrap.deployBeans()</code> has been
called).</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_cdi_conversation_filter_2"/>A.2.3. CDI Conversation Filter</h3></div></div></div>

<p>A CDI implementation is required to provide a Servlet filter named “CDI
Conversation Filter”. The filter may be mapped by an application in the
web descriptor. That allows application to place another filter around
the CDI filter for dealing with exceptions.</p>
<p>Weld provides this filter with a fully qualified class name
of`org.jboss.weld.servlet.ConversationFilter`.</p>
<p>If the application contains a filter mapping for a filter named “CDI
Conversation Filter”, the integrator is required to register
<code class="literal">org.jboss.weld.servlet.ConversationFilter</code> as a filter with “CDI
Conversation Filter” as its filter name. If no such mapping exists in
the application, the integrator is not required to register the filter.
In that case, WeldListener will take care of conversation context
activation/deactivation at the beginning of HTTP request processing.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_jsf"/>A.2.4. JSF</h3></div></div></div>

<p>If you are integrating Weld into a JSF environment you must register
<code class="literal">org.jboss.weld.el.WeldELContextListener</code> as an EL Context listener.</p>
<p>If you are integrating Weld into a JSF environment you must register
<code class="literal">org.jboss.weld.jsf.ConversationAwareViewHandler</code> as a delegating view
handler.</p>
<p>If you are integrating Weld into a JSF environment you must obtain the
bean manager for the module and then call
<code class="literal">BeanManager.wrapExpressionFactory()</code>, passing
<code class="literal">Application.getExpressionFactory()</code> as the argument. The wrapped
expression factory must be used in all EL expression evaluations
performed by JSF in this web application.</p>
<p>If you are integrating Weld into a JSF environment you must obtain the
bean manager for the module and then call <code class="literal">BeanManager.getELResolver()</code>,
The returned EL resolver should be registered with JSF for this web
application.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2>
<p>There are a number of ways you can obtain the bean manager for the
module. You could call <code class="literal">Bootstrap.getManager()</code>, passing in the BDA for
this module. Alternatively, you could use the injection into Java EE
component classes, or look up the bean manager in JNDI.</p>
</div>

<p>If you are integrating Weld into a JSF environment you must register
<code class="literal">org.jboss.weld.servlet.ConversationPropagationFilter</code> as a Servlet
listener, either automatically, or through user configuration, for each
CDI application which uses JSF. This filter can be registered for all
Servlet deployment safely.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p>Weld only supports JSF 1.2 and above.</p>
</div>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p><code class="literal">org.jboss.weld.jsf.WeldPhaseListener</code> was deprecated in Weld 2 and is
no longer present in Weld.</p>
</div>

<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
<p><code class="literal">org.jboss.weld.servlet.ConversationPropagationFilter</code> was deprecated
and should no longer be used.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_jsp"/>A.2.5. JSP</h3></div></div></div>

<p>If you are integrating Weld into a JSP environment you must register
<code class="literal">org.jboss.weld.el.WeldELContextListener</code> as an EL Context listener.</p>
<p>If you are integrating Weld into a JSP environment you must obtain the
bean manager for the module and then call
<code class="literal">BeanManager.wrapExpressionFactory()</code>, passing
<code class="literal">Application.getExpressionFactory()</code> as the argument. The wrapped
expression factory must be used in all EL expression evaluations
performed by JSP.</p>
<p>If you are integrating Weld into a JSP environment you must obtain the
bean manager for the module and then call <code class="literal">BeanManager.getELResolver()</code>,
The returned EL resolver should be registered with JSP for this web
application.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2>
<p>There are a number of ways you can obtain the bean manager for the
module. You could call <code class="literal">Bootstrap.getManager()</code>, passing in the BDA for
this module. Alternatively, you could use the injection into Java EE
component classes, or look up the bean manager in JNDI.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_session_bean_interceptor"/>A.2.6. Session Bean Interceptor</h3></div></div></div>

<p><code class="literal">org.jboss.weld.ejb.SessionBeanInterceptor</code> takes care of activating the
request scope around EJB method invocations in a non-servlet
environment, such as message-driven bean invocation, <code class="literal">@Asynchronous</code>
invocation or <code class="literal">@Timeout</code>. If you are integrating Weld into an EJB
environment you must register the <code class="literal">aroundInvoke</code> method of
<code class="literal">SessionBeanInterceptor</code> as a EJB around-invoke interceptor for all EJBs
in the application, either automatically, or through user configuration,
for each CDI application which uses enterprise beans.</p>
<p>If you are running in a EJB 3.2 environment, you should register this as
an around-timeout interceptor as well.</p>
<p>In addition, since CDI 1.1 the <code class="literal">aroundInvoke</code> method of
<code class="literal">SessionBeanInterceptor</code> should be invoked around <code class="literal">@PostConstruct</code>
callbacks of EJBs.</p>
<div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2>
<p>You must register the <code class="literal">SessionBeanInterceptor</code> as the inner most
interceptor in the stack for all EJBs.</p>
</div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_the_literal_weld_core_jar_literal"/>A.2.7. The <code class="literal">weld-core.jar</code></h3></div></div></div>

<p>Weld can reside on an isolated classloader, or on a shared classloader.
If you choose to use an isolated classloader, the default
<code class="literal">SingletonProvider</code>, <code class="literal">IsolatedStaticSingletonProvider</code>, can be used. If
you choose to use a shared classloader, then you will need to choose
another strategy.</p>
<p>You can provide your own implementation of <code class="literal">Singleton</code> and
<code class="literal">SingletonProvider</code> and register it for use using
<code class="literal">SingletonProvider.initialize(SingletonProvider provider)</code>.</p>
<p>Weld also provides an implementation of Thread Context Classloader per
application strategy, via the <code class="literal">TCCLSingletonProvider</code>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_binding_the_manager_in_jndi"/>A.2.8. Binding the manager in JNDI</h3></div></div></div>

<p>You should bind the bean manager for the bean deployment archive into
JNDI at <code class="literal">java:comp/BeanManager</code>. The type should be
<code class="literal">javax.enterprise.inject.spi.BeanManager</code>. To obtain the correct bean
manager for the bean deployment archive, you may call
<code class="literal">bootstrap.getBeanManager(beanDeploymentArchive)</code></p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="__literal_cdiprovider_literal"/>A.2.9. <code class="literal">CDIProvider</code></h3></div></div></div>

<p>CDI 1.1 provides a simplified approach to accessing the BeanManager /
CDI container from components that do not support injection. This is
done by the CDI class API. The integrating part can either use
<code class="literal">org.jboss.weld.AbstractCDI</code> or <code class="literal">org.jboss.weld.SimpleCDI</code> provided by
Weld core and register it using
<code class="literal">javax.enterprise.inject.spi.CDIProvider</code> file that is visible to the
CDI API classes or use the <code class="literal">CDI.setCDIProvider(CDIProvider provider)</code>
method method early in the deployment.</p>
<p>Alternatively, an integrating part may provide a specialized
implementation such as the one provided by
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://github.com/wildfly/wildfly/blob/master/weld/src/main/java/org/jboss/as/weld/WeldProvider.java">WildFly
integration</a>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_performing_cdi_injection_on_java_ee_component_classes"/>A.2.10. Performing CDI injection on Java EE component classes</h3></div></div></div>

<p>The CDI specification requires the container to provide injection into
non-contextual resources for all Java EE component classes. Weld
delegates this responsibility to the container. This can be achieved
using the CDI defined <code class="literal">InjectionTarget</code> SPI. Furthermore, you must
perform this operation on the correct bean manager for the bean
deployment archive containing the EE component class.</p>
<p>The CDI specification also requires that a <code class="literal">ProcessInjectionTarget</code>
event is fired for every Java EE component class. Furthermore, if an
observer calls <code class="literal">ProcessInjectionTarget.setInjectionTarget()</code> the
container must use <span class="emphasis"><em>the specified</em></span> injection target to perform
injection.</p>
<p>To help the integrator, Weld provides
<code class="literal">WeldManager.fireProcessInjectionTarget()</code> which returns the
<code class="literal">InjectionTarget</code> to use.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Fire</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ProcessInjectionTarget</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;returning&nbsp;the&nbsp;</span><!-- <br/> --><span class="java_type">InjectionTarget</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;to&nbsp;use</span>
<!--  --><br/><span class="java_type">InjectionTarget</span><span class="java_plain">&nbsp;it&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;weldBeanManager</span><span class="java_separator">.</span><span class="java_plain">fireProcessInjectionTarget</span><span class="java_separator">(</span><span class="java_plain">clazz</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Per</span><span class="java_plain">&nbsp;instance&nbsp;required</span><span class="java_separator">,</span><span class="java_plain">&nbsp;create&nbsp;the&nbsp;creational&nbsp;context</span>
<!--  --><br/><span class="java_type">CreationalContext</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;cc&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;beanManager</span><span class="java_separator">.</span><span class="java_plain">createCreationalContext</span><span class="java_separator">(</span><span class="java_literal">null</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Produce</span><span class="java_plain">&nbsp;the&nbsp;instance</span><span class="java_separator">,</span><span class="java_plain">&nbsp;performing&nbsp;any&nbsp;constructor&nbsp;injection&nbsp;required</span>
<!--  --><br/><span class="java_type">Object</span><span class="java_plain">&nbsp;instance&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;it</span><span class="java_separator">.</span><span class="java_plain">produce</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Perform</span><span class="java_plain">&nbsp;injection&nbsp;and&nbsp;call&nbsp;initializers</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">,</span><span class="java_plain">&nbsp;cc</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Call</span><span class="java_plain">&nbsp;the&nbsp;post</span><span class="java_operator">-</span><span class="java_plain">construct&nbsp;callback</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">postConstruct</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Call</span><span class="java_plain">&nbsp;the&nbsp;pre</span><span class="java_operator">-</span><span class="java_plain">destroy&nbsp;callback</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">preDestroy</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Clean</span><span class="java_plain">&nbsp;up&nbsp;the&nbsp;instance</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">dispose</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">cc</span><span class="java_separator">.</span><span class="java_plain">release</span><span class="java_separator">();</span></pre>

<p>The container may intersperse other operations between these calls.
Further, the integrator may choose to implement any of these calls in
another manner, assuming the contract is fulfilled.</p>
<p>When performing injections on EJBs you must use the Weld-defined SPI,
<code class="literal">WeldManager</code>. Furthermore, you must perform this operation on the
correct bean manager for the bean deployment archive containing the EJB.</p>
<pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Obtain</span><!-- <br/> --><span class="java_plain">&nbsp;the&nbsp;</span><!-- <br/> --><span class="java_type">EjbDescriptor</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">for</span><!-- <br/> --><span class="java_plain">&nbsp;the&nbsp;EJB</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">You</span><span class="java_plain">&nbsp;may&nbsp;choose&nbsp;to&nbsp;use&nbsp;</span><span class="java_keyword">this</span><span class="java_plain">&nbsp;utility&nbsp;method&nbsp;to&nbsp;get&nbsp;the&nbsp;descriptor</span>
<!--  --><br/><span class="java_type">EjbDescriptor</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;ejbDescriptor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;beanManager</span><span class="java_separator">.</span><span class="java_plain">getEjbDescriptor</span><span class="java_separator">(</span><span class="java_plain">ejbName</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Get</span><span class="java_plain">&nbsp;an&nbsp;the&nbsp;</span><span class="java_type">Bean</span><span class="java_plain">&nbsp;object</span>
<!--  --><br/><span class="java_type">Bean</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;bean&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;beanManager</span><span class="java_separator">.</span><span class="java_plain">getBean</span><span class="java_separator">(</span><span class="java_plain">ejbDescriptor</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Create</span><span class="java_plain">&nbsp;the&nbsp;injection&nbsp;target</span>
<!--  --><br/><span class="java_type">InjectionTarget</span><span class="java_plain">&nbsp;it&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;deploymentBeanManager</span><span class="java_separator">.</span><span class="java_plain">createInjectionTarget</span><span class="java_separator">(</span><span class="java_plain">ejbDescriptor</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Per</span><span class="java_plain">&nbsp;instance&nbsp;required</span><span class="java_separator">,</span><span class="java_plain">&nbsp;create&nbsp;the&nbsp;creational&nbsp;context</span>
<!--  --><br/><span class="java_type">CreationalContext</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;cc&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;deploymentBeanManager</span><span class="java_separator">.</span><span class="java_plain">createCreationalContext</span><span class="java_separator">(</span><span class="java_plain">bean</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Perform</span><span class="java_plain">&nbsp;injection&nbsp;and&nbsp;call&nbsp;initializers</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">inject</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">,</span><span class="java_plain">&nbsp;cc</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">You</span><span class="java_plain">&nbsp;may&nbsp;choose&nbsp;to&nbsp;have&nbsp;CDI&nbsp;call&nbsp;the&nbsp;post&nbsp;construct&nbsp;and&nbsp;pre&nbsp;destroy</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;lifecycle&nbsp;callbacks</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Call</span><span class="java_plain">&nbsp;the&nbsp;post</span><span class="java_operator">-</span><span class="java_plain">construct&nbsp;callback</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">postConstruct</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Call</span><span class="java_plain">&nbsp;the&nbsp;pre</span><span class="java_operator">-</span><span class="java_plain">destroy&nbsp;callback</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">preDestroy</span><span class="java_separator">(</span><span class="java_plain">instance</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Clean</span><span class="java_plain">&nbsp;up&nbsp;the&nbsp;instance</span>
<!--  --><br/><span class="java_plain">it</span><span class="java_separator">.</span><span class="java_plain">dispose</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">cc</span><span class="java_separator">.</span><span class="java_plain">release</span><span class="java_separator">();</span></pre>

</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_migration_notes"/>A.3. Migration notes</h2></div></div></div>

<p>This part of the appendix documents the changes in Weld across major and
minor releases that an integrator should be aware of. These changes
mostly touch changes in the SPI or in the container contract.</p>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_migration_from_weld_1_x_to_2_0"/>A.3.1. Migration from Weld 1.x to 2.0</h3></div></div></div>

<p>All the changes are documented in this external
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://community.jboss.org/wiki/WeldIntegratorGuide-ChangesForWeld20">migration
document</a>.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_migration_from_weld_2_0_to_2_1"/>A.3.2. Migration from Weld 2.0 to 2.1</h3></div></div></div>

<div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_logging"/>A.3.2.1. Logging</h4></div></div></div>

<p>Weld no longer uses <code class="literal">slf4j</code> for logging. Instead,
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://search.maven.org/#search%7Cga%7C1%7Cjboss-logging">jboss-logging</a>
is now used as a logging facade.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_httpcontextactivationfilter"/>A.3.2.2. HttpContextActivationFilter</h4></div></div></div>

<p>A new service named
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/weld/javadoc/2.1/weld-spi/org/jboss/weld/servlet/spi/HttpContextActivationFilter.html">HttpContextActivationFilter</a>
was added to the Weld SPI. This optional service allows an integrator to
decide if CDI contexts should be activated or not for a given HTTP
request. By default, CDI contexts are always active but this hook allows
an integrator to eliminate the overhead of CDI context activation for
certain types of requests where CDI is known not to be needed (e.g.
request for a static resource).</p>
<p>Note that when the service is provided, <a xmlns:xlink="http://www.w3.org/1999/xlink" href="#context.mapping">user
configuration</a> is overriden.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_non_portable_mode"/>A.3.2.3. Non-portable mode</h4></div></div></div>

<p>The
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/weld/javadoc/2.1/weld-spi/org/jboss/weld/bootstrap/spi/BootstrapConfiguration.html#isNonPortableModeEnabled%28%29">BootstrapConfiguration</a>
service now allows the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="#non-portable.mode">non-portable mode</a> to be
enabled by the integrator.</p>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_singleton_spi"/>A.3.2.4. Singleton SPI</h4></div></div></div>

<p>Since Weld 2.1 the
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/weld/javadoc/2.1/weld-spi/org/jboss/weld/bootstrap/api/Singleton.html">Singleton
SPI</a> requires the singleton to be identified by a String <code class="literal">context id</code>.
This allows multiple Weld containers to run at the same time in
environments where the TCCL cannot be used to distinguish the containers
(e.g. OSGi environment).</p>
<p>The integrator should:</p>
<div class="itemizedlist"><ul><li>
implement the new methods
</li><li>
use WeldBootstrap.startContainer(String contextId, Environment environment,
Deployment deployment) to start Weld
</li><li>
eliminate all Container.instance() calls and replace them with Container.instance(String contextId)
</li></ul></div>

</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_weld_osgi_bundle"/>A.3.2.5. Weld-OSGi bundle</h4></div></div></div>

<p>The Weld-OSGi bundle does no include Weld’s runtime dependencies
anymore. Therefore, it is possible to deploy the following artifacts in
order to satisfy Weld’s dependencies:</p>
<div class="informaltable">
  
  <table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="left" valign="top">group id</th><th align="left" valign="top">artifact id</th><th align="left" valign="top">version</th></tr></thead><tbody><tr><td align="left" valign="top"><p>org.jboss.logging</p></td><td align="left" valign="top"><p>jboss-logging</p></td><td align="left" valign="top"><p>3.1.3.GA</p></td></tr><tr><td align="left" valign="top"><p>com.google.guava</p></td><td align="left" valign="top"><p>guava</p></td><td align="left" valign="top"><p>13.0.1</p></td></tr><tr><td align="left" valign="top"><p>javax.enterprise</p></td><td align="left" valign="top"><p>cdi-api</p></td><td align="left" valign="top"><p>1.1-20130918</p></td></tr><tr><td align="left" valign="top"><p>javax.annotation</p></td><td align="left" valign="top"><p>javax.annotation-api</p></td><td align="left" valign="top"><p>1.2</p></td></tr><tr><td align="left" valign="top"><p>javax.interceptor</p></td><td align="left" valign="top"><p>javax.interceptor-api</p></td><td align="left" valign="top"><p>1.2</p></td></tr><tr><td align="left" valign="top"><p>org.apache.geronimo.specs</p></td><td align="left" valign="top"><p>geronimo-el_2.2_spec</p></td><td align="left" valign="top"><p>1.0.3</p></td></tr></tbody></table>
</div>

</div>
</div>
<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_migration_from_weld_2_1_to_2_2"/>A.3.3. Migration from Weld 2.1 to 2.2</h3></div></div></div>

<div class="itemizedlist"><ul><li>
The definition of a <span class="emphasis"><em>bean defining annotation</em></span> was altered in CDI 1.2.
See the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://cdi-spec.org">specification</a> for more information.
</li><li>
A new
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/weld/javadoc/2.2/weld-spi/org/jboss/weld/manager/api/WeldInjectionTargetBuilder.html"><code class="literal">WeldInjectionTargetBuilder</code></a>
SPI was added. The SPI allows an integrator to obtain a customized
<code class="literal">InjectionTarget</code> implementation using the builder pattern.
</li><li>
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="#annotationDiscovery">The AnnotationDiscovery service</a> was
deprecated in favor of <a xmlns:xlink="http://www.w3.org/1999/xlink" href="#classFileServices">ClassFileServices</a> .
*
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/weld/javadoc/2.2/weld-spi/org/jboss/weld/bootstrap/api/CDI11Bootstrap.html#startContainer(java.lang.String">http://docs.jboss.org/weld/javadoc/2.2/weld-spi/org/jboss/weld/bootstrap/api/CDI11Bootstrap.html#startContainer(java.lang.String</a>, org.jboss.weld.bootstrap.api.Environment, org.jboss.weld.bootstrap.spi.Deployment)[<code class="literal">CDIBootstrap.startContainer()</code>]
method, which allows a container identifier to be passed as a parameter,
was added.
</li><li>
The contract of the
<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/weld/javadoc/2.2/weld-spi/org/jboss/weld/ejb/api/SessionObjectReference.html#getBusinessObject(java.lang.Class)"><code class="literal">SessionObjectReference.getBusinessObject()</code></a> method was altered. Weld may now call
this method passing in a remote view of a session bean.
</li><li>
The <a xmlns:xlink="http://www.w3.org/1999/xlink" href="#cdiProvider">CDI provider implementation</a> was reimplemented
and is no longer compatible with the previous version.
</li></ul></div>

</div>
</div>
</div>
</div>
</div></body></html>